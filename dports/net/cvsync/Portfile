# $Id: Portfile,v 1.5 2004/01/15 21:40:30 toby Exp $

PortSystem       1.0
name             cvsync
version          0.24.13
categories       net
maintainers      toby@opendarwin.org
description      cvsync is a portable CVS repository synchronization utility 
long_description \
    cvsync is a portable CVS repository synchronization utility. \
    cvsync is freely available under the BSD license and is a \
    compelling, if not raw, replacement for CVSup written in C.
platforms        darwin
master_sites     ftp://ftp.daemon-systems.org/pub/cvsync/ \
                 ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/ \
                 ftp://ftp.allbsd.org/pub/cvsync/
checksums        md5 33dc221c74f6ea4de1b3611ce48ba73f

patch {
    reinplace s|/var/run|$prefix/var/run| $worksrcpath/cvsyncd/main.c
    reinplace s|/var/run|$prefix/var/run| $worksrcpath/cvsyncd/cvsyncd.1
}

configure.cmd    make
configure.pre_args configure
configure.args   HASH_TYPE=openssl \
                 PREFIX=${prefix}
build.args       CVSYNC_DEFAULT_CONFIG=${prefix}/etc/cvsync.conf \
                 CVSYNCD_DEFAULT_CONFIG=${prefix}/etc/cvsyncd.conf
destroot.args    ${build.args}
destroot.destdir PREFIX=${destroot}${prefix}

post-destroot {
    file mkdir ${destroot}${prefix}/share/doc/${name}
    file copy ${worksrcpath}/samples ${destroot}${prefix}/share/doc/${name}
    file mkdir ${destroot}${prefix}/var/run
    system "touch ${destroot}${prefix}/var/run/cvsyncd.pid"
}

post-install {
    file delete ${prefix}/var/run/cvsyncd.pid

    ui_info ""
    ui_info "You must create two configuration files:"
    ui_info "  ${prefix}/etc/cvsync.conf"
    ui_info "  ${prefix}/etc/cvsyncd.conf"
    ui_info ""
    ui_info "For examples, see ${prefix}/share/doc/${name}/"
}
