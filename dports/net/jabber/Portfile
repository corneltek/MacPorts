PortSystem 1.0
name		jabber
version		1.4.2
revision	0
categories	net
maintainers	jpm@opendarwin.org
description	Online presence and instant messaging server
long_description	The Jabber server (jabberd) is a daemon for Jabber clients to connect and communicate with.
platforms	darwin
master_sites	http://jabberd.jabberstudio.org/downloads/
checksums	md5 10780dbdb93926ea5bb360e1186b939c
depends_lib	lib:libiconv:libiconv lib:libexpat.0:expat \
	lib:libintl.1:gettext lib:libpth.a:pth
configure.env	CPPFLAGS=-no-cpp-precomp
build.type  gnu
install {
	system "install -o root -m 755 ${worksrcpath}/jabberd/jabberd ${prefix}/sbin"
		
	system "install -o root -m 755 -d ${prefix}/lib/jabber/pthsock"
	system "install -o root -m 755 ${worksrcpath}/pthsock/pthsock_client.so ${prefix}/lib/jabber/pthsock"
	
	system "install -o root -m 755 -d ${prefix}/lib/jabber/dialback"
	system "install -o root -m 755 ${worksrcpath}/dialback/dialback.so ${prefix}/lib/jabber/dialback"
	
	system "install -o root -m 755 -d ${prefix}/lib/jabber/dnsrv"
	system "install -o root -m 755 ${worksrcpath}/dnsrv/dnsrv.so ${prefix}/lib/jabber/dnsrv"
	
	system "install -o root -m 755 -d ${prefix}/lib/jabber/xdb_file"
	system "install -o root -m 755 ${worksrcpath}/xdb_file/xdb_file.so ${prefix}/lib/jabber/xdb_file"
	
	system "install -o root -m 755 -d ${prefix}/lib/jabber/jsm"
	system "install -o root -m 755 ${worksrcpath}/jsm/jsm.so ${prefix}/lib/jabber/jsm"
		
	system "install -o root -m 755 -d ${prefix}/etc/jabber/"
	system "install -o root -m 755 ${worksrcpath}/jabber.xml ${prefix}/etc/jabber"
	
	system "install -o root -m 755 -d ${prefix}/var/lib/jabber/"
	system "install -o root -m 755 -d ${prefix}/var/run/jabber/"
	system "install -o root -m 755 -d ${prefix}/var/log/jabber/"
	system "install -o root -m 755 -d ${prefix}/var/spool/jabber/"	

	file copy -force ${prefix}/etc/jabber/jabber.xml ${prefix}/etc/jabber/jabber.xml.default
}

contents \
	etc/jabber/jabber.xml.default \
	lib/jabber/pthsock/pthsock_client.so \
	lib/jabber/pthsock/ \
	lib/jabber/dialback/dialback.so \
	lib/jabber/dialback/ \
	lib/jabber/dnsrv/dnsrv.so \
	lib/jabber/dnsrv/ \
	lib/jabber/xdb_file/xdb_file.so \
	lib/jabber/xdb_file/ \
	lib/jabber/jsm/jsm.so \
	lib/jabber/jsm/ \
	lib/jabber/

variant ssl {
#	depends_lib-append	lib:libssl:libssl
	configure.args	--enable-ssl
}
