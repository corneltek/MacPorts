# $Id: Portfile,v 1.1 2003/12/22 07:45:45 mww Exp $

PortSystem	1.0
name		gnughostscript
version		7.07
homepage	http://www.cs.wisc.edu/~ghost/
description	GPL Ghostscript, An interpreter for PostScript and PDF
long_description	Ghostscript is the well-known PostScript interpreter \
			which is available for Ghostscript is the well-known \
			PostScript interpreter which is available for all \
			common and most esoteric platforms and supports many \
			different printers and some displays. This provides \
			the GPL version.

categories	print
platforms	darwin
maintainers	blb@pobox.com
master_sites	sourceforge:ghostscript:source \
		http://www.ijg.org/files/:jpeg

distname	ghostscript-${version}
distfiles	${distname}.tar.bz2:source \
		ghostscript-fonts-std-6.0${extract.suffix}:source \
		ghostscript-fonts-other-6.0${extract.suffix}:source \
		jpegsrc.v6b${extract.suffix}:jpeg

checksums	${distname}.tar.bz2 \
			md5 85fd16cdc8232e5e3679a3a7e30a3359 \
		ghostscript-fonts-std-6.0${extract.suffix} \
			md5 8250132d6fcc6eb1419f505f06c7690b \
		ghostscript-fonts-other-6.0${extract.suffix} \
			md5 1a643ae62ef166562e4d422b1a601272 \
		jpegsrc.v6b${extract.suffix} \
			md5 dbd5f3b47ed13132f04c685d608a7547

depends_lib	lib:libpng:libpng \
		lib:libX11.6:XFree86 \
		lib:libgtk:gtk

extract	{
	cd ${workpath}
	system "bzip2 -dc \"${distpath}/${distname}.tar.bz2\" |tar xf -"
	system "gzip -dc \"${distpath}/ghostscript-fonts-std-6.0${extract.suffix}\" |tar xf -"
	system "gzip -dc \"${distpath}/ghostscript-fonts-other-6.0${extract.suffix}\" |tar xf -"
	system "gzip -dc \"${distpath}/jpegsrc.v6b${extract.suffix}\" |tar xf -"
	system "mv jpeg-6b ${distname}/jpeg"
}

post-extract	{
	cd ${worksrcpath}
	system "ln -s src/unix-gcc.mak makefile"
}

patchfiles	patch-src-unix-dll.mak

use_configure	no

build.target	so
build.args	SHARE_LIBPNG=1 \
		SHARE_ZLIB=1 \
		XCFLAGS="-I${prefix}/include -no-cpp-precomp" \
		XLDFLAGS="-L${prefix}/lib" \
		prefix=${prefix} \
		mandir=${prefix}/share/man

destroot.target	soinstall
destroot.destdir	prefix=${destroot}/${prefix}
destroot.args	SHARE_LIBPNG=1 \
		SHARE_ZLIB=1 \
		XCFLAGS="-I${prefix}/include -no-cpp-precomp" \
		XLDFLAGS="-L${prefix}/lib" \
		mandir=${destroot}/${prefix}/share/man

post-destroot	{
	file mkdir ${destroot}/${prefix}/share/ghostscript/ \
		${destroot}/${prefix}/include/ps
	file copy ${workpath}/fonts ${destroot}/${prefix}/share/ghostscript
	file copy ${worksrcpath}/src/iapi.h ${worksrcpath}/src/errors.h \
		${worksrcpath}/src/gdevdsp.h ${destroot}/${prefix}/include/ps
	system "ln -s gsc ${destroot}/${prefix}/bin/gs"
}

