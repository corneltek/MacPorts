# $Id: Portfile,v 1.11 2003/03/03 07:12:26 mij Exp $

PortSystem 1.0
name			teTeX
version			3.14159
categories		print textproc
description		TeX and METAFONT
long_description	teTeX is a TeX distribution for UNIX compatible \
			systems.  It contains the latest versions of TeX & \
			friends and nearly everything you need for happy \
			TeX'ing.  For more information have a look at \
			the lengthy FEATURES file of the distribution.
platforms		darwin
maintainers		landonf@opendarwin.org
depends_lib		lib:libpng.3:libpng lib:libwwwcore.0:libwww

set tetex_src		teTeX-src-1.0.7.tar.gz
set tetex_texmf		teTeX-texmf-1.0.2.tar.gz
set tetex_texmftree	${destroot}/${prefix}/share/texmf

master_sites		ftp://wuarchive.wustl.edu/packages/TeX/systems/unix/teTeX/1.0/distrib/sources/  \
			ftp://ftp.funet.fi/pub/TeX/CTAN/systems/unix/teTeX/1.0/distrib/sources/  \
			ftp://ctan.unsw.edu.au/tex-archive/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ftp.cise.ufl.edu/tex-archive/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ftp.tex.ac.uk/tex-archive/systems/unix/teTeX/1.0/distrib/sources/  \
			ftp://ftp.kddlabs.co.jp/CTAN/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://sunsite.auc.dk/pub/tex/ctan/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ctan.tug.org/tex-archive/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ftp.dante.de/tex-archive/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ftp.dnsbalance.ring.gr.jp/pub/text/CTAN/systems/unix/teTeX/1.0/distrib/sources/ \
			http://www.dnsbalance.ring.gr.jp/archives/text/CTAN/systems/unix/teTeX/1.0/distrib/sources/ \
			ftp://ftp.chg.ru/pub/TeX/CTAN/systems/unix/teTeX/1.0/distrib/sources/ \
			http://distfiles.opendarwin.org/:lt

dist_subdir		teTeX
distfiles		${tetex_src} ${tetex_texmf} ltconfig13:lt ltmain13:lt
checksums		${tetex_src} md5 2c6da2a45096c2fdc41b8de6a8af1a52 \
			${tetex_texmf} md5 7811ed356cca07b16ea8422f00c3cd34 \
			ltconfig13 md5 ea53f42a550c9f9e653758a8ed91574e \
			ltmain13 md5 e094ae92724c4015dbab97de151c2525

extract.only		${tetex_src}
worksrcdir		teTeX-1.0

patchfiles		patch-autoconf

post-patch {		system "cp ${distpath}/ltconfig13 ${worksrcpath}/config/ltconfig"
			system "cp ${distpath}/ltmain13 ${worksrcpath}/config/ltmain.sh"
}

configure.type		gnu
configure.args		--disable-multiplatform --without-texinfo --without-dialog \
			--with-system-ncurses --with-system-zlib --with-system-wwwlib \
			--with-libwww-libdir=${prefix}/lib \
			--with-libwww-include=${prefix}/include/w3c-libwww \
			--with-system-pnglib --with-pnglib-libdir=${prefix}/lib \
			--with-pnglib-include=${prefix}/include
# Apple gcc3 bug
configure.env		CXXFLAGS=-fno-rtti CPPFLAGS=-no-cpp-precomp

pre-install {		file mkdir ${tetex_texmftree}; cd ${tetex_texmftree}
			system "tar xfz ${distpath}/${tetex_texmf}"
}

post-install {
			# ranlib static library to keep darwin happy
			system "ranlib ${destroot}/${prefix}/lib/libkpathsea.a"
			# Modify mktex.opt to force use of varfonts
			reinplace s|MT_FEATURES=appendonlydir|MT_FEATURES=appendonlydir:varfonts|g' ${destroot}/${prefix}/share/texmf/web2c/mktex.opt
			# Rename 'dialog' to 'tcdialog'
			file move ${destroot}/${prefix}/man1/dialog.1 ${destroot}/${prefix}/man1/tcdialog.1
			file move ${destroot}/${prefix}/bin/dialog ${destroot}/${prefix}/bin/tcdialog

			# Create a local texmf tree
			file mkdir ${destroot}/${prefix}/share/texmf.local/web2c

			# Create the texmf.macosx tree
			file mkdir ${destroot}/${prefix}/share/texmf.macosx/web2c
}


install.target		install strip
install.destroot	prefix=${destroot}/${prefix}/ texmf=${destroot}/${prefix}/
