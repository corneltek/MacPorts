# $Id: Portfile,v 1.14 2003/09/29 15:28:44 gwright Exp $

PortSystem 1.0
name			teTeX
version			3.14159
categories		print textproc
maintainers		gwright@comcast.net
description		TeX and METAFONT
long_description	teTeX is a TeX distribution for UNIX compatible	\
			systems.  It contains the latest versions of	\
			TeX & friends and nearly everything you need	\
			for happy TeX'ing.  For more information have	\
			a look at the lengthy FEATURES file of the	\
			distribution.
platforms		darwin

depends_lib		lib:libpng.3:libpng lib:libwwwcore.0:libwww

set tetex_src		tetex-src-2.0.2.tar.gz
set tetex_texmf		tetex-texmf-2.0.2.tar.gz
set tetex_top		${prefix}/share/texmf
set tetex_texmftree	${destroot}/${tetex_top}

master_sites		ftp://tug.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ \
			ftp://cam.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ \
			ftp://dante.ctan.org/tex-archive/systems/unix/teTeX/current/distrib/ 

distfiles		${tetex_src} ${tetex_texmf}

checksums		${tetex_src}   md5 a16f6bba227d55e79aeee46fbbd82d28 \
			${tetex_texmf} md5 d3bdb96f9077e43b2115d3cc471743b3

extract.only		${tetex_src}
worksrcdir		tetex-src-2.0.2

patchfiles		patch-fmtutil
pre-configure		{ reinplace "s|fmtutil --all|fmtutil --all --cnffile ${destroot}/${tetex_top}/web2c/fmtutil.cnf|" ${workpath}/${worksrcdir}/Makefile.in
			  reinplace "s|    \$(scriptdir)/texlinks|    \$(scriptdir)/texlinks --cnffile ${destroot}/${tetex_top}/web2c/fmtutil.cnf|" ${workpath}/${worksrcdir}/Makefile.in }

configure.type		gnu
configure.args		--prefix=${tetex_top}	\
			--disable-multiplatform	\
			--without-texinfo	\
			--without-dialog	\
			--with-system-ncurses	\
			--with-system-zlib	\
			--with-system-wwwlib	\
			--with-libwww-libdir=${prefix}/lib \
			--with-libwww-include=${prefix}/include/w3c-libwww \
			--with-system-pnglib	\
			--with-pnglib-libdir=${prefix}/lib \
			--with-pnglib-include=${prefix}/include
# Apple gcc3 bug
configure.env		CXXFLAGS=-fno-rtti CPPFLAGS=-no-cpp-precomp

pre-destroot	{ file mkdir ${tetex_texmftree}
		  cd ${tetex_texmftree}
		  system "tar xfz ${distpath}/${tetex_texmf}"
		}

post-destroot	{ # ranlib static library to keep darwin happy
		  system "ranlib ${destroot}/${prefix}/lib/libkpathsea.a"

		  # Modify mktex.opt to force use of varfonts
		  reinplace "s|MT_FEATURES=appendonlydir|MT_FEATURES=appendonlydir:varfonts|g" ${destroot}/${tetex_top}/web2c/mktex.opt

		  # Create a local texmf tree
		  file mkdir ${destroot}/${tetex_top}/share/texmf.local/web2c

		  # Create the texmf.macosx tree
		  file mkdir ${destroot}/${tetex_top}/share/texmf.macosx/web2c

		  # Repair infelicities in texmf.cnf
		  reinplace "s|${prefix}/share/texmf/share/texmf|${prefix}/share/texmf|g" ${destroot}/${tetex_top}/web2c/texmf.cnf
		}

destroot.target		install strip
destroot.destdir	prefix=${destroot}/${prefix}/ texmf=${destroot}/${tetex_top}/

post-install	{ system "fmtutil --all" }

