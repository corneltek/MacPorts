PortSystem 1.0
portname	nethack
portversion	3.4.0
categories	games
maintainers	kevin@opendarwin.org
description	Classic dungeon adventure game.
master_sites	http://twtelecom.dl.sourceforge.net/sourceforge/nethack/
distname	${portname}-340
extract_sufx	.tgz
checksums	md5 0093f14fbbe449d5b188bfb6aa4eae4f
patchfiles	patch-Makefile.top patch-Makefile.src
worksrcdir	${portname}-${portversion}
make.target.install	manpages install

include contents

post-patch {
    set path "${portpath}/${workdir}/${worksrcdir}"
    reinplace "s|= /usr|= ${prefix}|g" "${path}/sys/unix/Makefile.top"
	reinplace "s|/usr/man/man6|${prefix}/man/man6|g" "${path}/sys/unix/Makefile.doc"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/sys/unix/Makefile.top"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/sys/unix/nethack.sh"
    reinplace "s|/usr/games/lib/nethackdir|${prefix}/share/nethackdir|g" "${path}/include/config.h"
    system "cd \"${path}/sys/unix\" && sh \"${path}/sys/unix/setup.sh\""
}

configure {}

pre-install {
	system "mkdir -p -m 0755 \"${prefix}/man/man6\""
}

variant x11 {
    patchfiles-append patch-x11-Makefile.top patch-x11-Makefile.src patch-x11-config.h
}
