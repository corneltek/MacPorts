--- setup.py	(original)
+++ setup.py	(refactored)
@@ -54,13 +54,13 @@
         try:
             build_ext.run(self)
         except DistutilsPlatformError:
-            raise BuildFailed, BuildFailed(), sys.exc_info()[2]
+            raise BuildFailed(BuildFailed()).with_traceback(sys.exc_info()[2])
 
     def build_extension(self, ext):
         try:
             build_ext.build_extension(self, ext)
         except ext_errors:
-            raise BuildFailed, BuildFailed(), sys.exc_info()[2]
+            raise BuildFailed(BuildFailed()).with_traceback(sys.exc_info()[2])
 
 
 # -*- py3k -*-
@@ -100,7 +100,7 @@
     for line in meta_fh:
         if line.strip() == '# -eof meta-':
             break
-        for pattern, handler in pats.items():
+        for pattern, handler in list(pats.items()):
             m = pattern.match(line.strip())
             if m:
                 meta.update(handler(m))
@@ -194,7 +194,7 @@
         extensions = [
         Extension('_billiard',
                 sources=multiprocessing_srcs,
-                define_macros=macros.items(),
+                define_macros=list(macros.items()),
                 libraries=libraries,
                 include_dirs=['Modules/_billiard'],
                 depends=(glob.glob('Modules/_billiard/*.h') +
@@ -232,6 +232,6 @@
 
 try:
     run_setup(not (is_jython or is_pypy or is_py3k))
-except BuildFailed, exc:
+except BuildFailed as exc:
     sys.stderr.write(BUILD_WARNING % (exc, ))
     run_setup(False)
