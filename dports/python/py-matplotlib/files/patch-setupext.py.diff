--- setupext.py.orig	2013-08-06 23:52:36.000000000 +0400
+++ setupext.py	2013-08-07 12:05:00.000000000 +0400
@@ -1234,6 +1234,18 @@
             ext.library_dirs.extend([os.path.join(sys.prefix, 'dlls')])
 
         elif sys.platform == 'darwin':
+            tcl_lib_dir = tk_lib_dir = os.path.join(get_base_dirs()[0], 'lib')
+            result = self.parse_tcl_config(tcl_lib_dir, tk_lib_dir)
+            if result is None:
+                raise SystemExit("Tcl/Tk not found, aborting")
+
+            (tcl_lib_dir, tcl_inc_dir, tcl_lib,
+             tk_lib_dir, tk_inc_dir, tk_lib) = result
+            ext.include_dirs.extend([tcl_inc_dir, tk_inc_dir])
+            ext.library_dirs.extend([tcl_lib_dir, tk_lib_dir])
+            ext.libraries.extend([tcl_lib, tk_lib])
+
+            return
             # this config section lifted directly from Imaging - thanks to
             # the effbot!
 
@@ -1476,6 +1488,9 @@
     name = "gtk3agg"
 
     def check(self):
+        if self.get_config() is False:
+            raise CheckFailed("skipping due to configuration")
+
         if 'TRAVIS' in os.environ:
             raise CheckFailed("Can't build with Travis")
 
@@ -1534,6 +1549,9 @@
     name = "gtk3cairo"
 
     def check(self):
+        if self.get_config() is False:
+            raise CheckFailed("skipping due to configuration")
+
         if 'TRAVIS' in os.environ:
             raise CheckFailed("Can't build with Travis")
 
@@ -1562,6 +1580,9 @@
     name = "wxagg"
 
     def check(self):
+        if self.get_config() is False:
+            raise CheckFailed("skipping due to configuration")
+
         try:
             import wxversion
         except ImportError:
@@ -1661,6 +1682,9 @@
         return '.'.join(temp)
 
     def check(self):
+        if self.get_config() is False:
+            raise CheckFailed("skipping due to configuration")
+
         try:
             from PyQt4 import pyqtconfig
         except ImportError:
@@ -1695,6 +1719,9 @@
     name = "cairo"
 
     def check(self):
+        if self.get_config() is False:
+            raise CheckFailed("skipping due to configuration")
+
         try:
             import cairo
         except ImportError:
