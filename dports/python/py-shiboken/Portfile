# $Id$

PortSystem 1.0
PortGroup cmake 1.0
PortGroup python 1.0

set realname        shiboken
name                py-${realname}
version             1.1.1
revision            1
python.versions     25 26 27
python.default_version 27
categories          python devel
maintainers         openmaintainer mmoll
license             LGPL
description         Plugin for generatorrunner that generates python bindings \
                    for C++ libraries
long_description    Shiboken is a plugin (front-end) for generatorrunner that \
                    generates python bindings for C++ libraries using CPython \
                    source code.
homepage            http://www.pyside.org/docs/shiboken/
platforms           darwin
master_sites        http://www.pyside.org/files/

checksums           md5     fa451b6c4f3e06cce283a84550a96fd2 \
                    rmd160  4a0997c9474f433a6b0998d68eb84e98613bd010 \
                    sha1    d24efc1e7499e9d7db4dfc85a975291e3cb3f311
distname            ${realname}-${version}
use_bzip2           yes

pre-patch {
    # MacOS cannot have a file and directory with the same name, as occurs here
    system "mv -v '${worksrcpath}/generator/shiboken' '${worksrcpath}/generator/shiboken.d'"
}

patchfiles          default_visibility.patch \
                    filename_collision.patch

if {$subport != $name} {
    depends_lib-append  port:qt4-mac port:apiextractor port:generatorrunner port:python${python.version}
    use_configure   yes
    configure.args-append -DBUILD_TESTS:BOOL=FALSE \
                    -DPYTHON_EXECUTABLE=${python.bin} \
                    -DPYTHON_LIBRARY=${python.lib} \
                    -DPYTHON_INCLUDE_DIR=${python.include}
    build.cmd       make
    build.target    all
    destroot.cmd    make
    destroot.destdir DESTDIR=${destroot}
}

if {${name} == ${subport}} {
    livecheck.type      regex
    livecheck.url       ${master_sites}
    livecheck.regex     ${realname}-(\[0-9.\]+)\\.tar\\.bz2
} else {
    livecheck.type      none
}
