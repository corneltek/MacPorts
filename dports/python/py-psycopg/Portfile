# $Id: Portfile,v 1.2 2003/11/17 09:55:42 mww Exp $

PortSystem 1.0

name		py-psycopg
version		1.1.10
categories	python databases
maintainers	mww@opendarwin.org
description	a postgresql database adapter for python
long_description	psycopg is a postgresql database adapter for python. \
		It's fully complaint to pythons DBAPI-2.0. pycopg is designed \
		for heavily multi-threaded applications featuring connection \
		pooling.

homepage	http://www.initd.org/software/initd/psycopg/
master_sites	http://initd.org/pub/software/psycopg/
distname	psycopg-${version}
checksums	md5 2279a6aaddf8a8fbec44f782e5cdaa02

#depends on postgresql +devel variant!
depends_lib	lib:libpq:postgresql \
		lib:mxDateTime.h:py-mx \
		bin:python:python

configure.env	LDFLAGS="-L${prefix}/lib" \
		CPPFLAGS="-I${prefix}/include \
	-I${prefix}/lib/python2.3/site-packages/mx/DateTime/mxDateTime/ \
	-I${prefix}/lib/python2.2/site-packages/mx/DateTime/mxDateTime/ \
	-I${prefix}/lib/python2.1/site-packages/mx/DateTime/mxDateTime/"
configure.args	--with-postgres-includes=${prefix}/include/postgresql/server

post-configure {
	reinplace "s|PY_LIB_DIR = \$(prefix)|\
		PY_LIB_DIR = ${destroot}${prefix}|g" ${worksrcpath}/Makefile
	reinplace "s|PY_MOD_DIR = \$(exec_prefix)|\
		PY_MOD_DIR = ${destroot}${prefix}|g" ${worksrcpath}/Makefile
	reinplace "s|@echo 'Installing shared modules...'|\
		install -m 755 -d \$(PY_MOD_DIR)|g" ${worksrcpath}/Makefile
}

build.env	CPPFLAGS="-I${prefix}/include -Wno-long-double"
build.target

post-destroot	{
	file mkdir ${destroot}${prefix}/share/doc/${name}
	file copy ${worksrcpath}/AUTHORS ${worksrcpath}/COPYING \
		${worksrcpath}/RELEASE-1.0 ${worksrcpath}/CREDITS \
		${worksrcpath}/SUCCESS ${worksrcpath}/ChangeLog \
		${worksrcpath}/VERSION ${worksrcpath}/doc/examples \
		${worksrcpath}/NEWS ${worksrcpath}/README ${worksrcpath}/FAQ \
		${worksrcpath}/INSTALL ${worksrcpath}/doc/python-taylor.txt \
		${worksrcpath}/TODO ${destroot}${prefix}/share/doc/${name}
}
