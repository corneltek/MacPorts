# $Id: Portfile 94056 2012-06-07 16:57:32Z mww@macports.org $

PortSystem          1.0
PortGroup           ocaml 1.0

name                ocsigen
version             2.1
categories          www devel ml
platforms           darwin
license             {LGPL-2.1 OpenSSLException}
maintainers         mww openmaintainer
description         ocaml based web and application server
long_description    ${description}
homepage            http://zoggy.github.com/ocamlrss/
master_sites        http://ocsigen.org/download/
checksums           rmd160  a32552e49c8a0eaec5c01c9d95c54685df7b093e \
                    sha256  433bf98754c198b1752a8893f52dcb69352e7265dd3634c45eacfdf9702d0cbd

distname            ocsigenserver-${version}

depends_lib         port:ocaml port:ocaml-findlib port:ocaml-react \
                    port:ocaml-ssl port:ocaml-lwt port:ocaml-ocamlnet \
                    port:ocaml-pcre port:ocaml-cryptokit port:ocaml-text \
                    port:tyxml port:ocaml-sqlite3 port:ocaml-zip

post-extract {
    system "chmod +x ${worksrcpath}/configure"
}

configure.pre_args  --prefix ${prefix}
configure.args      --with-sqlite --with-camlzip \
                    --temproot ${destroot} \
                    --sysconfdir ${prefix}/etc/${name} \
                    --logdir ${prefix}/var/log/${name} \
                    --staticpagesdir ${prefix}/var/www/${name} \
                    --datadir ${prefix}/var/lib/${name} \
                    --enable-natdynlink \
                    --commandpipe ${prefix}/var/run/ocsigenserver_command \
                    --ocsigen-user _www \
                    --ocsigen-group _www

use_parallel_build  no
build.target        all doc

destroot.target     install install.doc
destroot.asroot     yes

livecheck.type      regex
livecheck.url       http://ocsigen.org/ocsigenserver/install
livecheck.regex     ocsigenserver-(\[0-9.\]+)${extract.suffix}

