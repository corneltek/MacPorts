From fa22d6be82c69535d6bca1a90a62b7e4cf9d7d13 Mon Sep 17 00:00:00 2001
From: Jeremy Huddleston Sequoia <jeremyhu@apple.com>
Date: Sun, 17 Apr 2016 14:00:01 -0700
Subject: [PATCH] Fix incorrect assumption that APPLE implies Mac.
 https://bugs.webkit.org/show_bug.cgi?id=156679

Addresses build failure introduced in r198947

Signed-off-by: Jeremy Huddleston Sequoia <jeremyhu@apple.com>
---
 Source/WebKit2/CMakeLists.txt |  6 +++---
 Source/WebKit2/ChangeLog      | 11 +++++++++++
 Tools/CMakeLists.txt          | 10 ++++------
 Tools/ChangeLog               | 11 +++++++++++
 4 files changed, 29 insertions(+), 9 deletions(-)

diff --git a/Source/WebKit2/CMakeLists.txt b/Source/WebKit2/CMakeLists.txt
index 1b172bd..97fe019 100644
--- Source/WebKit2/CMakeLists.txt
+++ Source/WebKit2/CMakeLists.txt
@@ -868,7 +868,7 @@ if (WebKit2_NetworkProcess_OUTPUT_NAME)
     set_target_properties(NetworkProcess PROPERTIES OUTPUT_NAME ${WebKit2_NetworkProcess_OUTPUT_NAME})
 endif ()
 
-if (ENABLE_PLUGIN_PROCESS AND NOT APPLE)
+if (ENABLE_PLUGIN_PROCESS AND NOT "${PORT}" STREQUAL "Mac")
     add_definitions(-DENABLE_PLUGIN_PROCESS=1)
     add_executable(PluginProcess ${PluginProcess_SOURCES})
     add_webkit2_prefix_header(PluginProcess)
@@ -880,7 +880,7 @@ if (ENABLE_PLUGIN_PROCESS AND NOT APPLE)
     endif ()
 endif ()
 
-if (ENABLE_DATABASE_PROCESS AND NOT APPLE)
+if (ENABLE_DATABASE_PROCESS AND NOT "${PORT}" STREQUAL "Mac")
     add_definitions(-DENABLE_DATABASE_PROCESS=1)
     add_executable(DatabaseProcess ${DatabaseProcess_SOURCES})
     add_webkit2_prefix_header(DatabaseProcess)
@@ -892,7 +892,7 @@ if (ENABLE_DATABASE_PROCESS AND NOT APPLE)
     endif ()
 endif ()
 
-if (APPLE)
+if ("${PORT}" STREQUAL "Mac")
     set(_web_xpc_dir ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/WebKit.framework/Versions/A/XPCServices/com.apple.WebKit.WebContent.Development.xpc/Contents)
     make_directory(${_web_xpc_dir}/MacOS)
     make_directory(${_web_xpc_dir}/Resources)
diff --git a/Tools/CMakeLists.txt b/Tools/CMakeLists.txt
index fae8b61..a9e79df 100644
--- Tools/CMakeLists.txt
+++ Tools/CMakeLists.txt
@@ -27,6 +27,10 @@ elseif ("${PORT}" STREQUAL "GTK")
     if (ENABLE_MINIBROWSER)
         add_subdirectory(MiniBrowser/gtk)
     endif ()
+elseif ("${PORT}" STREQUAL "Mac")
+    add_subdirectory(DumpRenderTree)
+    add_subdirectory(WebKitTestRunner)
+    add_subdirectory(MiniBrowser/mac)
 endif ()
 
 if (WIN32)
@@ -35,12 +39,6 @@ if (WIN32)
     add_subdirectory(MiniBrowser/win)
 endif ()
 
-if (APPLE)
-    add_subdirectory(DumpRenderTree)
-    add_subdirectory(WebKitTestRunner)
-    add_subdirectory(MiniBrowser/mac)
-endif ()
-
 if (ENABLE_WEBKIT2 AND ENABLE_API_TESTS)
     add_subdirectory(TestWebKitAPI)
 endif ()
