# $Id: Portfile,v 1.1 2004/02/08 11:24:17 pguyot Exp $

PortSystem			1.0
name				yaws
version				1.31
categories			www
maintainers			pguyot@kallisys.net
platforms			darwin
description			Webserver for dynamic content written in Erlang
long_description	Yaws is a high performance HTTP server for dynamic content \
					written in Erlang. Pages can be dynamic with embedded erlang \
					code. Yaws also features a built-in Wiki.
homepage			http://yaws.hyber.org/
master_sites		http://yaws.hyber.org/download/
checksums			md5 ca39d9edc292de8a999845359589658e

depends_build		bin:erlc:erlang
depends_run			path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup

extract.post_args	| tar -xf - --exclude \
					"${name}-${version}/www/testdir/xx*xx.jpg"
post-extract {
	# Copy BSD rc.d stuff.
	file mkdir ${worksrcpath}/scripts/bsd/
	file copy ${filespath}/yaws.sh ${worksrcpath}/scripts/bsd/
}

patchfiles			patch-man-yaws.1 \
					patch-man-yaws_api.5 \
					patch-man-yaws.conf.5 \
					patch-scripts-Install \
					patch-scripts-yaws.conf.template \
					patch-src-yaws_config.erl \
					patch-src-yaws_ctl.erl

post-patch {
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/man/yaws.1
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/man/yaws.conf.5
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/man/yaws_api.5
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/scripts/yaws.conf.template
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/src/yaws_config.erl
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/src/yaws_ctl.erl
}

configure.args		--prefix=${prefix} \
					--sysconfdir=${prefix}/etc \
					--localstatedir=${prefix}/var
					
post-destroot {
	xinstall -d "${prefix}/var/log/yaws/"
	system "touch ${prefix}/var/log/yaws/.turd"
}

post-install {
	ui_msg "Copy and customize ${prefix}/etc/yaws.conf.template to ${prefix}/etc/yaws.conf"
}