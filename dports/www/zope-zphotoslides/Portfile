# $Id: Portfile,v 1.1 2003/12/18 04:24:10 rshaw Exp $
PortSystem 1.0

name		zope-zphotoslides
version		1.2.1
categories	www python zope
maintainers	rshaw@opendarwin.org
description	Zope web photo gallery product
long_description	ZPhotoSlides is a web photo gallery for the \
			dynamic web-based server Zope. ZPhotoSlides will \
			help you to show to all your friends and familly \
			your best photos in a nice environment, to \
			thumbnailize them, modify them (Apply filters, \
			rotate, resize...) within your browser and \
			accessible wherever you are.
platforms	darwin
homepage	http://www.zphotoslides.org/
distname	ZPhotoSlides
distfiles	ZPhotoSlides-${version}${extract.suffix}
master_sites	sourceforge:zphotoslides
checksums	md5 141f6181735fdba8eaaa10de072a1300

set python	${prefix}/bin/python2.1
set pythonlib	${prefix}/lib/python2.1
set zopehome	${prefix}/www/Zope
set zopeprod	${zopehome}/lib/python/Products
set zopeuser	zope
set zopegroup	www

depends_build	bin:${python}:python21 \
		path:${zopehome}:zope
depends_run	bin:convert:ImageMagick \
		path:${pythonlib}/site-packages/PIL:py-pil \
		path:${zopeprod}/LocalFS:zope-localfs

patchfiles	patch-__init__.py
post-patch	{ reinplace "s|/usr/local|${prefix}|" ${worksrcpath}/ZPhotoSlides.py }

configure	{}

pre-build	{ file copy ${zopehome}/inst/compilezpy.py ${workpath}
		  system "find ${worksrcpath} -name '*.py\[co\]' | xargs rm"
		  file rename -force ${worksrcpath}/batch_slides.py \
			${worksrcpath}/batch_slides.py.txt }

build		{ system "cd ${worksrcpath} && \
			  ${python} -W ignore:'import * only' ${workpath}/compilezpy.py" }

post-build	{ file rename -force ${worksrcpath}/batch_slides.py.txt \
			${worksrcpath}/batch_slides.py }

destroot	{ file mkdir ${destroot}${zopeprod}
		  system "cp -R ${workpath}/${distname} ${destroot}${zopeprod}"
		  system "chown -R ${zopeuser} ${destroot}${zopeprod}"
		  system "chgrp -R ${zopegroup} ${destroot}${zopeprod}" }

