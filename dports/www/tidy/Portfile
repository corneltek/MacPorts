# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               cmake 1.0
PortGroup               github 1.0

# https://github.com/htacg/tidy-html5/issues/192
PortGroup               muniversal 1.0

github.setup            htacg tidy-html5 ca06201c3abb3829d6be6465e433ac72c8b15449
name                    tidy
epoch                   1
version                 4.9.24
categories              www
platforms               darwin
maintainers             ryandesign openmaintainer
license                 MIT

description             Fixes and tidies up HTML files

long_description        Tidy is a utility to clean up and fix broken HTML files.

homepage                http://${github.author}.github.io/${github.project}/

checksums               rmd160  da99f6e368ef1f36c3dcc77f7443fd48da928fc2 \
                        sha256  44dad7ccd027dfd574c081c7614753749961404654356d5a008bacb9677e842b

depends_build-append    port:libxslt

patchfiles-append       patch-CMakeLists.txt.diff

cmake.out_of_source     yes
cmake.build_dir         ${worksrcpath}/build/cmake

configure.args-append   -DBUILD_SHARED_LIB:BOOL=ON \
                        -DLIB_NAME=tidy

use_parallel_build      yes

# https://github.com/htacg/tidy-html5/issues/194
if {[variant_isset universal]} {
    foreach arch ${configure.universal_archs} {
        set merger_build_env($arch) \
                        DYLD_LIBRARY_PATH=${worksrcpath}-${arch}/build/cmake
        set merger_destroot_env($arch) \
                        DYLD_LIBRARY_PATH=${worksrcpath}-${arch}/build/cmake
    }
} else {
    build.env-append    DYLD_LIBRARY_PATH=${cmake.build_dir}
    destroot.env-append DYLD_LIBRARY_PATH=${cmake.build_dir}
}

livecheck.type          regex
livecheck.url           ${github.raw}/master/version.txt
livecheck.version       ${version}
livecheck.regex         {^([0-9.]+)$}
