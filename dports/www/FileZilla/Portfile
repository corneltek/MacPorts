# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           wxWidgets 1.0

name                FileZilla
version             3.8.1
set nightly_date    2014-06-17
revision            1
categories          www aqua
platforms           darwin
maintainers         mojca strasweb.fr:rudloff openmaintainer
license             GPL-2+

description         Open-source FTP, FTPS, and SFTP client

long_description    FileZilla Client is a fast and reliable cross-platform \
                    FTP, FTPS and SFTP client with lots of useful features \
                    and an intuitive graphical user interface.

homepage            https://filezilla-project.org/
# temporary switch to nightly versions until wxWidgets 3.0 support
# master_sites      sourceforge:project/filezilla/FileZilla_Client/${version}
master_sites        https://filezilla-project.org/nightlies/${nightly_date} \
                    https://trac.macports.org/raw-attachment/ticket/44126

checksums           rmd160  ff65842f17888b9492c706ca8eb10fcb6e46b291 \
                    sha256  896b189cc043dbf31a9bff547fc8e5c5e643bd08ab4efac424e1fbe742e19a78

depends_build       port:pkgconfig

#wxWidgets.use      wxWidgets-3.0

depends_lib         port:dbus \
                    port:gettext \
                    port:gmp \
                    port:gnutls \
                    port:libgpg-error \
                    port:libgcrypt \
                    port:libiconv \
                    port:libidn \
                    port:nettle \
                    port:sqlite3 \
                    port:xdg-utils
#                   port:${wxWidgets.port}

# distname          ${name}_${version}_src
# TODO: just for the nightly
distname            FileZilla3-src
dist_subdir         ${name}/${nightly_date}

use_bzip2           yes
worksrcdir          filezilla-${version}

patchfiles          patch-configure.diff

# http://trac.filezilla-project.org/ticket/5473
# http://sourceforge.net/p/tinyxml/patches/51/
configure.args      --with-tinyxml=builtin \
                    --disable-manualupdatecheck \
                    --disable-autoupdatecheck
#                   --with-wxdir=${wxWidgets.wxdir}

#configure.env-append \
#                    WXRC=${wxWidgets.wxrc}
#
#destroot {
#    copy ${worksrcpath}/FileZilla.app ${destroot}${applications_dir}
#}

# gcc 4.2 doesn't suffice to build FileZilla on 10.6 and earlier
# newer gcc compilers should also work
if {${os.major} <= 10} {
    compiler.whitelist macports-clang-3.4 macports-clang-3.3 macports-clang-3.5
}

variant wxgtk30 conflicts wxwidgets30 description {Use wxWidgets 3.0 with GTK} {
    wxWidgets.use           wxGTK-3.0
    depends_lib-append      port:${wxWidgets.port}
    configure.args-append   --with-wxdir=${wxWidgets.wxdir}
    configure.env-append    WXRC=${wxWidgets.wxrc}
}

variant wxwidgets30 conflicts wxgtk30 description {Use wxWidgets 3.0} {
    wxWidgets.use           wxWidgets-3.0
    depends_lib-append      port:${wxWidgets.port}
    configure.args-append   --with-wxdir=${wxWidgets.wxdir}
    configure.env-append    WXRC=${wxWidgets.wxrc}
    destroot {              copy ${worksrcpath}/FileZilla.app ${destroot}${applications_dir} }
}

if {![variant_isset wxwidgets30] && ![variant_isset wxgtk30]} {
    default_variants +wxwidgets30
}

livecheck.type      regex
livecheck.url       ${homepage}download.php?type=client
livecheck.regex     /${name}_(\[0-9.\]+)
