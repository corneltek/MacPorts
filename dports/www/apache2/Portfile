# $Id: Portfile,v 1.4 2003/10/31 09:05:18 fkr Exp $

PortSystem 1.0
name		apache2
version		2.0.48
categories	www
platforms	darwin freebsd
maintainers	jcorley1@nc.rr.com
description	The extremely popular second version of the Apache http server 
long_description	Apache is an HTTP server designed as a plug-in replacement for \
			the NCSA server version 1.3 (or 1.4). It fixes numerous bugs in \
			the NCSA server and includes many frequently requested new \
			features, and has an API which allows it to be extended to meet \
			users' needs more easily. This is version 2.0.47 of Apache.

master_sites	http://www.tux.org/pub/net/apache/dist/httpd/ \
		http://apache.mirror.digitalspace.net/httpd/ \
		http://www.apache.inetcosmos.org/dist/httpd/ \
		http://www.rge.com/pub/infosystems/apache/httpd/ \
		http://www.tux.org/pub/net/apache/dist/httpd/ \
		http://apache.mirror.digitalspace.net/httpd/ \
		http://www.rge.com/pub/infosystems/apache/httpd/ \
		http://ftp.epix.net/apache/httpd/

distname	httpd-${version}
checksums	md5 466c63bb71b710d20a5c353df8c1a19c
depends_lib	lib:libapr-0.0:apr lib:libaprutil-0.0:apr-util
patchfiles	patch-httpd-std.conf.in

configure.pre_args --prefix=${prefix}/${name}

configure.args	--with-layout=FreeBSD --with-apr=${prefix}/bin/apr-config \
		--with-apr-util=${prefix}/bin --enable-mods-shared=all --enable-ssl --with-ssl \
		--enable-deflate --enable-proxy --enable-proxy-connect \
		--enable-proxy-http --enable-proxy-ftp

destroot.args	root=${destroot}

variant activate_server {
    		depends_run     path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup
    		post-patch { 	system "sed -e \"s=%%PREFIX%%=${prefix}/${name}=g\" \
                      			${filespath}/${name}.sh > \
                      			${worksrcdir}/${name}.sh" }

}

post-destroot {	
	
	system "mv ${destroot}${prefix}/${name}/conf/httpd.conf \
				${destroot}${prefix}/${name}/conf/httpd.conf.sample"
	system "touch ${destroot}${prefix}/${name}/logs/.turd"
	system "test -L ${destroot}${prefix}/${name}/build/libtool \
		|| ln -s /usr/bin/glibtool \
		${destroot}${prefix}/${name}/build/libtool"

	if { [variant_isset activate_server] } {
		file mkdir ${destroot}${prefix}/etc/rc.d/
		system "install -bC ${portpath}/${workdir}/${name}.sh \
			${destroot}${prefix}/etc/rc.d/"
	} 
}
