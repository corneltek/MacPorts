# $Id: Portfile,v 1.1 2003/06/05 10:07:02 fkr Exp $

PortSystem 1.0
name		apache2
version		2.0.46
categories	www
platforms	darwin freebsd
maintainers	jcorley1@nc.rr.com
description	The extremely popular second version of the Apache http server 
long_description	Apache is an HTTP server designed as a plug-in replacement for \
			the NCSA server version 1.3 (or 1.4). It fixes numerous bugs in \
			the NCSA server and includes many frequently requested new \
			features, and has an API which allows it to be extended to meet \
			users' needs more easily. This is version 2.0.45 of Apache.

master_sites	http://www.tux.org/pub/net/apache/dist/httpd/ \
		http://apache.mirror.digitalspace.net/httpd/ \
		http://www.apache.inetcosmos.org/dist/httpd/ \
		http://www.rge.com/pub/infosystems/apache/httpd/ \
		http://www.tux.org/pub/net/apache/dist/httpd/ \
		http://apache.mirror.digitalspace.net/httpd/ \
		http://www.rge.com/pub/infosystems/apache/httpd/ \
		http://ftp.epix.net/apache/httpd/

distname	httpd-${version}
checksums	md5 ff682f82f0808eb01df60824d959ebe8
depends_lib	lib:libapr-0.0:apr lib:libaprutil-0.0:apr-util
patchfiles	patch-httpd-std.conf.in
configure.env	CC=/usr/bin/gcc CPP=/usr/bin/cpp
configure.args	--with-layout=FreeBSD --with-apr=${prefix}/bin/apr-config \
		--with-apr-util=${prefix}/bin --prefix=${prefix}/${name} \
		--enable-mods-shared=all --enable-ssl --with-ssl \
		--enable-deflate --enable-proxy --enable-proxy-connect \
		--enable-proxy-http --enable-proxy-ftp

install.args	root=${destroot}
post-install { 	system "touch ${destroot}${prefix}/${name}/logs/.turd"
		system "test -L ${destroot}${prefix}/${name}/build/libtool \
                        || ln -s /usr/bin/glibtool \
                        ${destroot}${prefix}/${name}/build/libtool" }

variant activate_server {
    		depends_run     path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup
    		post-patch { 	system "sed -e \"s=%%PREFIX%%=${prefix}/${name}=g\" \
                      			${filespath}/${name}.sh > \
                      			${worksrcdir}/${name}.sh" }

    		post-install-append {	file mkdir ${destroot}${prefix}/etc/rc.d/
                    			system "install -bC ${portpath}/${workdir}/${name}.sh \
                      				${destroot}${prefix}/etc/rc.d/"} }
