# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                phpmyadmin
set my_name         phpMyAdmin
version             3.5.2
categories          www php databases
maintainers         ryandesign openmaintainer
license             GPL-2+
supported_archs     noarch

description         A tool written in PHP intended to handle the \
                    administration of MySQL over the Web.
long_description    phpMyAdmin is a tool written in PHP intended to handle \
                    the administration of MySQL over the Web. phpMyAdmin \
                    supports a wide range of operations with MySQL. The most \
                    frequently used operations are supported by the user \
                    interface (managing databases, tables, fields, relations, \
                    indexes, users, permissions, etc), while you still have \
                    the ability to directly execute any SQL statement.
homepage            http://www.phpmyadmin.net/
master_sites        sourceforge:project/phpmyadmin/phpMyAdmin/${version}
distname            ${my_name}-${version}-all-languages
use_xz              yes

checksums           rmd160  e53adf2e67c6abe0903c8be1501aa5b6e53f9c38 \
                    sha256  da0ad60553626c329425033716e29fec9befe544a83ee2c4b3d106600df24774

platforms           darwin freebsd

# The php variants deliberately do not conflict

variant php5 description {Use php5} {
    depends_run-append  port:php5-gd \
                        port:php5-mbstring \
                        port:php5-mcrypt \
                        port:php5-mysql \
                        port:php5-zip
}

variant php53 description {Use php53} {
    depends_run-append  port:php53-gd \
                        port:php53-mbstring \
                        port:php53-mcrypt \
                        port:php53-mysql \
                        port:php53-zip
}

variant php54 description {Use php54} {
    depends_run-append  port:php54-gd \
                        port:php54-mbstring \
                        port:php54-mcrypt \
                        port:php54-mysql \
                        port:php54-zip
}

if {![variant_isset php5] && ![variant_isset php53] && ![variant_isset php54]} {
    default_variants +php5
}

set docroot         ${destroot}${prefix}/www/${name}
set configfile      ${prefix}/www/${name}/config.inc.php
set configsample    ${prefix}/www/${name}/config.sample.inc.php

use_configure       no
build               {}

destroot {
    xinstall -d -m 0755 ${docroot}
    eval copy [glob ${worksrcpath}/*] ${docroot}
}

notes "
phpMyAdmin must be configured before it can be used.\
Consult the documentation at file://${prefix}/www/phpmyadmin/Documentation.html#config

A sample configuration file is installed at ${configsample}, but you mustnâ€™t edit this file.\
The file to edit is the real configuration file at ${configfile}.
"

pre-activate {
    if {[file exists ${configfile}]} {
        notes-append "\n\nYour existing config file has not been modified. You should manually compare the new sample config file with your existing config file."
    }
}

post-activate {
    if {![file exists ${configfile}]} {
        xinstall -m 644 ${configsample} ${configfile}
    }
}

livecheck.type      regex
livecheck.url       ${homepage}home_page/version.php
livecheck.regex     {^([0-9.]+)$}
