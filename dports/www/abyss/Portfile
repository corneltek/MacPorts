# $Id: Portfile,v 1.1 2004/01/07 09:21:00 pguyot Exp $

PortSystem 1.0
name			abyss
version			0.3
categories		www
maintainers		pguyot@kallisys.net
description		HTTP/1.1 compliant web server for
long_description	\
				ABYSS aims to be a fully HTTP/1.1 compliant web server. \
				Its main design goals are speed, low resource usage and \
				portability. ABYSS works on most UNIX based systems and \
				on Win32 systems (Win95/98/2000/NT).
homepage		http://abyss.sourceforge.net/
platforms		darwin
master_sites	sourceforge:abyss
checksums		md5 ca2dc7618e17dae8eea23c02dd3bbf9d
patchfiles		patch-src-data.c patch-src-server.c patch-conf-abyss.conf patch-src-conn.c
worksrcdir		${name}
post-patch {
	reinplace "s|__PREFIX|${prefix}|g" ${worksrcpath}/conf/abyss.conf
}
configure {}
build { system "cd ${worksrcpath}/src/ && make" }

depends_run	path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup

destroot {
	system "install -o root -m 0755 -p ${worksrcpath}/bin/abyss ${destroot}${prefix}/sbin/"
	system "install -d -o nobody -m 0755 ${destroot}${prefix}/share/abyss/"
	system "install -d -o nobody -m 0755 ${destroot}${prefix}/share/abyss/log/"
	system "touch ${destroot}${prefix}/share/abyss/log/access.log"
	system "install -d -o nobody -m 0755 ${destroot}${prefix}/share/abyss/conf/"
	system "install -o root -m 0644 -p ${worksrcpath}/conf/* ${destroot}${prefix}/share/abyss/conf/"
	system "install -d -o root -m 0755 ${destroot}${prefix}/share/abyss/htdocs/"
	system "install -o root -m 0644 ${portpath}/files/index.html ${destroot}${prefix}/share/abyss/htdocs/"
	system "install -o root -m 755 -d ${destroot}${prefix}/etc/rc.d"
	system "install -o root -m 755 -c \
		${portpath}/files/abyss.sh ${destroot}${prefix}/etc/rc.d"
	reinplace "s|__PREFIX|${prefix}|g" \
		${destroot}${prefix}/etc/rc.d/abyss.sh
}