# $Id: Portfile,v 1.1 2004/01/14 07:18:02 blb Exp $
PortSystem			1.0
name				mnogosearch
version				3.2.15
categories			www
maintainers			blb@pobox.com
description			Full-featured SQL-based web search engine

long_description \
	mnoGoSearch is a full-featured SQL-based web search engine. \
	mnoGoSearch consists of two parts. The first part is the indexing \
	mechanism (indexer).  indexer walks over html hypertext references and \
	stores found words and new references into a database. The second part \
	is the web CGI front-end to provide searching using data collected by \
	indexer.

homepage			http://www.mnogosearch.org/

master_sites    	http://www.mnogosearch.org/Download/ \
					http://distfiles.opendarwin.org/:lt

platforms			darwin
distfiles-append	ltconfig13:lt ltmain13:lt
checksums			${distname}${extract.suffix} md5 87ec6a854850d4df87ca888fa919e1b9 \
					ltconfig13 md5 ea53f42a550c9f9e653758a8ed91574e \
					ltmain13 md5 e094ae92724c4015dbab97de151c2525

extract.only		${distname}${extract.suffix}

patchfiles			patch-configure patch-doc_Makefile.in

post-patch {
	file copy -force ${distpath}/ltconfig13 ${worksrcpath}/ltconfig
	file copy -force ${distpath}/ltmain13 ${worksrcpath}/ltmain.sh
}

configure.env		CPPFLAGS="-I${prefix}/include" LDFLAGS="-L${prefix}/lib"
configure.args		--sysconfdir=${prefix}/etc/mnogosearch \
					--localstatedir=${prefix}/var/mnogosearch \
					--datadir=${prefix}/share/mnogosearch \
					--mandir=${prefix}/share/man --disable-static

post-configure {
	ui_msg "\n\n-------------------------------------------------------------"
	ui_msg "Note:  if you did not select any database variants, mnogosearch"
	ui_msg "will be built without the indexer (which may not be what you"
	ui_msg "wanted)."
	ui_msg "-------------------------------------------------------------\n\n"
}

variant mysql {
	depends_lib-append		lib:libmysqlclient:mysql
	configure.args-append	--with-mysql=${prefix}
}

variant mysql4 {
	depends_lib-append		lib:libmysqlclient:mysql4
	configure.args-append	--with-mysql=${prefix}
}

# Other database variants would go here

variant expat {
	depends_lib-append		lib:libexpat:expat
	configure.args-append	--with-expat
}

variant nosyslog {
	configure.args-append	--disable-syslog
}

variant ssl {
	depends_lib-append		lib:libssl:openssl
	configure.args-append	--with-openssl
}

variant zlib {
	depends_lib-append		lib:libz:zlib
	configure.args-append	--with-zlib
}

post-destroot {
	set mnogovar	"${destroot}${prefix}/var/mnogosearch"
	# XXX another .turd hack...
	system "touch ${mnogovar}/raw/.turd ${mnogovar}/splitter/.turd"
	system "touch ${mnogovar}/tree/.turd ${mnogovar}/cache/.turd"
	system "touch ${mnogovar}/store/.turd"
}

