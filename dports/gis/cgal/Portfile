# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           cmake 1.0

name                cgal
version             4.6
license             LGPL-3+ GPL-3+
categories          gis science
maintainers         vince
description         Computational Geometry Algorithm Library
long_description    \
                    The goal of the CGAL is to provide easy access to\
                    efficient and reliable geometric algorithms in the\
                    form of a C++ library. CGAL is used in various areas\
                    needing geometric computation, such as: computer\
                    graphics, scientific visualization, computer aided\
                    design and modeling, geographic information systems,\
                    molecular biology, medical imaging, robotics and\
                    motion planning, mesh generation, numerical methods...

platforms           darwin
homepage            http://www.cgal.org/

fetch.ignore_sslcert     yes
master_sites        https://gforge.inria.fr/frs/download.php/file/34705/CGAL-4.6.tar.xz

distname            CGAL-${version}
checksums           rmd160  7a37a50cb2824e6b19deae93c3a2e006ca332682 \
                    sha256  e5cd67ca3b78583154885bb4fde15450e902ec03c8558cc62f7fb793b1586e56

use_xz              yes

worksrcdir          CGAL-${version}
depends_lib-append  port:boost \
                    port:mpfr \
                    port:zlib \
                    port:gmp \
                    port:eigen3

configure.args-append   -DCGAL_INSTALL_CMAKE_DIR="share/CGAL/cmake" \
                        -DWITH_CGAL_Qt3:BOOL=OFF \
                        -DWITH_CGAL_Qt4:BOOL=OFF \
                        -DBoost_DIR:PATH=${prefix} \
                        -DWITH_Eigen3:BOOL=ON \
                        -DWITH_ZLIB:BOOL=ON

# gcc 4.0 is too old to compile CGAL properly; see <http://www.cgal.org/FAQ.html#mac_optimization_bug>
compiler.blacklist-append gcc-4.0

variant perf description    {optimize code for current arch} {
    configure.compiler      macports-clang-3.5
    configure.optflags      -O3 -pipe -march=native
}

variant debug description {Build with debug symbols} {
    configure.args-delete   -DCMAKE_BUILD_TYPE=Release
    configure.args-append   -DCMAKE_BUILD_TYPE=Debug

    post-destroot {
        eval exec dsymutil  [glob ${destroot}${prefix}/lib/*.dylib]
    }
}

variant qt4 description {Build with Qt4 bindings} {
    PortGroup               qt4 1.0

    configure.args-delete   -DWITH_CGAL_Qt3:BOOL=OFF \
                            -DWITH_CGAL_Qt4:BOOL=OFF
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     CGAL-(\[0-9.\]+)\ is\ released
