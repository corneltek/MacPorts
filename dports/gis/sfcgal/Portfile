# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 111992 2013-10-08 19:34:50Z vince@macports.org $

PortSystem          1.0
PortGroup           cmake   1.0
PortGroup           qt4     1.0

name                sfcgal
version             1.0
categories          gis
maintainers         vince
description         SFCGAL links CGAL to PostGIS
long_description    SFCGAL (“Simple Features for CGAL”)\
                    is a library that provides a SF-SQL API\
                    to some CGAL routines, thereby enabling spatial\
                    databases such as PostGIS to rely on CGAL to\
                    perform 2D and 3D geometry operations (union,\
                    intersections, buffering, etc.).

platforms           darwin
license             GPL

use_parallel_build  no
homepage            http://www.sfcgal.org/

master_sites        https://github.com/Oslandia/SFCGAL/archive
distname            v${version}

checksums           md5     3f94d79556224581aa08c7893291a908 \
                    sha1    bfc8ab24ad63668b4bb50e9c32eaa1e302a803c4 \
                    rmd160  64bcb0ead503bc5fadf628a261f1d13906a8e27d

#patchfiles          patch-qgsmapcanvas_h.diff \

worksrcdir          SFCGAL-${version}

depends_lib-append  port:cgal \
                    port:mpfr \
                    port:gmp 

# Variants

variant viewer description {builds a Qt4-based viewer} {

    PortGroup               qt4 1.0
    depends_lib-append      port:openscenegraph
    configure.args-append   -DSFCGAL_BUILD_VIEWER=ON
}

variant examples description {builds examples} {

    configure.args-append   -DSFCGAL_BUILD_EXAMPLES=ON
}

post-configure {
    reinplace -E "s|(.*)|\\1 -F /opt/local/Library/Frameworks -lQtCore -lQtOpenGL -lQtGui|" \
        ${worksrcpath}/viewer/CMakeFiles/viewer-SFCGAL.dir/link.txt
}

use_parallel_build          yes
destroot.target             install

post-destroot {
    system -W ${destroot}/${prefix}/include "rm -rf CGAL"
}
