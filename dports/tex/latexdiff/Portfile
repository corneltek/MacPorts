# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                latexdiff
version             1.0.3
revision            1
categories          tex
maintainers         nomaintainer
license             GPL-2
platforms           darwin
supported_archs     noarch
description         determine and mark up significant differences between latex files
long_description    \
    latexdiff is a Perl script, which compares two latex files and marks up \
    significant differences between them (i.e. a diff for latex files). Various \
    options are available for visual markup using standard latex packages such \
    as \"color.sty\". Changes not directly affecting visible text, for example in \
    formatting commands, are still marked in the latex source.

homepage            http://www.ctan.org/pkg/latexdiff
master_sites        tex_ctan:support
distname            ${name}
dist_subdir         ${name}/${version}
use_zip             yes

checksums           rmd160  e7b3e085869b1173a4b764bfaaaf3f62b1e9c33f \
                    sha256  34ec0e39f974273695d72eac92c0a16e55dc534f5011258a70c99e19e830d9ad

depends_run         path:bin/perl5.16:perl5.16 \
                    port:p5.16-algorithm-diff

configure {
    reinplace "s|/usr/bin/env perl|${prefix}/bin/perl5.16|g" \
    ${worksrcpath}/latexdiff-so ${worksrcpath}/latexdiff-vc \
    ${worksrcpath}/latexdiff-fast ${worksrcpath}/latexdiff \
    ${worksrcpath}/latexrevise
}

build               {}

destroot.destdir    INSTALLPATH=${destroot}${prefix} \
                    INSTALLMANPATH=${destroot}${prefix}/share/man

destroot {
    # install scripts
    xinstall -m 755 ${worksrcpath}/latexdiff ${destroot}${prefix}/bin
    xinstall -m 755 ${worksrcpath}/latexdiff-fast ${destroot}${prefix}/bin
    xinstall -m 755 ${worksrcpath}/latexdiff-so ${destroot}${prefix}/bin
    xinstall -m 755 ${worksrcpath}/latexdiff-vc ${destroot}${prefix}/bin
    xinstall -m 755 ${worksrcpath}/latexrevise ${destroot}${prefix}/bin

    # install man pages
    xinstall -m 644 ${worksrcpath}/latexdiff.1 ${destroot}${prefix}/share/man/man1
    xinstall -m 644 ${worksrcpath}/latexdiff-vc.1 ${destroot}${prefix}/share/man/man1
    xinstall -m 644 ${worksrcpath}/latexrevise.1 ${destroot}${prefix}/share/man/man1

    # install docs
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/doc/latexdiff-man.pdf ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/doc/latexdiff-man.tex ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/doc/example-diff.tex ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/COPYING ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/README ${destroot}${prefix}/share/doc/${name}

    # install examples
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}/example
    xinstall -m 644 ${worksrcpath}/example/example-draft.tex ${destroot}${prefix}/share/doc/${name}/example
    xinstall -m 644 ${worksrcpath}/example/example-rev.tex ${destroot}${prefix}/share/doc/${name}/example
}

pre-activate {
    # texlive-bin-extra used to contain latexdiff, but doesn't
    # anymore. If the old version is installed, deactivate it to avoid
    # a conflict.
    if {[file exists $prefix/bin/latexdiff]
        && ![catch {set vers [lindex [registry_active texlive-bin-extra] 0]}]
        && [vercmp [lindex $vers 1] 19536] < 0} {
        registry_deactivate_composite texlive-bin-extra "" [list ports_nodepcheck 1]
    }
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     "<td>(\\d+(\\.\\d+)*) ?</td>"
