# $Id: Portfile,v 1.1 2003/12/06 23:35:27 fkr Exp $

PortSystem 1.0
name		libmatroska
version		0.6.1
categories	multimedia
maintainers	pguyot@kallisys.net
description	Matroska is an extensible open standard audio/video container format.
long_description	Matroska is an extensible open standard audio/video container \
			format. This library is there to support this format and has \
			been written by the Matroska project team.
				
homepage	http://www.matroska.org/
platforms	darwin
master_sites	http://matroska.free.fr/downloads/libmatroska/
checksums	md5 61d5665e7c1050aa934aecc57cf392cd

depends_lib	lib:libebml.a:libebml
test.run	yes

configure	{}
post-extract {	cd "${worksrcpath}/make"
		system "cp -r linux darwin" }

build {		cd "${worksrcpath}/make/darwin"
		system "make prefix=${prefix} LIBEBML_INCLUDE_DIR=${prefix}/include \
				LIBEBML_LIB_DIR=${prefix}/lib lib" }

# these tests don't work in the destroot, thus are done in build-area.
# I'm not sure if I can compare the output of test8 with some master file which I cannot find.
test {	cd "${worksrcpath}/make/darwin"	
	system "make prefix=${destroot}${prefix} LIBEBML_INCLUDE_DIR=${prefix}/include \
			LIBEBML_LIB_DIR=${prefix}/lib test"
	system "./test6"
	system "./test8"
	system "./test9" }

destroot {	cd "${worksrcpath}/make/darwin"
		# We need -p for install because ld will ask for ranlib if the modification date changes.
		system "make prefix=${destroot}${prefix} INSTALL_OPTS_LIB='-m 644 -p' install" }
