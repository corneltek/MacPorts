# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                libmatroska
version             1.4.1
categories          multimedia
license             LGPL-2+
maintainers         ryandesign openmaintainer
description         Matroska is an extensible open standard audio/video container format.
long_description    \
                    Matroska is an extensible open standard audio/video container \
                    format. This library is there to support this format and has \
                    been written by the Matroska project team.
                
homepage            http://www.matroska.org/
platforms           darwin
master_sites        http://dl.matroska.org/downloads/${name}/
use_bzip2           yes

checksums           rmd160  5074e5b3005ab6c12261bd0cfa2ce51bd271de78 \
                    sha256  086f21873e925679babdabf793c3bb85c353d0cd79423543a3355e08e8a4efb7

depends_build       port:libebml

post-extract {
    copy ${worksrcpath}/make/linux ${worksrcpath}/make/darwin
}

use_configure       no

variant universal {}

set cxx_stdlibflags {}
if {[string match *clang* ${configure.cxx}]} {
    set cxx_stdlibflags -stdlib=${configure.cxx_stdlib}
}

build.dir           ${worksrcpath}/make/darwin
build.args          prefix=${prefix} \
                    CXX=${configure.cxx} \
                    CXXFLAGS="[get_canonical_archflags cxx] ${cxx_stdlibflags}" \
                    LIBEBML_INCLUDE_DIR=${prefix}/include \
                    LIBEBML_LIB_DIR=${prefix}/lib

test.run            yes
test.cmd            ./test6 && ./test8 && ./test9
test.target

# We need -p for install because ld will ask for ranlib if the modification date changes.
destroot.args       INSTALL_OPTS_LIB='-m 644 -p'
destroot.destdir    prefix=${destroot}${prefix}

livecheck.type      regex
livecheck.url       [lindex ${master_sites} 0]
livecheck.regex     >${name}-(\[0-9.\]+)${extract.suffix}
