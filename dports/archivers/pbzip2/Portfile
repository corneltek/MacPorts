# $Id$

PortSystem        1.0

name              pbzip2
version           1.1.10
revision          1
set branch        [join [lrange [split ${version} .] 0 1] .]
categories        archivers
platforms         darwin
maintainers       ryandesign openmaintainer
license           Permissive
installs_libs     no

description       parallel bzip2
long_description  PBZIP2 is a parallel implementation of the bzip2 \
  block-sorting file compressor that uses pthreads and achieves \
  near-linear speedup on SMP machines.

homepage          http://compression.ca/pbzip2/
master_sites      https://launchpad.net/pbzip2/${branch}/${version}/+download/

depends_lib       port:bzip2

checksums         rmd160 4a090d8b0ada8310400979fed75d4fe02cd20c8d \
                  sha256 9d489191edd010e4c8f7bc86de88268cdc3da5a9f7904b257fda56941615a0c2

patchfiles        patch-Makefile.diff

use_configure     no

variant universal {}

build.env-append  CXX="${configure.cxx}" \
                  CXXFLAGS="${configure.cxxflags} [get_canonical_archflags cxx]" \
                  LDFLAGS="${configure.ldflags} [get_canonical_archflags ld]"

destroot.destdir  PREFIX=${destroot}${prefix}

post-destroot {
  delete ${destroot}${prefix}/bin/pbunzip2
  delete ${destroot}${prefix}/bin/pbzcat
  ln -s pbzip2 ${destroot}${prefix}/bin/pbunzip2
  ln -s pbzip2 ${destroot}${prefix}/bin/pbzcat

  set docdir ${prefix}/share/doc/${subport}
  xinstall -d ${destroot}${docdir}
  xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING ChangeLog README \
    ${destroot}${docdir}
}

livecheck.type    regex
livecheck.url     https://launchpad.net/pbzip2
livecheck.regex   {pbzip2-(\d+(?:\.\d+)*).tar.gz}
