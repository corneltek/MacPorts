# $Id$

PortSystem      1.0

name            p7zip
version         9.38
categories      archivers
# contains unrar code which has a restrictive license
license         LGPL-2.1+ Restrictive/Distributable
maintainers     gmail.com:stuartwesterman openmaintainer
platforms       darwin
description     7-Zip implementation

long_description \
    p7zip is a port of 7-Zip, a file archiver with \
    highest compression ratio.

homepage        http://p7zip.sourceforge.net/

master_sites    sourceforge:project/${name}/${name}/${version}
distname        [strsed ${distname} {g/-/_/}]
use_bzip2       yes
distfiles       ${distname}_src_all${extract.suffix}

checksums       rmd160  ae7fc4f25c602644838667bd8c09038bda035024 \
                sha256  a73bae37461c8e51ac8ad7db186f82c8fb7d1e140098efe21a9f0e95d68ab957

variant universal {}

configure {
    copy -force ${worksrcpath}/makefile.macosx_32bits ${worksrcpath}/makefile.machine
    reinplace "s|^CXX=c++|CXX=${configure.cxx}|g" \
            ${worksrcpath}/makefile.machine
    reinplace "s|^CC=cc|CC=${configure.cc}|g" \
            ${worksrcpath}/makefile.machine
    reinplace "s|-m32||g" \
            ${worksrcpath}/makefile.machine
    reinplace "s|\$(LOCAL_FLAGS)|[get_canonical_archflags] \$(LOCAL_FLAGS)|g" \
            ${worksrcpath}/makefile.machine
}

# build 7za, 7z and 7zr
build.target all3

destroot.destdir    DEST_HOME=${prefix} \
                    DEST_SHARE_DOC=${prefix}/share/doc/${name}-${version} \
                    DEST_MAN=${prefix}/share/man \
                    DEST_DIR=${destroot}
