--- Makefile.orig	2013-02-20 21:06:34.000000000 +0100
+++ Makefile	2013-02-20 22:48:49.000000000 +0100
@@ -1,7 +1,7 @@
 VERSION=2.9
 
 CC=gcc
-CFLAGS=-Wall -Wno-pointer-sign -g $(CLCFLAGS) -DGSEAL_ENABLE
+CFLAGS=-Wall -Wno-pointer-sign -g $(CLCFLAGS) -DGSEAL_ENABLE $(EXTRACFLAGS)
 INSTALL=install
 PKGCONFIG=pkg-config
 XML2CONFIG=xml2-config
@@ -9,7 +9,7 @@
 
 # these locations seem to work for SuSE and Fedora
 # prefix = $(HOME)
-prefix = $(DESTDIR)/usr
+#prefix = $(DESTDIR)/usr
 BINDIR = $(prefix)/bin
 DATADIR = $(prefix)/share
 DESKTOPDIR = $(DATADIR)/applications
@@ -53,8 +53,8 @@
 	LIBDIVECOMPUTERINCLUDES = $(shell $(PKGCONFIG) --cflags libdivecomputer)
 	LIBDIVECOMPUTERARCHIVE = $(shell $(PKGCONFIG) --libs libdivecomputer)
 else
-libdc-local := $(wildcard /usr/local/lib/libdivecomputer.a)
-libdc-local64 := $(wildcard /usr/local/lib64/libdivecomputer.a)
+libdc-local := $(wildcard $(prefix)/lib/libdivecomputer.a)
+libdc-local64 := $(wildcard $prefix)/lib64/libdivecomputer.a)
 libdc-usr := $(wildcard /usr/lib/libdivecomputer.a)
 libdc-usr64 := $(wildcard /usr/lib64/libdivecomputer.a)
 
@@ -122,7 +122,7 @@
 else ifeq ($(UNAME), darwin)
 	OSSUPPORT = macos
 	OSSUPPORT_CFLAGS = $(GTKCFLAGS)
-	MACOSXINSTALL = /Applications/Subsurface.app
+	MACOSXINSTALL = ${mpappdir}/Subsurface.app
 	MACOSXFILES = packaging/macosx
 	MACOSXSTAGING = $(MACOSXFILES)/Subsurface.app
 	INFOPLIST = $(MACOSXFILES)/Info.plist
