From 63c8f7142c49007e9cb49ffcd73d85f8f4d71497 Mon Sep 17 00:00:00 2001
From: Jeremy Huddleston <jeremyhu@apple.com>
Date: Fri, 16 Mar 2012 17:03:54 -0700
Subject: [PATCH 2/3] darwin: Build create_context.c

Fixes a build regression from: 588042a8ec4ea91a952c07a0768516fd590758f4

Signed-off-by: Jeremy Huddleston <jeremyhu@apple.com>
(cherry picked from commit f9e1295cffc3cf096611e193cca016326715e6ca)
---
 src/glx/apple/Makefile   |    1 +
 src/glx/create_context.c |    7 ++++++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/glx/apple/Makefile b/src/glx/apple/Makefile
index 66e6658..dc64295 100644
--- a/src/glx/apple/Makefile
+++ b/src/glx/apple/Makefile
@@ -35,6 +35,7 @@ SOURCES = \
 	apple_xgl_api_stereo.c \
 	apple_xgl_api_viewport.c \
 	appledri.c \
+	../create_context.c \
 	../clientattrib.c \
 	../compsize.c \
 	../glxconfig.c \
diff --git a/src/glx/create_context.c b/src/glx/create_context.c
index 714f0e5..a1a55b3 100644
--- a/src/glx/create_context.c
+++ b/src/glx/create_context.c
@@ -80,8 +80,13 @@ glXCreateContextAttribsARB(Display *dpy, GLXFBConfig config,
 					       &dummy_err);
    }
 
-   if (gc == NULL)
+   if (gc == NULL) {
+#ifdef GLX_USE_APPLEGL
+      gc = applegl_create_context(psc, cfg, share, 0);
+#else
       gc = indirect_create_context(psc, cfg, share, 0);
+#endif
+   }
 
    gc->xid = xcb_generate_id(c);
    gc->share_xid = (share != NULL) ? share->xid : 0;
-- 
1.7.9.2

