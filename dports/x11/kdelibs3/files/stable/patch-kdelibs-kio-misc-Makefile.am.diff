--- kio/misc/Makefile.am	4 Jan 2003 04:31:49 -0000	1.1.1.4
+++ kio/misc/Makefile.am	1 Jun 2003 14:59:05 -0000	1.6
@@ -22,25 +22,29 @@
 
 SUBDIRS = . ksendbugmail kpac kdesasl kssld kfile
 
-lib_LTLIBRARIES = kio_uiserver.la
+lib_LTLIBRARIES = kio_uiserver.la libkio_uiserver_main.la
 bin_PROGRAMS = kio_uiserver kmailservice ktelnetservice
 
-kio_uiserver_SOURCES = dummy.cpp
-kio_uiserver_LDADD = kio_uiserver.la
-kio_uiserver_LDFLAGS = $(KDE_RPATH) $(all_libraries)
+libkio_uiserver_main_la_SOURCES = uiserver.cpp uiserver.skel observer.stub
+libkio_uiserver_main_la_LIBADD = $(LIB_KIO)
+libkio_uiserver_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+
+kio_uiserver_la_SOURCES = kio_uiserver_la_main.cpp
+kio_uiserver_la_LIBADD = libkio_uiserver_main.la
+kio_uiserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kio_uiserver_la_main.cpp: kio_uiserver_main.cpp
+	cat kio_uiserver_main.cpp > kio_uiserver_la_main.cpp
 
-kio_uiserver_la_SOURCES = uiserver.cpp uiserver.skel observer.stub
-kio_uiserver_la_LIBADD = $(LIB_KIO)
-kio_uiserver_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kio_uiserver_SOURCES = kio_uiserver_main.cpp
+kio_uiserver_LDADD = libkio_uiserver_main.la
+kio_uiserver_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 observer_DIR = $(top_srcdir)/kio/kio
 
 METASOURCES = AUTO
 
 kde_services_DATA = kio_uiserver.desktop
-
-dummy.cpp: uiserver.kidl
-	echo > dummy.cpp
 
 kmailservice_SOURCES = kmailservice.cpp
 kmailservice_LDADD = $(LIB_KDECORE)
