--- kioslave/http/Makefile.am	6 May 2003 17:24:55 -0000	1.1.1.5
+++ kioslave/http/Makefile.am	1 Jun 2003 14:59:05 -0000	1.6
@@ -8,7 +8,7 @@
 ####### Files
 
 bin_PROGRAMS = kio_http_cache_cleaner
-lib_LTLIBRARIES = kio_http_cache_cleaner.la
+lib_LTLIBRARIES = kio_http_cache_cleaner.la libkio_http_cache_cleaner_main.la
 kde_module_LTLIBRARIES = kio_http.la
 
 kio_http_la_SOURCES = http.cc httpfilter.cc
@@ -16,19 +16,26 @@
 kio_http_la_LIBADD = $(LIB_KIO) $(LIBZ)
 kio_http_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
-kio_http_cache_cleaner_SOURCES = dummy.cpp
-kio_http_cache_cleaner_LDADD   = kio_http_cache_cleaner.la
+kio_http_cache_cleaner_SOURCES = http_cache_cleaner_main.cpp
+kio_http_cache_cleaner_LDADD = libkio_http_cache_cleaner_main.la
 kio_http_cache_cleaner_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
-kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner.cpp
-kio_http_cache_cleaner_la_LIBADD  = $(LIB_KIO)
-kio_http_cache_cleaner_la_LDFLAGS = -module -avoid-version $(all_libraries)
+http_cache_cleaner_main.cpp: stub_main.cpp
+	cat stub_main.cpp > http_cache_cleaner_main.cpp
+
+kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner_la_main.cpp
+kio_http_cache_cleaner_la_LIBADD  = libkio_http_cache_cleaner_main.la
+kio_http_cache_cleaner_la_LDFLAGS = -avoid-version -module $(all_libraries)
+
+http_cache_cleaner_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > http_cache_cleaner_la_main.cpp
+
+libkio_http_cache_cleaner_main_la_SOURCES = http_cache_cleaner.cpp
+libkio_http_cache_cleaner_main_la_LIBADD  = $(LIB_KIO)
+libkio_http_cache_cleaner_main_la_LDFLAGS = -avoid-version $(all_libraries) -no-undefined
 
 noinst_HEADERS = http.h
 
 kdelnkdir = $(kde_servicesdir)
 kdelnk_DATA = http_cache_cleaner.desktop http.protocol https.protocol \
               webdav.protocol webdavs.protocol
-
-dummy.cpp:
-	echo > dummy.cpp
