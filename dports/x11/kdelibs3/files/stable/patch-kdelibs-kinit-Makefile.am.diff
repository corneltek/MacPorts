--- kinit/Makefile.am	10 Jul 2002 04:49:13 -0000	1.1.1.2
+++ kinit/Makefile.am	1 Jun 2003 14:59:04 -0000	1.5
@@ -20,7 +20,7 @@
 SUBDIRS = . tests
 
 bin_PROGRAMS = kdeinit kdeinit_wrapper kshell kdeinit_shutdown lnusertemp kwrapper klauncher kioslave
-lib_LTLIBRARIES = klauncher.la
+lib_LTLIBRARIES = klauncher.la libklauncher_main.la
 
 kdeinit_SOURCES = kinit.cpp setproctitle.cpp
 
@@ -49,13 +49,20 @@
 kwrapper_SOURCES = kwrapper.c
 kwrapper_LDADD = $(LIBSOCKET)
 
-klauncher_la_LDFLAGS = $(all_libraries) -module -avoid-version
-klauncher_la_LIBADD = $(LIB_KIO)
-klauncher_la_SOURCES = klauncher.cpp klauncher_main.cpp autostart.cpp
+libklauncher_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libklauncher_main_la_LIBADD = $(LIB_KIO)
+libklauncher_main_la_SOURCES = klauncher.cpp autostart.cpp
+
+klauncher_la_LDFLAGS = $(all_libraries) -avoid-version -module
+klauncher_la_LIBADD = $(LIB_KIO) libklauncher_main.la
+klauncher_la_SOURCES = klauncher_la_main.cpp
+
+klauncher_la_main.cpp: klauncher_main.cpp
+	cat klauncher_main.cpp > klauncher_la_main.cpp
 
 klauncher_LDFLAGS =  $(all_libraries) $(KDE_RPATH)
-klauncher_LDADD = klauncher.la
-klauncher_SOURCES = dummy.cpp
+klauncher_LDADD = libklauncher_main.la
+klauncher_SOURCES = klauncher_main.cpp
 
 METASOURCES = AUTO
 
@@ -64,6 +71,3 @@
 kwrapper.o: wrapper.c
 
 shell.o: wrapper.c
-
-dummy.cpp:
-	echo > dummy.cpp
