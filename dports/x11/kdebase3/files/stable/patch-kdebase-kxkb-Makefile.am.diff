--- kxkb/Makefile.am	29 Oct 2002 03:07:04 -0000	1.1.1.5
+++ kxkb/Makefile.am	1 Jun 2003 14:31:57 -0000	1.12
@@ -7,20 +7,30 @@
 
 bin_PROGRAMS = kxkb
 
-kxkb_SOURCES = dummy.cpp
+kxkb_SOURCES = kxkb_main.cpp
 kxkb_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kxkb_LDADD = kxkb.la -lxkbfile
+kxkb_LDADD = libkxkb_main.la
 
-lib_LTLIBRARIES = kxkb.la
+kxkb_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kxkb_main.cpp
+
+lib_LTLIBRARIES = kxkb.la libkxkb_main.la
 kde_module_LTLIBRARIES = kcm_keyboard.la
 
 kcm_keyboard_la_SOURCES = rules.cpp kcmlayout.cpp pixmap.cpp kcmmisc.cpp kcmmiscwidget.ui
 kcm_keyboard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
 kcm_keyboard_la_LIBADD = $(XTESTLIB) $(LIB_KIO) -lxkbfile
 
-kxkb_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
-kxkb_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kxkb_la_LIBADD = -lX11 -lXext $(LIB_KDEUI) -lxkbfile
+libkxkb_main_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
+libkxkb_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkxkb_main_la_LIBADD = $(LIB_X11) $(LIB_XEXT) $(LIB_KDEUI) -lxkbfile $(LIB_QT) -lDCOP -lkdecore
+
+kxkb_la_SOURCES = kxkb_la_main.cpp
+kxkb_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kxkb_la_LIBADD = libkxkb_main.la
+
+kxkb_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kxkb_la_main.cpp
 
 data_DATA = keyboard.desktop
 datadir = $(kde_appsdir)/Settings/Peripherals
@@ -37,6 +47,3 @@
 messages: rc.cpp
 	$(XGETTEXT) $(kxkb_la_SOURCES) kxkbbindings.cpp -o $(podir)/kxkb.pot
 	$(XGETTEXT) rules.cpp kcmlayout.cpp pixmap.cpp kcmmisc.cpp rc.cpp kxkbbindings.cpp -o $(podir)/kcmlayout.pot 
-
-dummy.cpp:
-	echo > dummy.cpp
