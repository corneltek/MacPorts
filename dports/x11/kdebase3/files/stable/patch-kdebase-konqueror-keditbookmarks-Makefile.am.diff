--- konqueror/keditbookmarks/Makefile.am	29 Oct 2002 03:05:50 -0000	1.1.1.3
+++ konqueror/keditbookmarks/Makefile.am	1 Jun 2003 14:31:56 -0000	1.6
@@ -2,22 +2,29 @@
 
 METASOURCES = AUTO
 
-lib_LTLIBRARIES = keditbookmarks.la
+lib_LTLIBRARIES = keditbookmarks.la libkeditbookmarks_main.la
 
-keditbookmarks_la_SOURCES = main.cpp items.cpp toplevel.cpp favicons.cpp toplevel.skel commands.cpp
+libkeditbookmarks_main_la_SOURCES = main.cpp items.cpp toplevel.cpp favicons.cpp toplevel.skel commands.cpp
 kbookmarklistener_DIR = $(top_srcdir)/libkonq
 
-keditbookmarks_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la $(LIB_KHTML)
-keditbookmarks_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkeditbookmarks_main_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la $(LIB_KHTML)
+libkeditbookmarks_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+
+keditbookmarks_la_SOURCES = keditbookmarks_la_main.cpp
+keditbookmarks_la_LIBADD  = libkeditbookmarks_main.la
+keditbookmarks_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+keditbookmarks_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > keditbookmarks_la_main.cpp
 
 bin_PROGRAMS = keditbookmarks
 
-keditbookmarks_SOURCES = dummy.cpp
-keditbookmarks_LDADD = keditbookmarks.la
+keditbookmarks_SOURCES = keditbookmarks_main.cpp
+keditbookmarks_LDADD = libkeditbookmarks_main.la
 keditbookmarks_LDFLAGS = $(all_libraries)
 
-dummy.cpp:
-	echo > dummy.cpp
+keditbookmarks_main.cpp: stub_main.cpp
+	cat stub_main.cpp > keditbookmarks_main.cpp
 
 rcdir = $(kde_datadir)/keditbookmarks
 rc_DATA = keditbookmarksui.rc  
