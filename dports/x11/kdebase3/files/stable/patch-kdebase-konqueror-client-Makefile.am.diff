--- konqueror/client/Makefile.am	14 Aug 2002 14:30:59 -0000	1.1.1.2
+++ konqueror/client/Makefile.am	1 Jun 2003 14:31:56 -0000	1.8
@@ -1,12 +1,12 @@
 AM_CPPFLAGS = -DQT_NO_CAST_ASCII
 
 bin_PROGRAMS = kfmclient
-lib_LTLIBRARIES = kfmclient.la
+lib_LTLIBRARIES = kfmclient.la libkfmclient_main.la
 
 INCLUDES= -I.. $(all_includes)
-kfmclient_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kfmclient_la_LIBADD =  $(LIB_KIO)
-kfmclient_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
+libkfmclient_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+libkfmclient_main_la_LIBADD =  $(LIB_KIO) $(LIB_QT) -lkdecore -lDCOP -lkdeui
+libkfmclient_main_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
 
 noinst_HEADERS = kfmclient.h
 METASOURCES = AUTO
@@ -14,12 +14,19 @@
 KonquerorIface_DIR =  $(srcdir)/..
 KDesktopIface_DIR = $(top_srcdir)/kdesktop
 
-kfmclient_SOURCES = dummy.cc
+kfmclient_la_LDFLAGS = $(all_libraries) -avoid-version -module $(KDE_RPATH)
+kfmclient_la_LIBADD  = libkfmclient_main.la
+kfmclient_la_SOURCES = kfmclient_la_main.cpp
+
+kfmclient_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kfmclient_la_main.cpp
+
+kfmclient_SOURCES = kfmclient_main.cpp
 kfmclient_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kfmclient_LDADD = kfmclient.la
+kfmclient_LDADD   = libkfmclient_main.la
 
-dummy.cc:
-	echo > dummy.cc
+kfmclient_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kfmclient_main.cpp
 
 messages:
 	$(XGETTEXT) -kaliasLocal *.h *.cc -o $(podir)/kfmclient.pot
