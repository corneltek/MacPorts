--- kmenuedit/Makefile.am	14 Aug 2002 14:27:55 -0000	1.1.1.3
+++ kmenuedit/Makefile.am	1 Jun 2003 14:31:55 -0000	1.8
@@ -1,18 +1,24 @@
 INCLUDES = $(all_includes)
 
 bin_PROGRAMS = kmenuedit
-lib_LTLIBRARIES = kmenuedit.la
+lib_LTLIBRARIES = kmenuedit.la libkmenuedit_main.la
 
 CLEANFILES = dummy.cpp
 
-kmenuedit_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp main.cpp khotkeys.cpp
+libkmenuedit_main_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp khotkeys.cpp
+libkmenuedit_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) -lkdecore -lDCOP
+libkmenuedit_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
 
-kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-kmenuedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kmenuedit_la_SOURCES = main.cpp
+kmenuedit_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -avoid-version -module
+kmenuedit_la_LIBADD  = libkmenuedit_main.la
 
-kmenuedit_SOURCES = dummy.cpp
-kmenuedit_LDADD   = kmenuedit.la
+kmenuedit_SOURCES = kmenuedit_main.cpp
 kmenuedit_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kmenuedit_LDADD   = libkmenuedit_main.la
+
+kmenuedit_main.cpp: main.cpp
+	cat main.cpp > kmenuedit_main.cpp
 
 noinst_HEADERS = kmenuedit.h menueditview.h treeview.h desktopfileeditor.h basictab.h khotkeys.h
 
