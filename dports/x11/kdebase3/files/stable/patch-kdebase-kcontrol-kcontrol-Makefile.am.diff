--- kcontrol/kcontrol/Makefile.am	4 Jan 2003 04:47:31 -0000	1.1.1.6
+++ kcontrol/kcontrol/Makefile.am	1 Jun 2003 14:31:53 -0000	1.11
@@ -22,43 +22,69 @@
 
 SUBDIRS = . pics
 
-CLEANFILES = dummy.cpp
-
 bin_PROGRAMS = kcontrol kcmshell kcminit
-lib_LTLIBRARIES = kcontrol.la kcmshell.la kcminit.la
+lib_LTLIBRARIES = libkcontrol_main.la kcontrol.la libkcmshell_main.la kcmshell.la libkcminit_main.la kcminit.la
 
-kcontrol_la_SOURCES = main.cpp toplevel.cpp indexwidget.cpp searchwidget.cpp \
+libkcontrol_main_la_SOURCES = main.cpp toplevel.cpp indexwidget.cpp searchwidget.cpp \
 	helpwidget.cpp moduleinfo.cpp modules.cpp proxywidget.cpp \
 	modloader.cpp dockcontainer.cpp aboutwidget.cpp global.cpp \
 	quickhelp.cpp moduletreeview.cpp moduleiconview.cpp \
 	kecdialog.cpp kcrootonly.cpp moduleIface.cpp moduleIface.skel
+libkcontrol_main_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP -lkdefx
+libkcontrol_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+
+kcontrol_la_SOURCES = kcontrol_la_main.cpp
+kcontrol_la_LIBADD  = libkcontrol_main.la
+kcontrol_la_LDFLAGS = $(all_libraries) -avoid-version -module
 
-kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcontrol_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcontrol_la_main.cpp
 
-kcmshell_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
+libkcmshell_main_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
 			proxywidget.cpp kcdialog.cpp global.cpp \
 			kcdialog.skel
-kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libkcmshell_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libkcmshell_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
+
+kcmshell_la_SOURCES = kcmshell_la_main.cpp
+kcmshell_la_LIBADD = libkcmshell_main.la
+kcmshell_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+kcmshell_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcmshell_la_main.cpp
+
+libkcminit_main_la_SOURCES = kcminit.cpp global.cpp
+libkcminit_main_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libkcminit_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
 
+kcminit_la_SOURCES = kcminit_la_main.cpp
+kcminit_la_LIBADD  = libkcminit_main.la
+kcminit_la_LDFLAGS = $(all_libraries) -avoid-version -module
 
-kcminit_la_SOURCES = kcminit.cpp global.cpp
-kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcminit_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcminit_la_main.cpp
 
-kcontrol_SOURCES = dummy.cpp
-kcontrol_LDADD = kcontrol.la
+kcontrol_SOURCES = kcontrol_main.cpp
+kcontrol_LDADD = libkcontrol_main.la
 kcontrol_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
-kcmshell_SOURCES = dummy.cpp
-kcmshell_LDADD = kcmshell.la
+kcontrol_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcontrol_main.cpp
+
+kcmshell_SOURCES = kcmshell_main.cpp
+kcmshell_LDADD = libkcmshell_main.la
 kcmshell_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
-kcminit_SOURCES = dummy.cpp
-kcminit_LDADD = kcminit.la
+kcmshell_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcmshell_main.cpp
+
+kcminit_SOURCES = kcminit_main.cpp
+kcminit_LDADD = libkcminit_main.la
 kcminit_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
 
+kcminit_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kcminit_main.cpp
+
 rccontroldir = $(kde_datadir)/kcontrol
 rccontrol_DATA = kcontrolui.rc
 rcinfodir = $(kde_datadir)/kinfocenter
@@ -81,6 +107,3 @@
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kcontrol.pot
-
-dummy.cpp:
-	echo > dummy.cpp
