--- klipper/Makefile.am	14 Jan 2003 20:11:15 -0000	1.1.1.5
+++ klipper/Makefile.am	1 Jun 2003 14:31:55 -0000	1.10
@@ -1,23 +1,30 @@
 INCLUDES= $(all_includes)
 
 bin_PROGRAMS = klipper
-lib_LTLIBRARIES = klipper.la
+lib_LTLIBRARIES = klipper.la libklipper_main.la
 kde_module_LTLIBRARIES = klipper_panelapplet.la
 
-CLEANFILES = dummy.cpp
+CLEANFILES = dummy.cpp klipper_main.cpp
 
-klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) 
-klipper_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp \
+libklipper_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) -lkdecore -lDCOP
+libklipper_main_la_SOURCES = toplevel.cpp urlgrabber.cpp configdialog.cpp \
     toplevel.skel
 
-klipper_la_METASOURCES = AUTO
-klipper_la_LDFLAGS = $(all_libraries) -module -avoid-version
+libklipper_main_la_METASOURCES = AUTO
+libklipper_main_la_LDFLAGS = $(all_libraries) -avoid-version -no-undefined
 
-klipper_LDADD = klipper.la $(LIB_KSYCOCA)
-klipper_SOURCES = dummy.cpp
+klipper_la_LIBADD = libklipper_main.la
+klipper_la_SOURCES = main.cpp
+klipper_la_LDFLAGS = $(all_libraries) -avoid-version -module
+
+klipper_main.cpp: main.cpp
+	cat main.cpp > klipper_main.cpp
+
+klipper_LDADD = libklipper_main.la
+klipper_SOURCES = klipper_main.cpp
 klipper_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
-klipper_panelapplet_la_LIBADD = klipper.la
+klipper_panelapplet_la_LIBADD = libklipper_main.la
 klipper_panelapplet_la_SOURCES = applet.cpp applet.skel
 klipper_panelapplet_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
