--- kdeprint/kjobviewer/Makefile.am	25 Jun 2002 02:03:49 -0000	1.1.1.1
+++ kdeprint/kjobviewer/Makefile.am	1 Jun 2003 14:31:54 -0000	1.8
@@ -1,16 +1,23 @@
 INCLUDES = $(all_includes)
 
 bin_PROGRAMS = kjobviewer
-lib_LTLIBRARIES = kjobviewer.la
+lib_LTLIBRARIES = kjobviewer.la libkjobviewer_main.la
 
-kjobviewer_SOURCES = dummy.cpp
-kjobviewer_LDADD = kjobviewer.la
+libkjobviewer_main_la_SOURCES = kjobviewer.cpp
+libkjobviewer_main_la_LIBADD  = -lkdeprint_management $(LIB_KDEUI) $(LIB_QT) -lkdecore -lDCOP -lkdeprint
+libkjobviewer_main_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) -avoid-version -no-undefined
+libkjobviewer_main_la_METASOURCES = AUTO
+
+kjobviewer_SOURCES = main.cpp
+kjobviewer_LDADD   = libkjobviewer_main.la
 kjobviewer_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
-kjobviewer_la_SOURCES = kjobviewer.cpp main.cpp
-kjobviewer_la_METASOURCES = AUTO
-kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI)
-kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kjobviewer_la_SOURCES = main_la.cpp
+kjobviewer_la_LIBADD  = libkjobviewer_main.la
+kjobviewer_la_LDFLAGS = -avoid-version $(all_libraries) $(KDE_RPATH) -module
+
+main_la.cpp: main.cpp
+	cat main.cpp > main_la.cpp
 
 noinst_HEADERS = kjobviewer.h
 
@@ -22,8 +29,8 @@
 desktop_DATA = kjobviewer.desktop
 desktopdir = $(kde_appsdir)/Utilities
 
-dummy.cpp:
-	echo > dummy.cpp
+dummy.cpp: main.cpp
+	cat main.cpp > dummy.cpp
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kjobviewer.pot
