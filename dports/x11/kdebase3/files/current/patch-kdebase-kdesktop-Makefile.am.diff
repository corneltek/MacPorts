Index: kdesktop/Makefile.am
===================================================================
RCS file: /home/kde/kdebase/kdesktop/Makefile.am,v
retrieving revision 1.82
diff -u -b -u -r1.82 Makefile.am
--- kdesktop/Makefile.am	3 Jun 2003 06:16:21 -0000	1.82
+++ kdesktop/Makefile.am	17 Jun 2003 18:27:42 -0000
@@ -1,10 +1,12 @@
 ## Makefile.am of kdebase/kdesktop
 
 INCLUDES = -I$(top_srcdir)/kcontrol/background -I$(top_srcdir)/libkonq $(all_includes)
+libkdesktop_main_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -avoid-version
+libkdesktop_main_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_XSS)
 kdesktop_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version
-kdesktop_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_XSS)
+kdesktop_la_LIBADD  = libkdesktop_main.la
 kdesktop_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-kdesktop_LDADD    = kdesktop.la
+kdesktop_LDADD    = libkdesktop_main.la
 
 SUBDIRS = . lock pics patterns programs init kwebdesktop
 
@@ -12,15 +14,22 @@
 
 bin_PROGRAMS = kdesktop
 bin_SCRIPTS = kdeeject
-lib_LTLIBRARIES = kdesktop.la
+lib_LTLIBRARIES = libkdesktop_main.la
+kde_module_LTLIBRARIES = kdesktop.la
 
-kdesktop_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
+libkdesktop_main_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
 	lockeng.cc KDesktopIface.skel \
 	bgmanager.cc init.cc KScreensaverIface.skel \
 	minicli.cpp KBackgroundIface.skel pixmapserver.cc kcustommenu.cc \
 	startupid.cpp minicli_ui.ui xautolock_diy.c xautolock_engine.c
+kdesktop_la_SOURCES = kdesktop_la_main.cpp
+kdesktop_SOURCES = kdesktop_main.cpp
 
-kdesktop_SOURCES = dummy.cc
+kdesktop_la_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kdesktop_la_main.cpp
+
+kdesktop_main.cpp: stub_main.cpp
+	cat stub_main.cpp > kdesktop_main.cpp
 
 include_HEADERS = KDesktopIface.h KScreensaverIface.h KBackgroundIface.h
 
@@ -35,9 +44,6 @@
 messages: rc.cpp
 	$(EXTRACTRC) lock/*.ui >> rc.cpp
 	$(XGETTEXT) lock/*.cc *.cc *.cpp *.h -o $(podir)/kdesktop.pot
-
-dummy.cc:
-	echo > dummy.cc
 
 menu_DATA = kdesktop_custom_menu1 kdesktop_custom_menu2
 menudir = $(kde_confdir)
