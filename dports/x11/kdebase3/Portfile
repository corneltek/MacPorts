# $Id: Portfile,v 1.5 2003/03/10 19:23:07 ranger Exp $

PortSystem 1.0
name		kdebase3
version		3.1
revision	2
categories	x11
maintainers	ranger@befunk.com
description	base KDE programs

platforms	darwin
master_sites	ftp://ftp.kde.org/pub/kde/stable/3.1/src/ http://ranger.befunk.com/fink/:admin
extract.sufx	.tar.bz2
use_bzip2	yes
distname	kdebase-${version}
distfiles	${distname}.tar.bz2 kde-admindir-20030209.tar.bz2:admin
patchfiles	patch-${name}-${version}.darwin
depends_lib	lib:libart_lgpl_2:libart_lgpl lib:libartsflow.1:arts \
		lib:libaudiofile.0:audiofile lib:libdl.1:dlcompat lib:libfreetype.6:XFree86 \
		lib:libjpeg.62:jpeg lib:libkdecore.4:kdelibs3 lib:libmad:mad lib:libogg:libogg \
		lib:libpng.3:libpng lib:libpoll.1:poll-emulator lib:libqt-mt.3.1:qt3 \
		lib:libvorbis.0:libvorbis lib:libxml2.2:libxml2 lib:libX11.6:XFree86 \
		lib:libXm.2:lesstif

checksums	kdebase-${version}.tar.bz2 md5 02f0583c7de93cdc458101a7575455b4 \
		kde-admindir-20030209.tar.bz2 md5 180fee362e27703bd9a062912c8a54cd

patch {
		foreach patch $patchfiles {
			system "cd '${workpath}/${distname}' && \
			sed -e 's#@PREFIX@#${prefix}#g' '${portpath}/${filedir}/${patch}' | patch -p0"
		}
}
post-patch      {
		system "cd '${worksrcpath}' && cp -Rf ../admin/ admin"
		system "cp '${portpath}/${filedir}/detect-autoconf.sh' '${worksrcpath}/admin/'"
		system "cd '${worksrcpath}' && make -f Makefile.cvs"
}
configure.env	CPPFLAGS='-I${prefix}/include -I${prefix}/include/qt3 -no-cpp-precomp -fno-common' \
		LIBS='-L${prefix}/lib' DYLD_LIBRARY_PATH='${prefix}/lib'
configure.args	--prefix='${prefix}' --includedir='${prefix}/include' --libdir='${prefix}/lib' \
		--with-extra-includes='${prefix}/include' --with-extra-libs='${prefix}/lib' \
		--with-qt-dir='${prefix}' --with-qt-includes='${prefix}/include/qt3' \
		--enable-rpath --with-pic --enable-shared=yes --enable-static=no --enable-mt \
		--libexecdir='${prefix}/lib' --with-xinerama --with-pam --enable-final \
		--disable-dependency-tracking --without-nfs --with-ldap
build.env	${configure.env}
post-install	{
		system "install -d -m 755 ${destroot}/private/etc/pam.d"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kde"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kcheckpass"
		system "cd '${worksrcpath}' && install -c -m 444 /etc/pam.d/login  ${destroot}/private/etc/pam.d/kscreensaver"
}
