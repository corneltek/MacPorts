--- kpovmodeler/Makefile.am	29 Oct 2002 16:46:33 -0000	1.1.1.4
+++ kpovmodeler/Makefile.am	1 Jun 2003 14:31:58 -0000	1.7
@@ -4,7 +4,7 @@
 
 SUBDIRS = pics examples
 
-kde_module_LTLIBRARIES = libkpovmodelerpart.la
+kde_module_LTLIBRARIES = libkpovmodelerpart.la libkpovmodeler_shared.la kpovmodeler.la
 bin_PROGRAMS = kpovmodeler
 
 
@@ -83,7 +83,7 @@
 	pmrendermode.cpp pmresourcelocator.cpp pmtruetypecache.cpp \
 	pmdocumentationmap.cpp
 
-libkpovmodelerpart_la_SOURCES = $(pmallsources)
+libkpovmodeler_shared_la_SOURCES = $(pmallsources)
 
 noinst_HEADERS = pmpart.h pmfactory.h pmview.h pmshell.h pmobjectdrag.h \
 	pmtreeview.h pmtreeviewitem.h pmerrordialog.h \
@@ -159,13 +159,27 @@
 	\
 	version.h pmdocumentformat.h
 
-libkpovmodelerpart_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(KDE_PLUGIN) $(LIBFREETYPE_RPATH) 
-libkpovmodelerpart_la_LIBADD = $(LIBFREETYPE_LIBS) $(LIB_KPARTS) -lglut -lGLU -lGL -lXmu -lXi
-libkpovmodelerpart_la_METASOURCES = AUTO
+libkpovmodeler_shared_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFREETYPE_RPATH) -avoid-version -no-undefined
+libkpovmodeler_shared_la_LIBADD = $(LIBFREETYPE_LIBS) $(LIB_KPARTS) -lglut -lGLU -lGL -lXmu -lXi $(LIB_QT) $(LIB_KDECORE) -lkio -lkdeui
+libkpovmodeler_shared_la_METASOURCES = AUTO
+
+libkpovmodelerpart_la_SOURCES = libkpovmodelerpart_la_dummy.cpp
+libkpovmodelerpart_la_LDFLAGS = $(all_libraries) -avoid-version -module
+libkpovmodelerpart_la_LIBADD  = libkpovmodeler_shared.la
+
+libkpovmodelerpart_la_dummy.cpp:
+	echo > libkpovmodelerpart_la_dummy.cpp
+
+kpovmodeler_la_SOURCES = kpovmodeler_la_main.cpp
+kpovmodeler_la_LDFLAGS = $(all_libraries) -avoid-version -module
+kpovmodeler_la_LIBADD  = libkpovmodeler_shared.la
+
+kpovmodeler_la_main.cpp: main.cpp
+	cat main.cpp > kpovmodeler_la_main.cpp
 
 kpovmodeler_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 kpovmodeler_SOURCES = main.cpp
-kpovmodeler_LDADD = libkpovmodelerpart.la $(LIB_KFILE)
+kpovmodeler_LDADD = libkpovmodeler_shared.la
 
 #kpovmodeler_SOURCES = $(pmallsources) main.cpp
 #kpovmodeler_LDFLAGS = $(all_libraries) $(KDE_RPATH)
