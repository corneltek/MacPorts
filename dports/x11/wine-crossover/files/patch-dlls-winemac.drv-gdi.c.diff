Fix build on Mavericks
http://bugs.winehq.org/show_bug.cgi?id=34162
--- dlls/winemac.drv/gdi.c.orig	2013-07-22 08:39:22.000000000 -0500
+++ dlls/winemac.drv/gdi.c	2013-10-24 12:22:48.000000000 -0500
@@ -39,7 +39,6 @@
 static int desktop_horz_res;    /* width in pixels of virtual desktop */
 static int desktop_vert_res;    /* height in pixels of virtual desktop */
 static int bits_per_pixel;      /* pixel depth of screen */
-static int palette_size;        /* number of color entries in palette */
 static int device_data_valid;
 
 static CRITICAL_SECTION device_data_section;
@@ -93,7 +92,6 @@
     CGDirectDisplayID mainDisplay = CGMainDisplayID();
     CGSize size_mm = CGDisplayScreenSize(mainDisplay);
     CGDisplayModeRef mode = CGDisplayCopyDisplayMode(mainDisplay);
-    CGDirectPaletteRef palette;
 
     /* Initialize device caps */
     log_pixels_x = log_pixels_y = get_dpi();
@@ -139,15 +137,6 @@
     desktop_horz_res = desktop_rect.size.width;
     desktop_vert_res = desktop_rect.size.height;
 
-    palette = CGPaletteCreateWithDisplay(mainDisplay);
-    if (palette)
-    {
-        palette_size = CGPaletteGetNumberOfSamples(palette);
-        CGPaletteRelease(palette);
-    }
-    else
-        palette_size = 0;
-
     device_data_valid = TRUE;
 }
 
@@ -319,7 +308,7 @@
     case RASTERCAPS:
         ret = (RC_BITBLT | RC_BANDING | RC_SCALING | RC_BITMAP64 | RC_DI_BITMAP |
                RC_DIBTODEV | RC_BIGFONT | RC_STRETCHBLT | RC_STRETCHDIB | RC_DEVBITS |
-               (palette_size ? RC_PALETTE : 0));
+               (bits_per_pixel <= 8 ? RC_PALETTE : 0));
         break;
     case SHADEBLENDCAPS:
         ret = (SB_GRAD_RECT | SB_GRAD_TRI | SB_CONST_ALPHA | SB_PIXEL_ALPHA);
@@ -344,7 +333,7 @@
         ret = 0;
         break;
     case SIZEPALETTE:
-        ret = palette_size;
+        ret = bits_per_pixel <= 8 ? 1 << bits_per_pixel : 0;
         break;
     case NUMRESERVED:
     case PHYSICALWIDTH:
