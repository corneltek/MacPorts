# $Id: Portfile,v 1.10 2003/06/29 20:49:13 mij Exp $

PortSystem 1.0
name		gtk2
version		2.2.2
categories	x11
maintainers	mij@opendarwin.org
description	Gimp ToolKit version 2
homepage	http://www.gtk.org/
platforms	darwin

long_description This is GTK+ version 2.x.  GTK+, which stands for Gimp \
		 ToolKit, is a library for creating GUIs for the X \
		 Windows System.

master_sites	ftp://ftp.gnome.org/pub/gnome/sources/gtk+/2.2/ \
		ftp://archive.progeny.com/GNOME/sources/gtk+/2.2/ \
		http://archive.progeny.com/GNOME/sources/gtk+/2.2/

distname	gtk+-${portversion}
checksums	md5 5a7c639f0f2d682bdc17e3f81c17c79c

use_bzip2	yes

depends_lib	lib:libglib.2:glib2 lib:libtiff.3:tiff lib:libpng12.0:libpng \
		lib:libungif.4:libungif lib:libatk.1:atk lib:libpango.1:pango \
		lib:libintl.1:gettext lib:libX11.6:XFree86

patchfiles	patch-Makefile.in patch-configure patch-demos-Makefile.in \
		patch-demos-gtk-demo-Makefile.in patch-demos-gtk-demo-main.c \
		patch-gdk-Makefile.in patch-gdk-x11-gdkdrawable-x11.c \
		patch-gdk-x11-gdkim-x11.c patch-gtk-Makefile.in \
		patch-gtk-gtkimmulticontext.c patch-gtk-gtkmain.c \
		patch-ltmain.sh patch-modules-input-Makefile.in \
		patch-po-Makefile.in.in

configure.env	LDFLAGS="-L${prefix}/lib" \
		CPPFLAGS="-I${prefix}/include -no-cpp-precomp -DX_LOCALE" \
		CFLAGS="-O3 -funroll-loops -fstrict-aliasing"

configure.args	--disable-shm --disable-gtk-doc --with-included-loaders

build.args	CFLAGS+="-I${x11prefix}/include"

post-install	{ system "ln -fs libgtk-x11-2.0.0.200.2.dylib ${destroot}${prefix}/lib/libgtk.2.dylib"
		  system "ln -fs libgdk-x11-2.0.0.200.2.dylib ${destroot}${prefix}/lib/libgdk.2.dylib"
		  system "install -d -m 755 ${destroot}${prefix}/etc/gtk-2.0"
		  system "cp ${portpath}/${filesdir}/gdk-pixbuf.loaders ${destroot}${prefix}/etc/gtk-2.0/gdk-pixbuf.loaders"
		  system "env LANG=C DYLD_LIBRARY_PATH=${destroot}${prefix}/lib ${destroot}${prefix}/bin/gtk-query-immodules-2.0 > ${destroot}${prefix}/etc/gtk-2.0/gtk.immodules" }
