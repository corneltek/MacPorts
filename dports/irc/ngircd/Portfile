# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                ngircd
version             20.1
categories          irc
platforms           darwin
license             GPL-2+
maintainers         nomaintainer

description         next generation IRC daemon
long_description    ngIRCd is a free open source daemon for Internet \
                    Relay Chat (IRC). It's written from scratch and is \
                    not based upon the original IRCd like many others.

homepage            http://ngircd.barton.de/
master_sites        http://ngircd.barton.de/pub/ngircd/ \
                    ftp://ftp.berlios.de/pub/ngircd/

checksums           rmd160  6dee9a1a83ee3951e73f0fc0fd745a0afa771b09 \
                    sha256  bd5b8117e49dc72604f38097e81eb8231270bb608f7360ccaf8bcad055342646

depends_lib         port:libident \
                    port:tcp_wrappers \
                    port:zlib

# libident is not universal
universal_variant   no

patchfiles          patch-contrib-MacOSX-Makefile.in.diff \
                    patch-doc-Makefile.in.diff

configure.args      --docdir=${prefix}/share/doc/${name} \
                    --enable-ipv6 \
                    --with-tcp-wrappers \
                    --with-ident

# It's easier to create our own startup item than to patch and install
# the provided plist.
startupitem.create      yes
startupitem.executable  ${prefix}/sbin/ngircd --nodaemon
startupitem.logfile     ${prefix}/var/log/ngIRCd.log
startupitem.logevents   yes

post-activate {
    if {![file exists ${prefix}/etc/ngircd.conf]} {
        xinstall -m 0644 ${prefix}/share/doc/${name}/sample-ngircd.conf \
            ${prefix}/etc/ngircd.conf
    }
}

variant gnutls conflicts openssl description {Build with GnuTLS} {
    configure.args-append   --with-gnutls
    depends_lib-append      port:gnutls
}

variant openssl conflicts gnutls description {Build with OpenSSL} {
    configure.args-append   --with-openssl
    depends_lib-append      port:openssl
}

if {![variant_isset gnutls]} {
    default_variants        +openssl
}
