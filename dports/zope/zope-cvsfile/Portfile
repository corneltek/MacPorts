# $Id: Portfile,v 1.1 2004/02/23 05:22:31 rshaw Exp $
PortSystem 1.0

name			zope-cvsfile
version			0.9.0
categories		www zope python
maintainers		rshaw@opendarwin.org
description		This is the CVSFile Zope Product.
long_description	The CVSFile package is a Zope product.  CVSFile \
					allows one to use CVS as a version control system \
					for Zope content.  The developer creates a CVSFile, \
					pointing to a file in the developer's CVS Sandbox on \
					the Zope server.  Other Zope objects are able to \
					access the content, but it is actually stored on the \
					disk, rather than in the ZODB.  CVSFile enables the \
					user to modify the file and do simple CVS commands. \
					CVSFile inherits from ExternalFile \
					(http://www.zope.org/Members/arielpartners/ExternalFile), \
					a Zope product that behaves like a standard Zope \
					object like File, Page Template,or DTMLMethod, but \
					points to external content in the filesystem.
platforms		darwin freebsd
homepage		http://zope.org/Members/arielpartners/CVSFile
master_sites	http://zope.org/Members/arielpartners/CVSFile/${version}/
dist_subdir		zope/${name}
distname		CVSFile
extract.suffix	.zip
use_zip			yes
distfiles		${distname}-[strsed ${version} {g/[.]/-/}]${extract.suffix}
checksums		md5 e2841081d9b038c8a1acee97ff4b0e17

# Use Python 2.3 from DarwinPorts explicitly 
set python		${prefix}/bin/python2.3

# Location to install Zope products and the Zope user                  
set zopehome	${prefix}/libexec/Zope
set zopeinst	${prefix}/www/Zope
set zopeprod	${zopehome}/lib/python/Products
set zopeuser	zope
set zopegroup	www

# Depends on Zope
depends_build	path:${zopehome}:zope

# Depends on these Zope products and binaries
depends_run		path:${zopeprod}/ExternalFile:zope-externalfile \
				bin:cvs:cvs

use_configure	no

pre-build {
	file copy ${zopehome}/bin/compilezpy.py ${workpath}
	reinplace "s|^.*sys.stdout|#&|" ${workpath}/compilezpy.py
	reinplace "s|'tests'|& and name != 'extras'|" ${workpath}/compilezpy.py
	system "find ${worksrcpath} -name '*.py\[co\]' | xargs rm"
	system "find ${worksrcpath} -type d -name CVS | xargs rm -rf"
}

build {
	system "cd ${worksrcpath} && ${python} ${workpath}/compilezpy.py"
}

destroot {
	if {$env(USER) != "root"} {
		ui_msg "------------------------------------------------------------"
		ui_msg "Note that you are not installing as root, so files installed"
		ui_msg "by this port will not end up with proper ownership and"
		ui_msg "likely not work correctly with Zope."
		ui_msg "------------------------------------------------------------"
	}

	# Install products
	xinstall -d -m 0755 ${destroot}${zopeprod}
	system "cp -R ${workpath}/${distname} ${destroot}${zopeprod}"
	if {$env(USER) == "root"} {
		system "chown -R ${zopeuser} ${destroot}${zopehome}"
		system "chgrp -R ${zopegroup} ${destroot}${zopehome}"
	}
} 

