# $Id$
PortSystem          1.0
name                spot
version             1.2.4
categories          science math
maintainers         mmoll openmaintainer
description         Spot is an object-oriented model checking library written in C++.
long_description    ${description}
homepage            http://spot.lip6.fr/wiki
platforms           darwin
license             GPL-3
master_sites        http://spot.lip6.fr/dl/
checksums           md5     090149cb076b6984be4633c1e57cd513 \
                    sha1    fc91819dbb4e331cbb942075d041595910bc1351 \
                    rmd160  932ea3e520a1705fdfc57b987c996fe2a28bca28
depends_lib-append  port:boost


set pythons_suffixes {26 27 33 34}

set pythons_ports {}
foreach s ${pythons_suffixes} {
    lappend pythons_ports python${s}
}

proc python_dir {} {
    global pythons_suffixes
    foreach s ${pythons_suffixes} {
        if {[variant_isset python${s}]} {
            set p python[string index ${s} 0].[string index ${s} 1]
            return [file normalize [exec ${p} -c "import sys; print(sys.prefix)"]/lib/${p}/site-packages]
        }
    }
    error "Python support not enabled."
}

foreach s ${pythons_suffixes} {
    set p python${s}
    set v [string index ${s} 0].[string index ${s} 1]
    set i [lsearch -exact ${pythons_ports} ${p}]
    set c [lreplace ${pythons_ports} ${i} ${i}]
    set packagepath ${destroot}${prefix}/Library/Frameworks/Python.framework/Versions/${v}/lib/python${v}
    eval [subst {
        variant ${p} description "Use Python ${v} for python bindings" conflicts ${c} {
            depends_lib-append      port:${p}
            configure.env-append    PYTHON=${prefix}/bin/python${v}
            post-destroot {
                file mkdir ${destroot}${prefix}/Library/Frameworks/Python.framework/Versions/${v}/lib/python${v}
                move ${destroot}${prefix}/lib/python${v}/site-packages ${packagepath}/site-packages
            }
        }
    }]
}

# enable one python variant so that the python bindings can be compiled
set selected_python python27
foreach s ${pythons_suffixes} {
    if {[variant_isset python${s}]} {
        set selected_python python${s}
    }
}
default_variants +${selected_python}

livecheck.type  regex
livecheck.url   ${master_sites}
livecheck.regex ${name}-(\[0-9.\]+).tar.gz
