# -*- coding: utf-8; mode: tcl; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 4 truncate-lines: t -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               compilers 1.0

name                    eo
categories              science
license                 LGPL-2.1+
version                 1.0.1
revision                2
categories              science math
platforms               darwin
maintainers             openmaintainer jochen
description             an evolutionary computation library
long_description        Evolving Objects (EO) is a templates-based, \
                        ANSI-C++ compliant evolutionary computation \
                        library. It contains classes for almost any \
                        kind of evolutionary computation you might \
                        come up with -- at least for the ones we could \
                        think of. It is component-based, so that if \
                        you don't find the class you need in it, it is \
                        very easy to subclass existing abstract or \
                        concrete classes.

homepage                http://eodev.sourceforge.net/
master_sites            sourceforge:eodev
use_bzip2               yes
checksums               rmd160  33721e4a700f72a34cd69be1b488068bc54c5b79 \
                        sha256  a8539dd9b48ddca153fa7f833da3e10fc923b0af51efae195b19b3613f617d89

default_variants        +gnuplot

patchfiles              patch-eoBit.h.diff \
                        patch-eoFileSnapshot.h.diff \
                        patch-eoGnuplot.cpp.diff \
                        patch-make_checkpoint.h.diff \
                        patch-make_checkpoint_assembled.h.diff \
                        patch-make_checkpoint_FDC.h.diff \
                        patch-make_checkpoint_pareto.h.diff \
                        patch-make_help.cpp.diff \
                        patch-test-t-eoSelect.cpp.diff
# last is required for 'port test' with a GCC compiler.

configure.args-append   --disable-applications --disable-gnuplot --disable-tutorial

test.run                yes
test.target             check

compilers.choose        cc cxx
# TODO: Fix this project's buggy C++ code or file a bug upstream
compilers.setup         -clang -dragonegg -gcc gcc45
compiler.blacklist      *clang*

# clang++ gives: "error: use of undeclared identifier 'value'"

# gcc5:
#../../src/utils/eoStat.h:382:34: error: type 'eoDistanceStat<EOT>' is not a base type for type 'eoDistanceStat<EOT>'
#     using eoDistanceStat< EOT >::value;

# gcc46, gcc47, dragonegg33, dragonegg34:
# eoFunctorStore.cpp: In destructor 'virtual eoFunctorStore::~eoFunctorStore()':
# eoFunctorStore.cpp:13:9: error: 'size_t' was not declared in this scope
# eoFunctorStore.cpp:13:9: note: suggested alternatives:
# In file included from /opt/local/include/gcc47/c++/bits/stl_algobase.h:60:0,
#                  from /opt/local/include/gcc47/c++/vector:61,
#                  from ./eoFunctorStore.h:30,
#                  from eoFunctorStore.cpp:6:
# /opt/local/include/gcc47/c++//x86_64-apple-darwin14/bits/c++config.h:173:26: note:   'std::size_t'
# /opt/local/include/gcc47/c++//x86_64-apple-darwin14/bits/c++config.h:173:26: note:   'std::size_t'
# eoFunctorStore.cpp:13:16: error: expected ';' before 'i'
# eoFunctorStore.cpp:13:23: error: 'i' was not declared in this scope

# caused by gcc use of -ftree-vectorize -march=native -O3
# if /opt/local/bin/g++-mp-4.4 -DHAVE_CONFIG_H -I. -I. -I../..   -I/opt/local/include -I../../src -pipe -Os -fpermissive -ftree-vectorize -march=native -O3 -MT make_genotype_real.o -MD -MP -MF ".deps/make_genotype_real.Tpo" -c -o make_genotype_real.o make_genotype_real.cpp; \
#         then mv -f ".deps/make_genotype_real.Tpo" ".deps/make_genotype_real.Po"; else rm -f ".deps/make_genotype_real.Tpo"; exit 1; fi
# {standard input}:807:no such instruction: `vmovsd (%r9), %xmm1'
# {standard input}:808:no such instruction: `vmovd %rbx, %xmm0'
# {standard input}:809:no such instruction: `vucomisd %xmm0, %xmm1'
# {standard input}:810:no such instruction: `vcmpnltsd %xmm1, %xmm0,%xmm2'
# {standard input}:813:no such instruction: `vandpd %xmm2, %xmm0,%xmm0'
# {standard input}:814:no such instruction: `vandnpd %xmm1, %xmm2,%xmm1'

# gcc44 test: FAIL: t-eoRandom

#platform darwin {
#    if {${os.major} >= 13} {
#        depends_lib
#        depends_run
#        pre-fetch {
#            ui_error "$name does not build on Mavericks or later."
#            error "unsupported platform"
#        }
#    }
#}

# patch 'set data style points' to 'set style data points' for gnuplot 5

variant applications {
        license-append  GPL-2+
        configure.args-append   --enable-applications
        configure.args-delete   --disable-applications
}

variant gnuplot {
        depends_lib             port:gnuplot
        configure.args-append   --enable-gnuplot
        configure.args-delete   --disable-gnuplot
}

variant tutorial {
        configure.args-append   --enable-tutorial
        configure.args-delete   --disable-tutorial
}

pre-configure {
    configure.args-append       CC=${configure.cc} CFLAGS="${configure.cflags}" \
                                CXX=${configure.cxx}
    
    if {[gcc_variant_isset]} {
        configure.cxxflags-append   "-fpermissive"
#        configure.cflags-append     "-ftree-vectorize -march=native -O3"
#        configure.cxxflags-append   "-ftree-vectorize -march=native -O3"
    }
}

livecheck.distname   eo
