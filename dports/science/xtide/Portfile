# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0
PortGroup  compiler_blacklist_versions 1.0

name			xtide
version         2.14
platforms		darwin
maintainers     dstrubbe openmaintainer

description		Tide prediction software, with a large database of locations.
long_description	XTide is a package that provides tide and current predictions \
                    in a wide variety of formats. Graphs, text listings, and calendars \
                    can be generated, or a tide clock can be provided on your desktop. \
                    For x11, plain command line, and as an http server.

use_bzip2               yes
homepage                http://www.flaterco.com/xtide/
master_sites            ftp://ftp.flaterco.com/xtide/

set docdir              ${prefix}/share/doc/${subport}
set harmonics_dir       ${prefix}/share/${name}/harmonics

if {${name} eq ${subport}} {
    categories          science x11
    revision            1
    license             GPL-3+
    master_sites-append http://pkgs.fedoraproject.org/repo/pkgs/${name}/${distfiles}/59de866e0684e123419d7a1c97ea23a5/

    checksums           rmd160  8f319c1b6e3c3ca8b01493dd83d980778a2ad943 \
                        sha256  b69ebd73e3798be5996a22c63b619537780ec8ed1ec5b92decf15fd4bc61320f

    depends_lib         port:libpng \
                        port:libtcd \
                        port:${name}-data

    post-extract {
        # Make the default harmonics path conveniently point to our directory.
        reinplace s|harmonics\\.tcd|${harmonics_dir}| ${worksrcpath}/libxtide/HarmonicsPath.cc
    }

    # Per the configure script: "if using GCC, version 4.4 or later is required"
    compiler.blacklist  *gcc-4.2 gcc-4.0 gcc-3.3 {clang < 300}

    configure.args-append   --without-x
    
    variant xwindows description {Build xtide executable for use with X-Windows} {
        depends_lib-append      port:xorg-libXaw
        configure.args-delete   --without-x
    }

    default_variants-append +xwindows

    livecheck.regex     ${name}-(\[0-9.\]+)${extract.suffix}
}

subport ${name}-data {
    categories          science
    version             20151227
    revision            0
    license             public-domain
    supported_archs     noarch

    description         Harmonics data for XTide.

    long_description    ${description}

    worksrcdir          harmonics-dwf-${version}
    distname            ${worksrcdir}-free
    master_sites-append http://pkgs.fedoraproject.org/repo/pkgs/${name}/${distfiles}/f9a8c5414aa14bd6b08d1be4e6a3eea7/

    checksums           rmd160  6f1fe7528ee80fe465b162afd662aabc8c50ed9f \
                        sha256  b382acfd94cefd6f6434ff3efdbecfd929abe3639e345979da7826a37ed5a7ac

    use_configure       no

    build {}

    destroot {
        xinstall -d -m 755 ${destroot}${harmonics_dir} ${destroot}${docdir}
        xinstall -m 644 -W ${worksrcpath} ${distname}.tcd ${destroot}${harmonics_dir}
        xinstall -m 644 -W ${worksrcpath} COPYING ChangeLog ${destroot}${docdir}
    }

    livecheck.regex     harmonics-dwf-(\[0-9\]+)-free${extract.suffix}

    notes "Only public-domain harmonics for the United States are included in this port.\
Additional harmonics for other countries, licensed for non-commercial use only, can be downloaded from\
[lindex ${master_sites} 0]harmonics-dwf-20111230-nonfree${extract.suffix}\
and extracted into ${harmonics_dir} to make them available to ${name}. See http://www.flaterco.com/xtide/faq.html#60."
}

livecheck.type          regex
livecheck.url           ${homepage}files.html
