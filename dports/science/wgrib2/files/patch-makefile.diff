--- makefile.orig	2013-08-07 18:27:02.000000000 +0900
+++ makefile	2013-08-07 18:28:30.000000000 +0900
@@ -83,8 +83,8 @@
 #
 
 # Warning do not set both USE_NETCDF3 and USE_NETCDF4 to one
-USE_NETCDF3=1
-USE_NETCDF4=0
+USE_NETCDF3=0
+USE_NETCDF4=1
 USE_REGEX=1
 USE_TIGGE=1
 USE_MYSQL=0
@@ -101,11 +101,11 @@
   endif
 endif
 
-ifeq ($(USE_NETCDF4),1)
-  ifeq ($(FC),)
-    $(error ERROR, USE_NETCDF4 = 1: must set fortran90 compiler by environement variable FC)
-  endif
-endif
+#ifeq ($(USE_NETCDF4),1)
+#  ifeq ($(FC),)
+#    $(error ERROR, USE_NETCDF4 = 1: must set fortran90 compiler by environement variable FC)
+#  endif
+#endif
 
 ifeq ($(USE_IPOLATES),1)
   ifeq ($(FC),)
@@ -382,9 +382,8 @@
 
 all:	${prog} aux_progs/gmerge aux_progs/smallest_grib2 aux_progs/smallest_4 aux_progs/grib_split
 
-
-${prog}:        $w/*.c $w/*.h ${jlib} ${nlib} ${zlib} ${plib} ${h5lib} ${glib} ${n4lib} ${iplib} ${gctpclib} ${proj4lib}
-	cd "$w" && export LDFLAGS="${wLDFLAGS}" && export CPPFLAGS="${wCPPFLAGS}" && ${MAKE}
+${prog}:        $w/*.c $w/*.h ${glib} ${iplib} ${gctpclib}
+	cd "$w" && ${MAKE} CPPFLAGS="-I${g} -I${gctpc}/source ${iip} ${CPPFLAGS}"
 
 fast:        $w/*.c $w/*.h ${jlib} ${nlib} ${zlib} ${plib} ${h5lib} ${glib} ${n4lib} ${iplib} ${gctpclib} ${proj4lib}
 	cd "$w" && export LDFLAGS="${wLDFLAGS}" && export CPPFLAGS="${wCPPFLAGS}" && ${MAKE} fast
@@ -415,18 +414,21 @@
 	cd "$z" && export CFLAGS="${wCPPFLAGS}" && ./configure && ${MAKE}
 
 
-${glib}:	${jlib} ${plib} ${zlib}
+${glib}:
 	touch ${glib}
 	rm ${glib}
 	cd "$g" && export CPPFLAGS="${wCPPFLAGS}" && ${MAKE}
+	ranlib ${glib}
 
 ${gctpclib}:
 	cp gctpc20.tar.Z tmpgctpc.tar.Z
 	gunzip -n -f tmpgctpc.tar.Z
 	tar -xvf tmpgctpc.tar
 	rm tmpgctpc.tar
-	cp makefile.gctpc proj.h cproj.c ${gctpc}/source/
-	cd "${gctpc}/source" && export CPPFLAGS="${wCPPFLAGS}" && ${MAKE} -f makefile.gctpc
+	cp makefile.gctpc proj.h ${gctpc}/source/
+	cd "${gctpc}/source" &&  ${MAKE} -f makefile.gctpc CPPFLAGS="-I${gctpc}/source ${CPPFLAGS}"
+	ranlib ${gctpclib}
+
 
 ${proj4lib}:
 	rm -rf ${proj4} ${proj4src}
@@ -469,7 +471,7 @@
 	cd "${h5}" && export CPPFLAGS="${CPPFLAGS}" && ./configure --disable-shared --disable-fortran --with-zlib=$z && ${MAKE} && ${MAKE}
 
 ${iplib}:
-	cd "${ip}" && export FFLAGS="${wFFLAGS}" && ${MAKE}
+	cd "${ip}" && ${MAKE}
 
 aux_progs/gmerge:	aux_progs/gmerge.c		
 	cd aux_progs && ${MAKE} -f gmerge.make
