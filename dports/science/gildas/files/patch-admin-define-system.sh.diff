# HG changeset patch
# User Sean Farley <sean.michael.farley@gmail.com>
# Date 1397849840 18000
#      Fri Apr 18 14:37:20 2014 -0500
# Node ID 0e344bcb0edfc864c73ef9072be1698768a94c55
# Parent  0c556df11dafc4475317fdc3598c7db1ad0b4265
define-system: use variables

diff --git a/admin/define-system.sh b/admin/define-system.sh
--- a/admin/define-system.sh
+++ b/admin/define-system.sh
@@ -225,12 +225,12 @@ EOF
         	else
         	    GAG_MACHINE=pc
         	fi
         	if which ifort > /dev/null 2>&1; then
         	    DEFAULT_COMPILER=ifort
-        	elif which gfortran > /dev/null 2>&1; then
-        	    DEFAULT_COMPILER=gfortran
+        	elif which @FC@ > /dev/null 2>&1; then
+        	    DEFAULT_COMPILER=@FC@
         	fi
             fi ;;
         CYGWIN*)
             GAG_MACHINE=pc
             GAG_OS_KIND=cygwin
@@ -295,13 +295,13 @@ EOF
         # Detect the compiler version.
         GAG_COMPILER_VERSION=
         if [ "$GAG_COMPILER_KIND" = "ifort" ]; then
             # Compress Major+Minor (no dot = easier preprocessing tests)
             GAG_COMPILER_VERSION=`ifort -v 2>&1 | cut -d" " -f2 | sed "s%\.%%"`
-        elif [ "$GAG_COMPILER_KIND" = "gfortran" ]; then
+        elif [ "$GAG_COMPILER_KIND" != "${GAG_COMPILER_KIND/gfortran/}" ]; then
             # Compress Major+Minor+Micro (no dot = easier preprocessing tests)
-            GAG_COMPILER_VERSION=`gfortran --version | head -1 | sed "s%.*\s\([0-9][0-9]*\)\.\([0-9][0-9]*\)\.\([0-9][0-9]*\).*%\1\2\3%"`
+            GAG_COMPILER_VERSION=`@FC@ --version | head -1 | sed "s%.*\s\([0-9][0-9]*\)\.\([0-9][0-9]*\)\.\([0-9][0-9]*\).*%\1\2\3%"`
             # Reject gfortran unstable versions
             GFORTRAN_VERSION2=`$GAG_COMPILER_EXE --version | head -1 | sed "s%.*\s\([0-9][0-9]*\.[0-9][0-9]*\)\.[0-9][0-9]*.*%\1%"`
             GFORTRAN_VERSION3=`$GAG_COMPILER_EXE --version | head -1 | sed "s%.*\s\([0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\).*%\1%"`
             # Minimum Gfortran version:
             GFORTRAN_MINI="4.4.0"
@@ -344,11 +344,11 @@ EOF
                 # Currently disabled: ifort 11.1 has an internal error
                 # if the debug mode is enabled
                 # GAG_COMPILER_CPPFLAGS="-DFORTRAN2003_PP"
                 :
             fi
-        elif [ "$GAG_COMPILER_KIND" = "gfortran" ]; then
+        elif [ "$GAG_COMPILER_KIND" != "${GAG_COMPILER_KIND/gfortran/}" ]; then
             GAG_COMPILER_LIBS="-lgfortran"
             if [ "$GFORTRAN_VERSION3" ">" "4.5.1" ]; then
                 # Fortran 2003 pointer procedures:
                 GAG_COMPILER_CPPFLAGS="-DFORTRAN2003_PP"
             fi
@@ -357,14 +357,16 @@ EOF
                 # arrays in Left Hand Side of assignments
                 GAG_COMPILER_FFLAGS="-Wrealloc-lhs-all"
             fi
         fi
         #
-        GCC_VERSION=`gcc --version | head -1 | sed "s%.*\s\([0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\).*%\1%"`
+        GCC_VERSION=`@CC@ --version | head -1 | sed "s%.*\s\([0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\).*%\1%"`
         if [ "$GCC_VERSION" ">" "4.7.9" ]; then
             # See http://gcc.gnu.org/gcc-4.8/porting_to.html
             GAG_COMPILER_CPPFLAGS="$GAG_COMPILER_CPPFLAGS -ffreestanding"
+        elif [ "$GCC_VERSION" != "${GCC_VERSION/clang/}" ]; then
+            GAG_COMPILER_CPPFLAGS="$GAG_COMPILER_CPPFLAGS -ffreestanding"
         fi
         #
         export GAG_COMPILER_FFLAGS GAG_COMPILER_LIBS GAG_COMPILER_CPPFLAGS
         #
     else
