--- gildas-src-jun14a/admin/define-system.sh.orig	2014-06-06 10:30:59.000000000 +0200
+++ gildas-src-jun14a/admin/define-system.sh	2014-06-06 10:31:24.000000000 +0200
@@ -227,8 +227,8 @@
         	fi
         	if which ifort > /dev/null 2>&1; then
         	    DEFAULT_COMPILER=ifort
-        	elif which gfortran > /dev/null 2>&1; then
-        	    DEFAULT_COMPILER=gfortran
+        	elif which @FC@ > /dev/null 2>&1; then
+        	    DEFAULT_COMPILER=@FC@
         	fi
             fi ;;
         CYGWIN*)
@@ -297,7 +297,7 @@
         if [ "$GAG_COMPILER_KIND" = "ifort" ]; then
             # Compress Major+Minor (no dot = easier preprocessing tests)
             GAG_COMPILER_VERSION=`$GAG_COMPILER_EXE -v 2>&1 | head -1 | cut -d" " -f2 | sed "s%\.%%"`
-        elif [ "$GAG_COMPILER_KIND" = "gfortran" ]; then
+        elif [ "$GAG_COMPILER_KIND" != "${GAG_COMPILER_KIND/gfortran/}" ]; then
             # Compress Major+Minor+Micro (no dot = easier preprocessing tests)
             GAG_COMPILER_VERSION=`$GAG_COMPILER_EXE --version | head -1 | sed "s%.*[^0-9]\([0-9][0-9]*\)\.\([0-9][0-9]*\)\.\([0-9][0-9]*\).*%\1\2\3%"`
             # Reject gfortran unstable versions
@@ -346,7 +346,7 @@
                 # GAG_COMPILER_CPPFLAGS="-DFORTRAN2003_PP"
                 :
             fi
-        elif [ "$GAG_COMPILER_KIND" = "gfortran" ]; then
+        elif [ "$GAG_COMPILER_KIND" != "${GAG_COMPILER_KIND/gfortran/}" ]; then
             GAG_COMPILER_LIBS="-lgfortran"
             if [ "$GFORTRAN_VERSION3" ">" "4.5.1" ]; then
                 # Fortran 2003 pointer procedures:
@@ -359,10 +359,12 @@
             fi
         fi
         #
-        GCC_VERSION=`gcc --version | head -1 | sed "s%.*[^0-9]\([0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\).*%\1%"`
+        GCC_VERSION=`@CC@ --version | head -1 | sed "s%.*[^0-9]\([0-9][0-9]*\.[0-9][0-9]*\.[0-9][0-9]*\).*%\1%"`
         if [ "$GCC_VERSION" ">" "4.7.9" ]; then
             # See http://gcc.gnu.org/gcc-4.8/porting_to.html
             GAG_COMPILER_CPPFLAGS="$GAG_COMPILER_CPPFLAGS -ffreestanding"
+        elif [ "$GCC_VERSION" != "${GCC_VERSION/clang/}" ]; then
+            GAG_COMPILER_CPPFLAGS="$GAG_COMPILER_CPPFLAGS -ffreestanding"
         fi
         #
         export GAG_COMPILER_FFLAGS GAG_COMPILER_LIBS GAG_COMPILER_CPPFLAGS
