# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup compilers 1.0

name                giza
version             0.9.1
categories          science graphics
platforms           darwin
maintainers         monash.edu:daniel.price
description         C/Fortran graphics library, PGPLOT replacement
long_description    giza is a 2D scientific plotting library \
                    for C/Fortran built on the cairo graphics library. \
                    Designed as a low-dependency, drop-in replacement for PGPLOT \
                    with antialiasing, real fonts, and PDF/svg/eps/png/X11 output. \
                    Builds both libpgplot and libcpgplot that directly replace the PGPLOT libraries.

homepage            http://giza.sourceforge.net/
master_sites        sourceforge:/project/${name}
license             GPL-2+

checksums           rmd160  965fc07a989b1092003bc8de85560f0ac7ee91fd \
                    sha256  95b67be1e6a98ed650cc7d36405ae67a579bd089d6314c74353af1adec6303c5

conflicts           pgplot
use_configure       no

compilers.choose    fc f90
compilers.setup     require_fortran -dragonegg

build.cmd           make
build.args          CC=${configure.cc} FC=${configure.fc}

build.args-append   X11DIR=${prefix} PREFIX=${prefix}

depends_lib         path:lib/pkgconfig/cairo.pc:cairo \
                    port:xorg-libX11

destroot.args       PREFIX=${prefix}
use_parallel_build  no

set gcc_versions {4.4 4.5 4.6 4.7 4.8 4.9}

foreach ver ${gcc_versions} {
    set ver_no_dot [join [split ${ver} "."] ""]

    if {[variant_isset gcc${ver_no_dot}]} {
        configure.fc  ${prefix}/bin/gfortran-mp-${ver}
        configure.cc  ${prefix}/bin/gcc-mp-${ver}
        build.args-append   CC=${configure.cc} FC=${configure.fc} FLIBS="-L${prefix}/lib/gcc${ver_no_dot} -lgfortran"
    }
}

if {[variant_isset g95]} {
   configure.fc  ${prefix}/bin/g95
   build.args-append FC=${configure.fc} FLIBS="-L${prefix}/lib/ -lf95"
}

if {![fortran_variant_isset]} {
   default_variants-append +gcc48
   set ver 4.8
   set ver_no_dot [join [split ${ver} "."] ""]
   configure.fc  ${prefix}/bin/gfortran-mp-${ver}
   configure.cc  ${prefix}/bin/gcc-mp-${ver}
   build.args-append  CC=${configure.cc} FC=${configure.fc} FLIBS="-L${prefix}/lib/gcc${ver_no_dot} -lgfortran"
}
