--- CMakeLists.txt.orig
+++ CMakeLists.txt
@@ -7,7 +7,7 @@
 # Version number
 set (libbiosig_VERSION_MAJOR 1)
 set (libbiosig_VERSION_MINOR 5)
-set (libbiosig_VERSION_PATCH 0)
+set (libbiosig_VERSION_PATCH 10)
 
 find_program (GAWK NAMES gawk)
 
@@ -23,6 +23,12 @@
   DEPENDS units.awk extern/units.csv
 )
 
+add_custom_target (annexb
+  COMMAND ${GAWK} -f annotatedECG.awk extern/11073-10102-AnnexB.txt > "11073-10102-AnnexB.i"
+  WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
+  DEPENDS annotatedECG.awk extern/11073-10102-AnnexB.txt
+)
+
 set (headers
   t210/abfheadr.h
   XMLParser/tinyxml.h
@@ -61,6 +67,14 @@
   )
 endif ()
 
+if (APPLE)
+  list (APPEND sources
+    win32/getdelim.c
+    win32/getline.c
+    win32/getlogin.c
+  )
+endif ()
+
 # Cannot have same name for static and shared library, 
 # so we'll correct that later on
 add_library (biosigstatic STATIC
@@ -80,8 +94,8 @@
      )
 endif ()
 
-add_dependencies (biosigstatic eventcodes units)
-add_dependencies (biosigshared eventcodes units)
+add_dependencies (biosigstatic eventcodes units annexb)
+add_dependencies (biosigshared eventcodes units annexb)
 
 if (USE_ZLIB)
   add_definitions (-D=WITH_ZLIB)
--- win32/getdelim.c.orig
+++ win32/getdelim.c
@@ -27,6 +27,9 @@
 #include <stdint.h>
 #include <stdlib.h>
 #include <errno.h>
+#ifdef MACPORTS
+#include <unistd.h>
+#endif
 
 #ifndef SSIZE_MAX
 # define SSIZE_MAX ((ssize_t) (SIZE_MAX / 2))
--- win32/getline.c.orig
+++ win32/getline.c
@@ -17,6 +17,9 @@
 /* Written by Simon Josefsson. */
 
 #include <stdio.h>
+#ifdef MACPORTS
+#include <unistd.h>
+#endif
 
 ssize_t
 getline (char **lineptr, size_t *n, FILE *stream)
