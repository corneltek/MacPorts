# $Id: Portfile,v 1.10 2003/04/05 04:27:42 jpm Exp $

PortSystem 1.0
name		bochs
version		1.4.1
revision	0
categories	emulators
maintainers	jpm@opendarwin.org
description	cross platform ia-32 emulator
long_description	Bochs is a highly portable open source IA-32 (x86) \
	PC emulator written in C++, that runs on most popular platforms. \
	It includes emulation of the Intel x86 CPU, common I/O devices, \
	and a custom BIOS.  Currently, bochs can be compiled to emulate a \
	386, 486 or Pentium CPU.
platforms	darwin
master_sites \
	http://unc.dl.sourceforge.net/sourceforge/${name}/ \
	http://telia.dl.sourceforge.net/sourceforge/${name}/ \
	http://easynews.dl.sourceforge.net/sourceforge/${name}/ \
	http://umn.dl.sourceforge.net/sourceforge/${name}/ \
	http://twtelecom.dl.sourceforge.net/sourceforge/${name}/ \
	http://belnet.dl.sourceforge.net/sourceforge/${name}/ \
	http://switch.dl.sourceforge.net/sourceforge/${name}/ \
	http://cesnet.dl.sourceforge.net/sourceforge/${name}/
checksums	md5 12e591b5cec2e0051e18605483f64678
patchfiles 	patch-Makefile.in patch-cdrom_osx
post-patch {
	set path "${portpath}/${workdir}/${worksrcdir}"
	set data_dir "${prefix}/bochs"
	
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochs-dlx.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochs.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|/usr/local/bochs|${data_dir}|g" "${path}/doc/man/bximage.1"
	
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochs-dlx.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochs.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|\@VERSION\@|${version}|g" "${path}/doc/man/bximage.1"

	reinplace "s|vgaromimage: bios/|vgaromimage: ${data_dir}/${version}/|g" "${path}/doc/man/bochsrc.1"
	reinplace "s|romimage: file=bios/|romimage: file=${data_dir}/${version}/|g" "${path}/doc/man/bochsrc.1"

	reinplace "s|vgaromimage: bios/|vgaromimage: ${data_dir}/${version}/|g" "${path}/.bochsrc"
	reinplace "s|romimage: file=bios/|romimage: file=${data_dir}/${version}/|g" "${path}/.bochsrc"
}
depends_run	bin:wget:wget
