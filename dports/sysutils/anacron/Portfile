# $Id: Portfile,v 1.1 2003/11/23 04:42:51 rshaw Exp $
PortSystem 1.0

name		anacron
version	 	2.3
categories	sysutils
maintainers	bchesneau@mac.com
description	Schedules periodic jobs on systems that are not permanently up
long_description	Anacron is a periodic command scheduler. It executes commands \
			at intervals specified in days. Unlike cron, it does not assume \
			that the system is running continuously.
homepage	http://sourceforge.net/projects/anacron
platforms	darwin
master_sites	sourceforge
checksums	md5 865cc1dfe1ed75c470d3e6de13763f03

depends_run 	path:/Library/StartupItems/DarwinPortsStartup:DarwinPortsStartup

patchfiles	patch-Makefile patch-README patch-anacron.8 patch-anacrontab.5
post-patch	{ file copy ${filespath}/obstack.c ${filespath}/obstack.h \
			  ${workpath}/${worksrcdir}/ }

use_configure	no

build.args	PREFIX=${prefix}

destroot.args	PREFIX=${destroot}${prefix}
post-destroot	{ reinplace "s|__PREFIX|${prefix}|g" \
			  ${destroot}${prefix}/share/man/man8/anacron.8
		  reinplace "s|__PREFIX|${prefix}|g" \
			  ${destroot}${prefix}/share/man/man5/anacrontab.5
		  file mkdir ${destroot}${prefix}/etc/cron.daily \
			  ${destroot}${prefix}/etc/cron.weekly \
			  ${destroot}${prefix}/etc/cron.monthly
		  system "touch ${destroot}${prefix}/etc/cron.daily/.turd \
			  ${destroot}${prefix}/etc/cron.weekly/.turd \
			  ${destroot}${prefix}/etc/cron.monthly/.turd"
		  file mkdir ${destroot}${prefix}/var/spool/anacron
		  system "touch  ${destroot}${prefix}/var/spool/anacron/.turd"
		  file mkdir ${destroot}${prefix}/etc/rc.d
		  system "install -m 755 -c ${filespath}/anacron.sh \
			  ${destroot}${prefix}/etc/rc.d/"
		  reinplace "s|__PREFIX|${prefix}|g" \
			  ${destroot}${prefix}/etc/rc.d/anacron.sh
		  file copy ${filespath}/anacrontab.sample \
			  ${destroot}${prefix}/etc/
		  reinplace "s|__PREFIX|${prefix}|g" \
			  ${destroot}${prefix}/etc/anacrontab.sample
		  file mkdir ${destroot}${prefix}/share/doc/${name}
		  file copy ${worksrcpath}/ChangeLog ${worksrcpath}/COPYING \
			  ${worksrcpath}/README ${worksrcpath}/TODO \
			  ${destroot}${prefix}/share/doc/${name}/
		  reinplace "s|__PREFIX|${prefix}|g" \
			  ${destroot}${prefix}/share/doc/${name}/README }

