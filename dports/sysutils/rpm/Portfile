# $Id: Portfile,v 1.2 2003/03/03 21:48:40 michaelm Exp $

PortSystem 1.0
name			rpm
version			4.0.4
platforms		darwin
categories		sysutils archivers
maintainers		ssen@opendarwin.org
description		RedHat Package Manager

master_sites		ftp://ftp.rpm.org/pub/rpm/dist/rpm-4.0.x/
checksums		md5 b0c3093d2f0d850760e59ac1db9bf152

depends_lib		lib:libbz2.1.0:bzip2 lib:libiconv.2:libiconv

configure.args		--disable-nls --with-included-gettext --with-glob --with-libiconv-prefix=${prefix}

variant darwin {
	patchfiles-append \
		patch-db3-configure.diff        patch-rpmheader.diff \
		patch-dump.diff                 patch-rpmioc.diff \
		patch-dumpdb.diff               patch-rpmioh.diff \
		patch-lib-signature.diff        patch-rpmlead.diff \
		patch-macros-in.diff            patch-rpmqv.diff \
		patch-rpm2cpio.diff             patch-rpmsignature.diff \
		patch-rpmarchive.diff           patch-systemh.diff \
		patch-rpmrc.diff

	configure.args-append --disable-optimized --disable-aio \
		--without-python

	configure.env   LDFLAGS="-L${prefix}/lib -L${workpath}/librt" CFLAGS="-I${prefix}/include -no-cpp-precomp" CC="gcc -flat_namespace"

	pre-build {
	        system "mkdir -p ${workpath}/librt"
		system "ln -sf /usr/lib/libSystem.B.dylib \
				${workpath}/librt/librt.dylib"
	}

}

