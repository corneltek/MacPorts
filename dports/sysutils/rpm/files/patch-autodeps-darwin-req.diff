--- /dev/null	Sat May 31 16:01:26 2003
+++ autodeps/darwin.req	Sat May 31 16:01:13 2003
@@ -0,0 +1,39 @@
+#!/usr/bin/perl
+# ----------------------------------------------------------------
+#	find-requires for Darwin
+# ----------------------------------------------------------------
+
+
+my %files;
+my @check;
+
+while (my $FILE = <STDIN>) {
+	chomp $FILE;
+
+	next if (-d $FILE);
+
+	next if ($FILE =~ m,\.class$,);
+	next if ($FILE =~ m,/macosx-sysrpm/,);
+
+	my $FILE_esc = $FILE;
+	$FILE_esc =~ s/\'/\\\'/g;
+
+	for my $ARCH ('ppc', 'i386') {
+		if (open(OTOOL, "otool -arch '$ARCH' -L '$FILE_esc' 2>/dev/null |")) {
+			while (<OTOOL>) {
+				if (/^\s*([^\s].*)\s+\(compatibility version/) {
+					my $dep = $1;
+					if ($dep =~ m,\.framework/.*,) {
+						$dep =~ s,^.*?/([^/]*?\.framework)/.*$,$1,;
+					}
+					$files{"$dep-$ARCH"} = 1;
+				}
+			}
+			close(OTOOL);
+		} else {
+			warn "couldn't run otool on '$FILE': $!\n";
+		}
+	}
+}
+
+print join("\n", sort keys %files), "\n";
