--- /dev/null	Sat May 31 21:28:36 2003
+++ autodeps/darwin.prov	Sat May 31 21:25:55 2003
@@ -0,0 +1,45 @@
+#!/usr/bin/perl
+# ----------------------------------------------------------
+#	find-provides for Darwin
+# ----------------------------------------------------------
+
+my %files;
+
+while (my $FILE = <STDIN>) {
+	chomp $FILE;
+
+	next if (-d $FILE);
+
+	next if ($FILE =~ m,\.class$,);
+
+	for my $ARCH ('ppc', 'i386') {
+		my $header;
+		my $FILE_esc = $FILE;
+		$FILE_esc =~ s/\'/\\\'/g;
+		if (open(OTOOL, "otool -arch '$ARCH' -hv '$FILE_esc' 2>/dev/null |")) {
+			while (<OTOOL>) {
+				if (/MH_MAGIC/) {
+						$header = $_;
+				}
+			}
+			close(OTOOL);
+			if (split(/\s+/, $header) and $_[4] eq 'DYLIB') {
+				if (open(OTOOL, "otool -arch '$ARCH' -D '$FILE_esc' 2>/dev/null |")) {
+					<OTOOL>;
+					chomp($FILE = <OTOOL>);
+					if ($FILE =~ m,\.framework/,) {
+						$FILE =~ s,^.*?/([^/]*?\.framework)/.*$,$1,;
+					}
+					$files{"$FILE-$ARCH"} = 1;
+				} else {
+					warn "couldn't determine install_name for '$FILE': $!\n";
+				}
+			}
+		} else {
+			warn "unable to run otool on $FILE: $!\n";
+			next;
+		}
+	}
+}
+
+print join("\n", sort keys %files), "\n";
