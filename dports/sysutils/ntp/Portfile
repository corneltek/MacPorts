# $Id$

PortSystem 1.0

name            ntp
version         4.2.7p476
epoch		1
categories      sysutils net
maintainers     geeklair.net:dluke
description     NTP is a protocol designed to synchronize the clocks of computers over a network.
#license	NTP (http://www.eecis.udel.edu/~mills/ntp/html/copyright.html), see http://opensource.org/licenses/NTP
license		Permissive

long_description	NTP is an implementation of RFC-5905. It is widely \
			used to synchronize a computer to Internet time \
			servers or other sources.
homepage        http://www.ntp.org/
master_sites    http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-dev/

distname	${name}-dev-${version}

checksums	md5	24b0ff5ddbd2245af00eb528cc779c24 \
		sha1	9f6eacbea4bf335339815cb766e5fbf96b6ead96 \
		rmd160	a387b78f7a6a6dac7dd61cf9d2ebabe76d52e193

platforms       darwin

configure.args	--enable-ipv6

startupitem.create	yes
startupitem.netchange	yes
startupitem.executable	${prefix}/bin/ntpd -n -g -p ${prefix}/var/run/ntpd.pid -f ${prefix}/var/db/ntp.drift -c ${prefix}/etc/ntp.conf

post-destroot	{
			xinstall -o root -m 644 ${filespath}/ntp.conf \
				${destroot}${prefix}/etc/ntp.conf.dist

			xinstall -m 755 -d ${destroot}${prefix}/var/run \
				${destroot}${prefix}/var/db		

			destroot.keepdirs ${destroot}${prefix}/var/run \
				${destroot}${prefix}/var/db
		}

#- our conf file contains restrictions to mitigate CVE-2013-5211
post-activate	{
			if {![file exists ${prefix}/etc/ntp.conf]} {
				file copy ${prefix}/etc/ntp.conf.dist ${prefix}/etc/ntp.conf
			}
		}

livecheck.type regex
livecheck.url http://support.ntp.org/rss/releases.xml
livecheck.regex (\\d+\.\\d+.\\d+p\\d+)\.\*Development
