# $Id$

PortSystem      1.0
PortGroup       github 1.0

github.setup    peco peco 0.4.2 v
revision        0
categories      sysutils
homepage        http://peco.github.io
description     Simplistic interactive filtering tool
long_description \
        peco can be a great tool to filter stuff like logs, process stats, find \
        files, because unlike grep, you can type as you think and look through  \
        the current results.
license         MIT

maintainers     kimuraw openmaintainer
platforms       darwin

depends_build   port:go
use_configure   no
dist_subdir     go

# peco
checksums       peco-${version}.tar.gz \
                    md5 4aa80b27519cae80b18a097a9b739a14 \
                    sha1 5edb7cfa9d1d0324b49da51e18376e3c1c81f1d5 \
                    sha256 6399451943bc03552d8a22b35453ddbbe9e20812bbc82b03df455dc3bda97c71

# utility for go-vendoring codes
set go.vendors {}
# go.vendors-append name1 ver1 name2 ver2...
proc go.vendors-append {args} {
    global go.vendors

    foreach {imp_name vers} ${args} {
        set vlist [split ${imp_name} /]

        set vdomain [lindex ${vlist} 0]
        set vuser [lindex ${vlist} 1]
        set vname [lindex ${vlist} 2]

        # NOTE: now expects github.com or golang.org
        switch -exact ${vdomain} {
            github.com { set ghuser ${vuser} }
            golang.org { set ghuser golang }
        }

        set fname ${ghuser}-${vname}
        lappend go.vendors [list ${fname} ${imp_name} ${vers}]

        global ${vname}.version
        set ${vname}.version ${vers}

        master_sites-append https://github.com/${ghuser}/${vname}/tarball/${vers}:${fname}
        distfiles-append    ${fname}-${vers}.tar.gz:${fname}
    }
}

# dependencies to build. remember revbump when you change version of dependencies.
# https://github.com/peco/peco/blob/master/glide.lock
go.vendors-append   github.com/davecgh/go-spew    5215b55f46b2b919f50a1df0eaa5886afe4e3b3d \
                    github.com/google/btree       00edb8c3163323f673bbe3c04afd9429eb12117d \
                    github.com/jessevdk/go-flags  6b9493b3cb60367edd942144879646604089e3f7 \
                    github.com/lestrrat/go-pdebug 2e6eaaa5717f81bda41d27070d3c966f40a1e75f \
                    github.com/mattn/go-runewidth d6bea18f789704b5f83375793155289da36a3c7f \
                    github.com/nsf/termbox-go     362329b0aa6447eadd52edd8d660ec1dff470295 \
                    github.com/pkg/errors         d814416a46cbb066b728cfff58d30a986bc9ddbe \
                    github.com/stretchr/testify   6cb3b85ef5a0efef77caef88363ec4d4b5c0976d \
                    golang.org/x/net              ef00b378c73f107bf44d5c9b69875255ce89b79a

checksums-append    davecgh-go-spew-${go-spew.version}.tar.gz \
                        md5 f8973a1b231ca486df664abf7248aab2 \
                        sha1 ee586c6a96b6049ea3af98340e76c4d656500daf \
                        sha256 eb362987151a467812f3712b9bd660a5e34828bd78ade32dd4a0c76b257c6480 \
                    google-btree-${btree.version}.tar.gz \
                        md5 8271747470e19f6b969e8d64687eebaf \
                        sha1 224a3eb6d10bf70558269b4f3ad1a0ff4cd9bf40 \
                        sha256 9fae9e6e5004403bb6ce0d5b188b74dcec64200b4c049af6ebd22d189079cbca \
                    jessevdk-go-flags-${go-flags.version}.tar.gz \
                        md5 a4892dfac3c3655138e2394083bcc0c3 \
                        sha1 97f979987c9c57901718819b42352d4af3980882 \
                        sha256 07450c65985eb2821c4bb48bf1c5548907bb3a3a8de540b72067ce93438c6355 \
                    lestrrat-go-pdebug-${go-pdebug.version}.tar.gz \
                        md5 a7a00fd430599d9af79ae9958492a3ab \
                        sha1 b6f890f2690012c5ac973f1a5bc3ffc64b9d9912 \
                        sha256 7c1574a70158def432a1a3d6306592e2b89cc1668467e599cd71f818b6084bcf \
                    mattn-go-runewidth-${go-runewidth.version}.tar.gz \
                        md5 564a154f948a2d15b2cca4988e639197 \
                        sha1 8d63a10d0c5fa0bcc7430f423a4f04cbf9bc50fe \
                        sha256 517f297b88a6579111a1e46e045909a0feedb40d0a71313ef70805d6b82e8d55 \
                    nsf-termbox-go-${termbox-go.version}.tar.gz \
                        md5 3a8dcb1cf1fd80921c3a21e7e6d2bcf7 \
                        sha1 4d9e079353f255f6f7945defc74941224761c8e2 \
                        sha256 e08a05235d67c7e30be4ebf852ec055572785353ff8f2a26a3aa106ec8fca288 \
                    pkg-errors-${errors.version}.tar.gz \
                        md5 67fa844e10dffc98b51519f416869148 \
                        sha1 27112af32c1ed79a6bc581991d362cee92109d4e \
                        sha256 8b4b6ef1618f280cc488404d961efeba9d6a8918d0b0d2c375b94125b3dc3059 \
                    stretchr-testify-${testify.version}.tar.gz \
                        md5 5b8335e2934a13a24bb7a0d15f55aff0 \
                        sha1 a1fe9fc6df0c2b227cd7986e03d4dd659cef3b59 \
                        sha256 027fc35a5e2629604d7aa0f3ccc95aa1843fb19e8524a567f9a28a241c76aa6b \
                    golang-net-${net.version}.tar.gz \
                        md5 64966c9773338ebad6152de901266b57 \
                        sha1 a745c2bc2edbdcd66c75fb5efd58807733e863cc \
                        sha256 b1ad6d6e8b3e95e6d172beccb1061d7f40b6e7db102adb1d407f33804f897363

# setup build sources as gopath style:
#   workpath/
#       peco-0.4.1/
#       gopath/src/github.com/
#           peco/peco/
#           jessevdk/go-flags-v/
#             :
set gopath      ${workpath}/gopath
set gosrc       ${gopath}/src
post-extract {
    file mkdir ${gosrc}/github.com/peco
    ln -s ${worksrcpath} ${gosrc}/github.com/peco/peco

    foreach vlist ${go.vendors} {
        set fname [lindex ${vlist} 0]
        set imp_name [lindex ${vlist} 1]
        file mkdir ${gosrc}/[file dirname ${imp_name}]
        move [glob ${workpath}/${fname}-*] ${gosrc}/${imp_name}
    }
}

build.cmd       go
build.target    build
build.args      cmd/peco/peco.go
build.env       GOPATH="${gopath}"

destroot {
    xinstall ${worksrcpath}/peco ${destroot}${prefix}/bin
}
