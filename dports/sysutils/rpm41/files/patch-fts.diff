--- rpmio/fts.h.orig	Sat Nov  8 20:39:29 2003
+++ rpmio/fts.h	Sat Nov  8 20:40:16 2003
@@ -55,6 +55,10 @@
 # define _D_EXACT_NAMLEN(d) ((d)->d_reclen)
 #endif
 
+#if defined(__APPLE__)
+# define _D_EXACT_NAMLEN(d) ((d)->d_reclen)
+#endif
+
 #endif
 
 #include <sys/types.h>
--- rpmio/fts.c.orig	Sat Nov  8 20:34:53 2003
+++ rpmio/fts.c	Sat Nov  8 20:42:10 2003
@@ -59,6 +59,9 @@
 #   define _STAT_VER		0
 #   define __fxstat64(_stat_ver, _fd, _sbp)	fstat((_fd), (_sbp))
 #endif
+#if defined(__APPLE__)
+#   define __errno_location() (__error())
+#endif
 #include "system.h"
 #include "fts.h"
 #include "rpmio.h"
@@ -1171,14 +1174,14 @@
 fts_safe_changedir(FTS * sp, FTSENT * p, int fd, const char * path)
 {
 	int ret, oerrno, newfd;
-	struct stat64 sb;
+	struct stat sb;
 
 	newfd = fd;
 	if (ISSET(FTS_NOCHDIR))
 		return (0);
 	if (fd < 0 && (newfd = __open(path, O_RDONLY, 0)) < 0)
 		return (-1);
-	if (__fxstat64(_STAT_VER, newfd, &sb)) {
+	if (fstat(newfd, &sb)) {
 		ret = -1;
 		goto bail;
 	}
