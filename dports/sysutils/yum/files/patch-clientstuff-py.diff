--- clientStuff.py.orig	Sat Jan 24 21:06:03 2004
+++ clientStuff.py	Sat Jan 24 20:53:11 2004
@@ -155,15 +155,17 @@
     return 0
 
 def openrpmdb(option=0, dbpath=None):
-    dbpath = "/var/lib/rpm/"
-    rpm.addMacro("_dbpath", dbpath)
+    for dbpath in ["@@PREFIX@@/var/lib/rpm/", "/var/lib/rpm/"]:
+        if os.path.exists(dbpath + "Packages"):
+            rpm.addMacro("_dbpath", dbpath)
 
-    try:
-        db = rpm.opendb(option)
-    except rpm.error, e:
-        raise RpmError(_("Could not open RPM database for reading. Perhaps it is already in use?"))
-    
-    return db
+            try:
+                db = rpm.opendb(option)
+            except rpm.error, e:
+                raise RpmError(_("Could not open RPM database for reading.  Perhaps it is already in use?"))
+            return db
+ 
+    raise RpmError(_("Could not find RPM database!"))
 
 
 def rpmdbNevralLoad(nevral):
