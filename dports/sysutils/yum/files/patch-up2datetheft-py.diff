--- up2datetheft.py.orig	Sat Jan 24 21:17:02 2004
+++ up2datetheft.py	Sat Jan 24 21:00:50 2004
@@ -21,16 +21,17 @@
 
 
 def openrpmdb(option=0, dbpath=None):
-    dbpath = "/var/lib/rpm/"
-    rpm.addMacro("_dbpath", dbpath)
+    for dbpath in ["@@PREFIX@@/var/lib/rpm/", "/var/lib/rpm/"]:
+        if os.path.exists(dbpath + "Packages"):
+            rpm.addMacro("_dbpath", dbpath)
 
-    #log.log_me("Opening rpmdb in %s with option %s" % (dbpath,option))
-    try:
-        db = rpm.opendb(option)
-    except rpm.error, e:
-        raise RpmError(_("Could not open RPM database for reading.  Perhaps it is already in use?"))
+            try:
+                db = rpm.opendb(option)
+            except rpm.error, e:
+                raise RpmError(_("Could not open RPM database for reading.  Perhaps it is already in use?"))
+            return db
 
-    return db
+    raise RpmError(_("Could not find RPM database!"))
 
 
 # mainly here to make conflicts resolution cleaner
