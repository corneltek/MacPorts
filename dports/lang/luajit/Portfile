# $Id$

PortSystem          1.0

name                luajit
version             2.0.1
categories          lang
platforms           darwin
license             BSD
maintainers         and.damore openmaintainer
description         a Just-In-Time Compiler for Lua
long_description    \
LuaJIT is a Just-In-Time Compiler for the Lua programming language.

homepage            http://luajit.org
master_sites        ${homepage}/download
distname            LuaJIT-${version}

checksums           md5     85e406e8829602988eb1233a82e29f1f \
                    sha1    330492aa5366e4e60afeec72f15e44df8a794db5 \
                    rmd160  99b6ef067a3f09865ff312baeb1ceb012bb9acb3

post-patch {
    reinplace "s|/usr/local|${prefix}|g" \
		${worksrcpath}/etc/luajit.pc \
		${worksrcpath}/Makefile \
		${worksrcpath}/src/luaconf.h \
		${worksrcpath}/src/Makefile
}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}/img
    xinstall -m 644  ${worksrcpath}/COPYRIGHT ${worksrcpath}/README ${destroot}${prefix}/share/doc/${name}
    eval xinstall -m 644 [glob ${worksrcpath}/doc/*.html] ${destroot}${prefix}/share/doc/${name}
    eval xinstall -m 644 [glob ${worksrcpath}/doc/*.css] ${destroot}${prefix}/share/doc/${name}
    eval xinstall -m 644 [glob ${worksrcpath}/doc/img/*] ${destroot}${prefix}/share/doc/${name}/img

    xinstall -d -m 755 ${destroot}${prefix}/share/pkgconfig
    xinstall -m 644 ${worksrcpath}/etc/luajit.pc ${destroot}${prefix}/share/pkgconfig
    xinstall -m 644 ${worksrcpath}/etc/luajit.1 ${destroot}${prefix}/share/man/man1
}

use_parallel_build  no
use_configure       no

build.target        amalg
build.args-append   CC="${configure.cc}"  \
                    CFLAGS="${configure.cflags} ${configure.cppflags} [get_canonical_archflags]" \
                    LDFLAGS="${configure.ldflags} [get_canonical_archflags]" \
                    Q=""

livecheck.type  regex
livecheck.url   ${master_sites}.html
livecheck.regex {LuaJIT-(\d+(?:\.\d+)*(?:-beta\d+)?).tar.gz}
