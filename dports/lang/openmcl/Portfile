# $Id: Portfile,v 1.10 2004/02/15 08:01:01 waqar Exp $

PortSystem 1.0
name		openmcl
version		0.14.1-p1
categories	lang
maintainers	waqar@opendarwin.org gwright@comcast.net
platforms	darwin
description	The OpenMCL Common Lisp Implementation
long_description \
		OpenMCL is an opensourced Common Lisp implementation,	\
		derived from Digitool's Macintosh Common Lisp product.	\
									\
		OpenMCL currently runs under LinuxPPC and, as of	\
		version 0.10, under Darwin, the BSD/Mach layer on which \
		MacOS X is based. 

homepage	http://openmcl.clozure.com/
master_sites	ftp://clozure.com/pub/ \
		http://clozure.com/openmcl/ftp/

distfiles	${name}-darwinppc-bin-${version}${extract.suffix} \
		${name}-src-${version}${extract.suffix} \
		jaguar-interfaces${extract.suffix}

checksums	openmcl-darwinppc-bin-${version}${extract.suffix} \
                        md5 bc507c765b8134fbb46e85177b0e3f57 \
		openmcl-src-${version}${extract.suffix} \
                        md5 2056fbc3d0d6acb6b9035c330707e4db \
		jaguar-interfaces${extract.suffix} \
                        md5 dbc1c0b892920c88326c1df40490ae61

configure	{ reinplace "s|-traditional-cpp|-no-cpp-precomp|g" \
		  ${workpath}/ccl/lisp-kernel/darwin/Makefile
		}

build		{ cd ${workpath}/ccl/lisp-kernel/darwin
		  system "make"
		  cd ${workpath}/ccl
		  system "echo '(ccl::xload-level-0 :force)' | ./dppccl --batch"
		  system "echo '(ccl::compile-ccl)' | ./dppccl --batch"
		  system "echo '(ccl::save-application \"dppccl.image\")' | \
	          ./dppccl --batch --image-name ppc-boot.image"
		}

destroot	{ file mkdir ${destroot}/${prefix}/share/${name}/${version}
		  cd ${workpath}/ccl
		  system "tar cf - . | ( cd ${destroot}/${prefix}/share/${name}/${version} && tar xf -)"
		  reinplace "s|/usr/local/src/ccl|${prefix}/share/${name}/${version}|" \
		  ${workpath}/ccl/scripts/openmcl
		  system "chmod +x ${workpath}/ccl/scripts/openmcl"
		  file copy ${workpath}/ccl/scripts/openmcl ${destroot}/${prefix}/bin
		}
