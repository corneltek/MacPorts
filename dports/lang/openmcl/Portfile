# $Id: Portfile,v 1.1 2003/03/26 20:31:36 gwright Exp $

PortSystem 1.0
name		openmcl
version		0.13.4
categories	lang
maintainers	gwright@comcast.net
platforms	darwin
description	The OpenMCL Common Lisp Implementation
long_description \
		OpenMCL is an opensourced Common Lisp implementation, \
		derived from Digitool's Macintosh Common Lisp product. \
		\
		OpenMCL currently runs under LinuxPPC and, as of \
		version 0.10, under Darwin, the BSD/Mach layer on which \
		MacOS X is based. 

homepage	http://openmcl.clozure.com/
master_sites	ftp://clozure.com/pub/

distfiles	${name}-darwinppc-bin-${version}${extract.sufx} \
		${name}-src-${version}${extract.sufx} \
		${name}-darwin-interfaces${extract.sufx}

checksums	openmcl-darwinppc-bin-0.13.4.tar.gz md5 674d36d6cfe62259d8235f5f7a42374c \
		openmcl-src-0.13.4.tar.gz md5 5f85b60360c4eb9239777ccc9d92af96 \
		openmcl-darwin-interfaces.tar.gz md5 96e729f65845d8af57b012e8ddd1cc56

configure	{ }

build		{ system "cd ${workpath}/ccl/lisp-kernel/darwin && \
			  make"
		  system "cd ${workpath}/ccl && \
		  	  echo '(ccl::xload-level-0 :force)' | ./dppccl --batch"
		  system "cd ${workpath}/ccl && \
		  	  echo '(ccl::compile-ccl)' | ./dppccl --batch"
		  system "cd ${workpath}/ccl && \
		  	  echo '(ccl::save-application \"dppccl.image\")' | \
			       ./dppccl --batch --image-name ppc-boot.image"
		}

install		{ system "mkdir -p ${destroot}/${prefix}/share/${name}/${version} && \
			  cd ${workpath}/ccl && \
			  tar cf - . | ( cd ${destroot}/${prefix}/share/${name}/${version} && tar xf -)"
		  system "cd ${workpath}/ccl/scripts && \
		  	  mv openmcl openmcl.tmp && \
			  sed \"s|/usr/local/src/ccl|${prefix}/share/${name}/${version}|\" openmcl.tmp > openmcl && \
			  chmod +x openmcl && \
			  rm openmcl.tmp"
		  system "cp ${workpath}/ccl/scripts/openmcl ${destroot}/${prefix}/bin"
		}

