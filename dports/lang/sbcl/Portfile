# $Id: Portfile,v 1.1 2004/02/26 20:53:44 gwright Exp $

PortSystem	1.0
name		sbcl
version		0.8.8
categories	lang
maintainers	gwright@comcast.net
platforms	darwin
description	The Steel Bank Common Lisp system

long_description	\
		Steel Bank Common Lisp (SBCL) is a Open Source		\
		development system for ANSI Common Lisp. It provides an	\
		interactive environment including an integrated native	\
		compiler, interpreter, and debugger. (And it, and its	\
		generated code, can also play nicely with Unix when	\
		running noninteractively.)

homepage	http://sbcl.sourceforge.net/
master_sites	http://umn.dl.sourceforge.net/sourceforge/${name}/

use_bzip2	yes

distfiles	${name}-${version}-source.tar.bz2:source \
		${name}-${version}-ppc-darwin-binary.tar.bz2:bootstrap

distname	${name}-${version}-source
worksrcdir	${name}-${version}

checksums	${name}-${version}-source.tar.bz2 md5 a80d2bb990f80d8d13f947a68ea3c78b \
		${name}-${version}-ppc-darwin-binary.tar.bz2 md5 54472ea3c18c97b85df18fdd206608a4

configure	{ }

set host_lisp	" \"${workpath}/${name}-${version}-ppc-darwin/src/runtime/sbcl --core ${workpath}/${name}-${version}-ppc-darwin/output/sbcl.core --disable-debugger\" "

build		{ cd ${worksrcpath}
		  system "ulimit -s 8192"

		  system "sh make.sh ${host_lisp}"
		}

destroot	{ cd ${worksrcpath}
		  system "INSTALL_ROOT=${destroot}/${prefix} sh install.sh"
		}

post-destroot	{ cd ${destroot}${prefix}/bin
		  file rename sbcl sbcl.bin

		  set script [open "${destroot}${prefix}/bin/sbcl" w 755]
                  puts $script "#!/bin/sh"
                  puts $script "${prefix}/bin/sbcl.bin --core ${prefix}/lib/${name}/${name}.core $@"
                  puts $script ""
                  close $script
                  system "chmod 755 ${destroot}${prefix}/bin/sbcl"
                }

