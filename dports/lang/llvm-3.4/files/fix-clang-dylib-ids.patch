Index: llvm-3.4.2.src/tools/clang/runtime/compiler-rt/Makefile
===================================================================
--- llvm-3.4.2.src.orig/tools/clang/runtime/compiler-rt/Makefile
+++ llvm-3.4.2.src/tools/clang/runtime/compiler-rt/Makefile
@@ -215,8 +215,6 @@ $(ResourceLibDir)/$1/libclang_rt.%.dylib
 		$(ResourceLibDir)/$1/.dir
 	$(Echo) Copying runtime library $1/$$* to build dir
 	$(Verb) cp $(PROJ_OBJ_DIR)/clang_$1/$$*/libcompiler_rt.dylib $$@
-	$(Echo) Fixing LC_ID_DYLIB of $$@
-	$(Verb) install_name_tool $$@ -id $$@
 RuntimeLibrary.$1: \
 		$(RuntimeLibrary.$1.Configs:%=$(ResourceLibDir)/$1/libclang_rt.%)
 .PHONY: RuntimeLibrary.$1
@@ -236,6 +234,7 @@ $(PROJ_resources_lib)/$1/libclang_rt.%.d
 		$(ResourceLibDir)/$1/libclang_rt.%.dylib | $(PROJ_resources_lib)/$1
 	$(Echo) Installing compiler runtime library: $1/$$*
 	$(Verb) $(DataInstall) $$< $(PROJ_resources_lib)/$1
+	$(Verb) install_name_tool $$@ -id $$(patsubst $(DESTDIR)%,%,$$@)
 
 # Rule to install runtime libraries.
 RuntimeLibraryInstall.$1: \
Index: llvm-3.4.2.src/tools/clang/tools/libclang/Makefile
===================================================================
--- llvm-3.4.2.src.orig/tools/clang/tools/libclang/Makefile
+++ llvm-3.4.2.src/tools/clang/tools/libclang/Makefile
@@ -49,12 +49,8 @@ ifeq ($(HOST_OS),Darwin)
     # Extra options to override libtool defaults.
     LLVMLibsOptions += -Wl,-dead_strip
 
-    # Mac OS X 10.4 and earlier tools do not allow a second -install_name on command line
-    DARWIN_VERS := $(shell echo $(TARGET_TRIPLE) | sed 's/.*darwin\([0-9]*\).*/\1/')
-    ifneq ($(DARWIN_VERS),8)
-       LLVMLibsOptions += -Wl,-install_name \
-                          -Wl,"@rpath/lib$(LIBRARYNAME)$(SHLIBEXT)"
-    endif
+    # $(CLANG_LEVEL)/../../Makefile.rules has been patched to set the
+    # install name for all dylibs.
 
     # If we're doing an Apple-style build, add the LTO object path.
     ifeq ($(RC_XBS),YES)
