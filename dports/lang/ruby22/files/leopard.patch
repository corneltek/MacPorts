--- vm_dump.c.orig	2015-11-27 20:36:34.000000000 -0800
+++ vm_dump.c	2015-11-27 20:37:52.000000000 -0800
@@ -436,7 +436,7 @@ rb_vmdebug_thread_dump_state(VALUE self)
 # ifdef HAVE_LIBUNWIND
 #  undef backtrace
 #  define backtrace unw_backtrace
-# elif defined(__APPLE__) && defined(__x86_64__)
+# elif defined(__APPLE__) && defined(__x86_64__) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1060
 #  define UNW_LOCAL_ONLY
 #  include <libunwind.h>
 #  undef backtrace
