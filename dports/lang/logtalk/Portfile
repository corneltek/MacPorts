# $Id: Portfile,v 1.1 2003/09/23 13:51:52 gwright Exp $

PortSystem	1.0
name		logtalk
version		2.15.4

categories	lang
maintainers	pmoura@mac.com
platforms	darwin freebsd linux
description	Logtalk - Open source object-oriented extension to Prolog

long_description	\
		Logtalk is an open source object-oriented extension to the 	\
		Prolog programming language. Integrating logic programming 	\
		with object-oriented and event-driven programming, it is 	\
		compatible with most Prolog compilers. It supports both 	\
		prototypes and classes. In addition, it supports component-	\
		based programming through category-based composition.
		

homepage		http://www.logtalk.org/
master_sites	http://www.logtalk.org/files/

checksums		md5 762f606b7d29480d720e37da9ed40a66

distname		lgt2154

configure		{}

build			{}

destroot		{
	system "mkdir ${destroot}${prefix}/share/${distname}"
	cd ${destroot}${prefix}/share/${distname}

	system "cp ${workpath}/${worksrcdir}/LICENSE ."
	system "cp ${workpath}/${worksrcdir}/QUICK_START ."
	system "cp ${workpath}/${worksrcdir}/README ."
	system "cp ${workpath}/${worksrcdir}/RELEASE_NOTES ."
	system "cp ${workpath}/${worksrcdir}/UPGRADING ."
	system "cp -R ${workpath}/${worksrcdir}/manuals ."
	system "cp -R ${workpath}/${worksrcdir}/examples ."

	system "mkdir ${destroot}${prefix}/lib/${distname}"
	cd ${destroot}${prefix}/lib/${distname}

	system "cp -R ${workpath}/${worksrcdir}/compiler ."
	system "cp -R ${workpath}/${worksrcdir}/configs ."
	system "cp -R ${workpath}/${worksrcdir}/library ."
	system "cp -R ${workpath}/${worksrcdir}/wenv ."
	system "cp -R ${workpath}/${worksrcdir}/xml ."

	if {[variant_isset gprolog]} {
		system "mkdir ${destroot}${prefix}/lib/${distname}/bin"
		cd ${destroot}${prefix}/lib/${distname}/bin
		system "cp ${workpath}/${worksrcdir}/gplgt ."
	}

	if {[variant_isset swi-prolog]} {
		system "mkdir ${destroot}${prefix}/lib/${distname}/bin"
		cd ${destroot}${prefix}/lib/${distname}/bin
		system "cp ${workpath}/${worksrcdir}/logtalk.rc ."
		system "cp ${workpath}/${worksrcdir}/swilgt ."
	}
}

post-destroot	{
	cd ${destroot}/${prefix}/lib
	system "ln -s ${distname} logtalk"

	cd ../share
	system "ln -s ${distname} logtalk"

	if {[variant_isset gprolog]} {
		cd ../bin
		system "ln -s ../lib/${distname}/bin/gplgt gplgt"
	}

	if {[variant_isset swi-prolog]} {
		cd ../bin
		system "ln -s ../lib/${distname}/bin/swilgt swilgt"
	}
}

variant	gprolog	{
	depends_lib bin:gplc:gprolog
	
	build {
		cd ${workpath}/${worksrcdir}

		system "cp configs/gnu.config configs/gnu.pl"
		system "echo ':- built_in.' > compiler/gp"
		system "cat compiler/gp compiler/logtalk.pl > compiler/logtalkgp.pl"
		system "gplc -o gplgt configs/gnu.pl compiler/logtalkgp.pl"
		system "rm configs/gnu.pl"
		system "rm compiler/gp"
	}
}

variant	swi-prolog	{
	depends_lib bin:swipl:swi-prolog
	
	build {
		cd ${workpath}/${worksrcdir}

		system "echo ':- consult(${prefix}/lib/logtalk/configs/swi.config).' > logtalk.rc"
		system "echo ':- consult(${prefix}/lib/logtalk/compiler/logtalk.pl).' >> logtalk.rc"
		reinplace "s|\(|('|g" logtalk.rc
		reinplace "s|\)|')|g" logtalk.rc

		system "echo '#/bin/sh' > swilgt"
		system "echo 'swipl -f ${prefix}/lib/logtalk/bin/logtalk.rc' >> swilgt"
		system "chmod a+x swilgt"
	}
}
