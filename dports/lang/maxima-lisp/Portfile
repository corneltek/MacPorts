# $Id: Portfile,v 1.3 2004/01/17 22:45:29 toby Exp $

PortSystem 1.0
name		maxima-lisp
version		2.29
categories	lang
maintainers	gwright@comcast.net
platforms	darwin

description	The Clisp Common Lisp Implementation, as used by Maxima
long_description	\
		CLISP is a Common Lisp implementation by Bruno Haible,	\
		formerly of Karlsruhe University, and Michael Stoll,	\
		formerly of Munich University, both in Germany.		\
		It mostly supports the Lisp described in the ANSI	\
		Common Lisp standard.					\
									\
		CLISP includes an interpreter, a compiler, almost all	\
		of CLOS, a foreign language interface and a socket	\
		interface.  An X11 interface is available through CLX	\
		and Garnet.  Command line editing is provided by	\
		readline.

#bugs		Version 2.29 is compatible with maxima 5.9.0. Version \
#		2.30 introduced floating point bugs that maxima trips \
#		over. 2.31 doesn't build under OS X yet.

set maxima-lisp-name	clisp

distfiles	${maxima-lisp-name}-${version}${extract.suffix}

homepage	http://clisp.cons.org/
master_sites	http://cvs2.cons.org/ftp-area/clisp/source/2.29/ \
		http://ftp.gnu.org/pub/gnu/clisp/release/ \
		sourceforge

checksums	md5 53f7cfba5c5f3f7d536541e1df210b74

pre-patch	{ cd ${workpath}
		  file rename  ${maxima-lisp-name} ${maxima-lisp-name}-${version}
		}

patchfiles	patch-Makefile.in	\
		patch-_clisp.c		\
		patch-_distmakefile	\
		patch-configure		\
		patch-makemake.in	\
		patch-stream.d

worksrcdir	${maxima-lisp-name}-${version}
build.dir	${workpath}/${worksrcdir}/src

pre-configure	{ file rename ${build.dir}/_${maxima-lisp-name}.1 \
			      ${build.dir}/_${name}.1
		  file rename ${build.dir}/_${maxima-lisp-name}.html \
			      ${build.dir}/_${name}.html

		  file rename ${build.dir}/readline/doc/clreadline.3 \
			      ${build.dir}/readline/doc/mlreadline.3
		  file rename ${build.dir}/readline/doc/clreadline.html \
			      ${build.dir}/readline/doc/mlreadline.html
		  file rename ${build.dir}/readline/doc/clreadline.dvi \
			      ${build.dir}/readline/doc/mlreadline.dvi

		  file rename ${build.dir}/gettext/po/clisplow_de.gmo \
			      ${build.dir}/gettext/po/maxima-lisplow_de.gmo
		  file rename ${build.dir}/gettext/po/clisplow_en.gmo \
			      ${build.dir}/gettext/po/maxima-lisplow_en.gmo
		  file rename ${build.dir}/gettext/po/clisplow_es.gmo \
			      ${build.dir}/gettext/po/maxima-lisplow_es.gmo
		  file rename ${build.dir}/gettext/po/clisplow_fr.gmo \
			      ${build.dir}/gettext/po/maxima-lisplow_fr.gmo
		  file rename ${build.dir}/gettext/po/clisplow_nl.gmo \
			      ${build.dir}/gettext/po/maxima-lisplow_nl.gmo
		}

post-configure	{ cd ${build.dir}
		  system "./makemake --without-dynamic-ffi \
			  --with-readline --with-gettext \
			  --prefix=${prefix} > Makefile"

		  system "make config.lisp"
		}

build		{ system "ulimit -s 8192 && \
			  cd ${build.dir} && \
			  make && \
			  make check"
		}

pre-destroot	{ cd ${build.dir} }

post-destroot	{ file rename ${destroot}/${prefix}/bin/${maxima-lisp-name} \
			      ${destroot}/${prefix}/bin/${name}
		}

