# $Id: Portfile,v 1.2 2003/11/17 21:19:58 jkh Exp $

PortSystem 1.0
name		erlang
version		R9C-0
categories	lang
maintainers	gwright@comcast.com
platforms	darwin
description	The Erlang Programming Language
long_description	\
		Erlang is a programming language designed at the	\
		Ericsson Computer Science Laboratory. Open-source	\
		Erlang is being released to help encourage the spread	\
		of Erlang outside Ericsson.				\
									\
		We are releasing free of charge:			\
			The entire source code of the current Erlang	\
			system.						\
			Extensive libraries of code for building robust	\
			fault-tolerant distributed applications.	\
			All with documentation.				\
									\
		All the above software has been battle tested in a	\
		number of Ericsson products, for example the new	\
		Ericsson ATM switch. 

homepage	http://www.erlang.org/
master_sites	http://www.erlang.org/download/

distfiles	otp_src_${version}${extract.suffix} \
		otp_man_${version}${extract.suffix} \
		otp_html_${version}${extract.suffix} \

checksums	otp_src_R9C-0.tar.gz  md5 d40842cf79ca65007de5ad54d3c50d18 \
		otp_man_R9C-0.tar.gz  md5 f94bbaba800cc73e67704b92df5aab60 \
		otp_html_R9C-0.tar.gz md5 6885f276d1501fd22a72ae421b4a94e6

#bugs           The patches fix the online help system. The		\
#               directory where the html documentation lives is         \
#               specified correctly, and "open" is used to display      \
#               them, so they are shown by the default web browser,     \
#               as opposed to the previously hardcoded Netscape.        \
#									\
#               For reasons unknown, the table visualizer doesn't       \
#               work properly. (the terminal window in which erl was	\
#		started does report an error.) Help with this would be	\
#		appreciated. Using the table visualizer can also	\
#		hang wish, likely another manifestation of the same	\
#		problem.						\
#									\
#		Sometimes wish windows appear empty---moving the	\
#		window slighly causes it to update properly.

extract.only	otp_src_${version}${extract.suffix}

depends_build	bin:gawk:gawk
depends_run	bin:wish:tk

patchfiles	patch-appmon.erl		\
		patch-appmon_a.erl		\
		patch-appmon.tool	 	\
		patch-dbg_ui_mon.erl		\
		patch-dbg_ui_trace.erl 		\
		patch-dbg_ui_view.erl		\
		patch-debugger.tool		\
		patch-pman_main.erl		\
		patch-pman_shell.erl		\
		patch-pman.tool			\
		patch-toolbar_lib.erl		\
		patch-tool_utils.erl		\
		patch-tv_main.erl		\
		patch-tv_pc_menu_handling.erl	\
		patch-tv.tool

pre-patch	{ file rename ${workpath}/otp_src_${version} ${workpath}/${name}-${version} }

configure.args	--prefix=${destroot}/${prefix}

post-destroot	{ cd ${destroot}/${prefix}/lib/erlang
		  system "tar zxvf ${distpath}/otp_html_${version}${extract.suffix}"
		  system "tar zxvf ${distpath}/otp_man_${version}${extract.suffix}"
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/bin/erl
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/bin/start
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/erts-5.3/bin/erl
		  reinplace s|${destroot}|| ${destroot}/${prefix}/lib/erlang/erts-5.3/bin/start

		  file delete ${destroot}/${prefix}/bin/ear
		  file delete ${destroot}/${prefix}/bin/ecc
		  file delete ${destroot}/${prefix}/bin/elink
		  file delete ${destroot}/${prefix}/bin/erl
		  file delete ${destroot}/${prefix}/bin/erlc
		  file delete ${destroot}/${prefix}/bin/escript

		  cd ${destroot}/${prefix}/bin

		  system "ln -s ../lib/erlang/bin/ear     ear"
		  system "ln -s ../lib/erlang/bin/ecc     ecc"
		  system "ln -s ../lib/erlang/bin/elink   elink"
		  system "ln -s ../lib/erlang/bin/erl     erl"
		  system "ln -s ../lib/erlang/bin/erlc    erlc"
		  system "ln -s ../lib/erlang/bin/escript escript"

		  file delete ${destroot}/${prefix}/lib/erlang/bin/epmd

		  cd ${destroot}/${prefix}/lib/erlang/bin

		  system "ln -s ../erts-5.3/bin/epmd      epmd"
		}

