# $Id: Portfile,v 1.21 2003/04/07 14:05:50 michaelm Exp $

PortSystem 1.0
name                       perl5.8
version                    5.8.0
revision                   3
categories                 lang
maintainers                michaelm@opendarwin.org
description                Perl 5.8.0
platforms                  darwin freebsd
distname                   perl-${version}
master_sites               http://www.cpan.org/src/5.0/
checksums                  md5 d9bdb180620306023fd35901a2878b62
global                     platform_dir
configure.cmd              sh Configure
unset                      configure.pre_args
configure.post_args        -des -Dinstallprefix=${destroot}/${prefix} \
                             -Dprefix='${prefix}' -Dccflags="-I'${prefix}/include'\
                             -I'${prefix}/include/db4' -Dldflags=-L'${prefix}/lib'"

variant threads            { configure.args-append -Dusethreads }


# set install* variables....
variant freebsd    {
                    set platform_dir freebsd
                   }
variant darwin     {
                    set platform_dir darwin
                    patchfiles     patch-perlio-darwin.diff
                   }

# fix install variables
post-install { 
              cd ${destroot}/${prefix}/lib/perl5/${version}/${platform_dir}
              system "cat Config.pm |sed s#${destroot}/##g  >Config.pm.new"
              system "cat .packlist | sed s#${destroot}/##g >.packlist.new"
              system  "mv Config.pm.new Config.pm && \
              mv .packlist.new .packlist"
             }
