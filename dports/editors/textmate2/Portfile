# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem              1.0
PortGroup               github 1.0

github.setup            textmate textmate a921f258e1eab5ee19e20e0f4700820ea5c51d6b
version                 2.0
revision                2012081100

maintainers             cal openmaintainer
name                    textmate2

categories              editors aqua
description             \
    TextMate brings Apple's approach to operating systems into the world of text editors. By \
    bridging UNIX underpinnings and GUI, TextMate cherry-picks the best of both worlds to the \
    benefit of expert scripters and novice users alike.
long_description        ${description}\
    TextMate is well-known for its large number of bundles adding support, snippets, completions \
    and commands for a huge number of file types.

platforms               darwin
license                 GPL-3+

fetch.type              git
post-fetch {
    system -W ${worksrcpath} "git submodule update --init"
}

patchfiles              patch-configure-use-exit-1.diff \
                        patch-configure-make-builddir-configurable.diff \
                        patch-configure-remove-brew-and-usr-local.diff

post-patch {
    reinplace "s|@BUILDDIR@|${worksrcpath}/build|g" ${worksrcpath}/configure
    fs-traverse file ${worksrcpath} {
        if {[file tail ${file}] == "target"} {
            reinplace "/TEST_SOURCES =/d" ${file}
        }
    }
}

supported_archs         i386
depends_build-append    port:ninja \
                        port:ragel \
                        port:mercurial \
                        port:proctools

set depends_skip_archcheck {ninja ragel mercurial proctools}

if {[vercmp ${xcodeversion} "4.4"] < 0} {
    depends_build-append    port:clang-3.2
    configure.compiler      macports-clang-3.2
}

depends_lib-append      port:boost \
                        port:multimarkdown \
                        port:pbzip2 \
                        port:curl \
                        port:openssl \
                        port:libiconv \
                        port:zlib

build.cmd               ninja
build.target            TextMate mate

destroot {
    copy ${worksrcpath}/build/Applications/TextMate/TextMate.app ${destroot}${applications_dir}
    xinstall -m 0755 ${worksrcpath}/build/Applications/mate/mate ${destroot}${prefix}/bin
    xinstall -m 0755 ${worksrcpath}/rmate/rmate ${destroot}${prefix}/bin
}
