# $Id: Portfile,v 1.40 2004/01/15 22:29:14 rshaw Exp $

PortSystem 1.0
name			vim
set vim_patchlevel	181
version			6.2.$vim_patchlevel
categories		editors
maintainers		mij@opendarwin.org
description		Vi "workalike" with many additional features
homepage		http://www.vim.org/
platforms		darwin freebsd

long_description	Vim is a virtually compatible, extremely \
					enhanced version of the vi editor.


set dist_version [strsed $version {s/\.[0-9]*$//}]

distfiles	$name-$dist_version-src1.tar.gz:vim \
			$name-$dist_version-src2.tar.gz:vim \
			$name-$dist_version-rt1.tar.gz:vim \
			$name-$dist_version-rt2.tar.gz:vim \
			$name-$dist_version-extra.tar.gz:extra \
			$name-$dist_version-lang.tar.gz:extra

master_sites	ftp://ftp.vim.org/pub/vim/unix/:vim \
				ftp://ftp.us.vim.org/pub/vim/unix/:vim \
				ftp://ftp2.us.vim.org/pub/vim/unix/:vim \
				ftp://ftp3.us.vim.org/pub/vim/unix/pub/mirrors/ftp.vim.org/vim/:vim \
				ftp://ftp.is.co.za/applications/editors/vim/unix/:vim \
				ftp://ftp.prz.tu-berlin.de/pub/unix/editors/vim/unix/:vim \
				ftp://ftp.mirror.ac.uk/sites/ftp.vim.org/pub/vim/unix/:vim \
				ftp://ftp.vim.org/pub/vim/extra/:extra\
				ftp://ftp.us.vim.org/pub/vim/extra/:extra \
				ftp://ftp2.us.vim.org/pub/vim/extra/:extra \
				ftp://ftp3.us.vim.org/pub/vim/extra/pub/mirrors/ftp.vim.org/vim/:extra \
				ftp://ftp.is.co.za/applications/editors/vim/extra/:extra \
				ftp://ftp.prz.tu-berlin.de/pub/unix/editors/vim/extra/:extra \
				ftp://ftp.mirror.ac.uk/sites/ftp.vim.org/pub/vim/extra/:extra

eval patch_sites	[strsed [strsed ${master_sites} g/unix/patches/] g/:vim//]

dist_subdir		vim
distname		vim62

configure.args		--enable-gui=no --without-x --disable-gpm

set vim_badpatches	{}

eval patchfiles		[split [exec /usr/bin/jot -s " " -w \
			[strsed $version {s/\.[0-9]*$//}].%03d \
			$vim_patchlevel 1 $vim_patchlevel] " "]

foreach p ${vim_badpatches} {
			patchfiles-delete 6.2.${p}
}

variant aqua	{
	master_sites-append		http://www.douglas.stebila.ca/code/vim/app/:app_aqua \
							http://www.douglas.stebila.ca/code/vim/doc/:doc_aqua \
							http://macvim.swdev.org/OSX/files/:osx_aqua
	distfiles-append		app.tar.gz:app_aqua \
							doc.tar.gz:doc_aqua \
							macrt.tar.bz2:osx_aqua \
							gvim.app.tgz:osx_aqua
	checksums-append		app.tar.gz md5 19b2d3dd6f5ba161e55186e7a1c11c5b \
							doc.tar.gz md5 692f7874fc617162d0fe110daf39a98a \
							macrt.tar.bz2 md5 f0b89d856ba60015006f87cb951fe8a9 \
							gvim.app.tgz md5 9bf75f5b661d2e9cd6a6f346a821b24e
	extract.only-delete		macrt.tar.bz2 \
							gvim.app.tgz
	post-extract {
		ui_info "$UI_PREFIX Extracting macrt.tar.bz2"
		system "cd ${workpath} && \
			bzip2 -dc ${distpath}/macrt.tar.bz2 | tar xf -"
		ui_info "Done"
		ui_info "$UI_PREFIX Extracting gvim.app.tgz"
		system "cd ${workpath} && \
			gzip -dc ${distpath}/gvim.app.tgz | tar xf -"
		ui_info "Done"
	}
	configure.args	{}
	post-configure	{
		reinplace "s|/Applications/vim|/Applications/DarwinPorts/Vim|" ${workpath}/gvim
		reinplace "s|/Applications/vim|/Applications/DarwinPorts/Vim|" ${workpath}/gvim.app/Contents/Resources/script
	}
	post-destroot	{
		xinstall -d -m 755 ${destroot}/Applications/DarwinPorts
		system "ditto -rsrcFork ${workpath}/gvim.app \
			${destroot}/Applications/DarwinPorts/GVim.app"
		xinstall -d -m 755 ${destroot}/Applications/DarwinPorts/Vim
		system "ditto -rsrcFork ${worksrcpath}/src/Vim.app \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app"
		system "ln -s -f /Applications/DarwinPorts/Vim/Vim.app/Contents/MacOS/Vim \
			${destroot}/${prefix}/bin/vim"
		xinstall -m 755 ${workpath}/gvim ${destroot}/${prefix}/bin/
		system "ditto ${workpath}/runtime \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app/runtime"
		xinstall -m 644 ${workpath}/gvimrc \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app/
		xinstall -m 644 ${workpath}/vimrc \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app/
		xinstall -m 644 ${workpath}/doc-txt.icns \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app/Contents/Resources/
		xinstall -m 644 ${workpath}/app.icns \
			${destroot}/Applications/DarwinPorts/Vim/Vim.app/Contents/Resources/gui_mac.icns
	}
}
variant x11			{ configure.args --enable-gui=auto --with-x }
variant tiny		{ configure.args-append	--with-features=tiny }
variant small		{ configure.args-append	--with-features=small }
variant big			{ configure.args-append	--with-features=big }
variant huge		{ configure.args-append	--with-features=huge }
variant multibyte	{ configure.args-append	--enable-multibyte }
variant ncurses		{ configure.args-append --with-tlib=ncurses }

include checksums

