--- Makefile.orig	2012-01-10 15:54:49.000000000 -0600
+++ Makefile	2012-01-15 17:40:40.000000000 -0600
@@ -90,7 +90,7 @@
 
 # build pianobar
 ifeq (${DYNLINK},1)
-pianobar: ${PIANOBAR_OBJ} ${PIANOBAR_HDR} libpiano.so.0
+pianobar: ${PIANOBAR_OBJ} ${PIANOBAR_HDR} libpiano.0.dylib
 	@echo "  LINK  $@"
 	@${CC} -o $@ ${PIANOBAR_OBJ} ${LDFLAGS} -lao -lpthread -lm -L. -lpiano \
 			${LIBFAAD_LDFLAGS} ${LIBMAD_LDFLAGS} ${LIBGNUTLS_LDFLAGS}
@@ -104,15 +104,15 @@
 endif
 
 # build shared and static libpiano
-libpiano.so.0: ${LIBPIANO_RELOBJ} ${LIBPIANO_HDR} ${LIBWAITRESS_RELOBJ} \
+libpiano.0.dylib: ${LIBPIANO_RELOBJ} ${LIBPIANO_HDR} ${LIBWAITRESS_RELOBJ} \
 		${LIBWAITRESS_HDR} ${LIBEZXML_RELOBJ} ${LIBEZXML_HDR} \
 		${LIBPIANO_OBJ} ${LIBWAITRESS_OBJ} ${LIBEZXML_OBJ}
 	@echo "  LINK  $@"
-	@${CC} -shared -Wl,-soname,libpiano.so.0 ${CFLAGS} ${LDFLAGS} ${LIBGNUTLS_LDFLAGS} \
-			-o libpiano.so.0.0.0 ${LIBPIANO_RELOBJ} \
+	@${CC} -dynamiclib -Wl,-install_name,${LIBDIR}/libpiano.0.dylib ${CFLAGS} ${LDFLAGS} ${LIBGNUTLS_LDFLAGS} \
+			-o libpiano.0.0.0.dylib ${LIBPIANO_RELOBJ} \
 			${LIBWAITRESS_RELOBJ} ${LIBEZXML_RELOBJ}
-	@ln -s libpiano.so.0.0.0 libpiano.so.0
-	@ln -s libpiano.so.0 libpiano.so
+	@ln -s libpiano.0.0.0.dylib libpiano.0.dylib
+	@ln -s libpiano.0.dylib libpiano.dylib
 	@echo "    AR  libpiano.a"
 	@${AR} rcs libpiano.a ${LIBPIANO_OBJ} ${LIBWAITRESS_OBJ} ${LIBEZXML_OBJ}
 
@@ -132,7 +132,7 @@
 	@echo " CLEAN"
 	@${RM} ${PIANOBAR_OBJ} ${LIBPIANO_OBJ} ${LIBWAITRESS_OBJ} ${LIBWAITRESS_OBJ}/test.o \
 			${LIBEZXML_OBJ} ${LIBPIANO_RELOBJ} ${LIBWAITRESS_RELOBJ} \
-			${LIBEZXML_RELOBJ} pianobar libpiano.so* libpiano.a waitress-test
+			${LIBEZXML_RELOBJ} pianobar libpiano*.dylib libpiano.a waitress-test
 
 all: pianobar
 
@@ -183,9 +183,9 @@
 
 install-libpiano:
 	install -d ${DESTDIR}/${LIBDIR}/
-	install -m644 libpiano.so.0.0.0 ${DESTDIR}/${LIBDIR}/
-	ln -s libpiano.so.0.0.0 ${DESTDIR}/${LIBDIR}/libpiano.so.0
-	ln -s libpiano.so.0 ${DESTDIR}/${LIBDIR}/libpiano.so
+	install -m644 libpiano.0.0.0.dylib ${DESTDIR}/${LIBDIR}/
+	ln -s libpiano.0.0.0.dylib ${DESTDIR}/${LIBDIR}/libpiano.0.dylib
+	ln -s libpiano.0.dylib ${DESTDIR}/${LIBDIR}/libpiano.dylib
 	install -m644 libpiano.a ${DESTDIR}/${LIBDIR}/
 	install -d ${DESTDIR}/${INCDIR}/
 	install -m644 src/libpiano/piano.h ${DESTDIR}/${INCDIR}/
