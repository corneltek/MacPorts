# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem  1.0

name        p5-graveyard
version     0.0
categories  perl

array set replacements {
    5.8  5.16
    5.10 5.16
    5.12 5.16
    5.14 5.16
}

proc handle_unfortunate_port_names action {
    foreach name {error eval lchown switch} {
        # Can't use 'switch' here, for obvious reasons.
        if {$action eq "hide"} {
            rename $name _$name
        } elseif {$action eq "show"} {
            rename _$name $name
        }
    }
}

proc unknown args {
    handle_unfortunate_port_names show
    upvar 1 replacements replacements
    if {[llength $args] < 3} {
        lappend args 5.8 5.10 5.12 5.14
    }
    foreach series [lassign $args port vers] {
        lassign [split $vers _] ver rev
        if {$rev eq ""} {
            set rev 0
        }
        set repl $replacements($series)
        subport p${series}-$port {
            version $ver
            revision $rev
            replaced_by py${repl}-$port
        }
    }
    handle_unfortunate_port_names hide
}

handle_unfortunate_port_names hide


# SUBPORT (without "p5*-" prefix)   VERSION+REV     REPLACED SERIES (defaults
#                                                   to "5.8 5.10 5.12 5.14")


handle_unfortunate_port_names show

if {${subport} ne ${name}} {
    PortGroup obsolete 1.0
} else {
    maintainers         larryv openmaintainer
    supported_archs     noarch
    universal_variant   no
    description         Metaport containing obsolete Perl subports
    long_description    This is a metaport for collecting obsolete \
                        Perl subports so they don't cause spurious \
                        build failures on the MacPorts buildslaves \
                        whenever their superports are modified. It \
                        cannot be installed.
    archive_sites
    pre-fetch {
        ui_error {This is a metaport for obsolete Perl subports.}
        return -code error {non-installable metaport}
    }
}
