# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

# This comment was inserted on 20160713 to force reindexing of
# this port after the default homepage definition in the perl5
# PortGroup was changed to use metacpan.org (r150080).
# Reindexing is necessary for the new definition to take effect.
# This comment may be removed in subsequent updates of this port.

PortSystem          1.0
PortGroup           perl5 1.0

# Keep relevant lines in sync between ImageMagick and p5-perlmagick.

epoch               1
perl5.branches      5.22 5.24
perl5.setup         PerlMagick 6.9.5-0
set reasonable_version \
                    [lindex [split ${version} -] 0]
set my_name         ImageMagick
maintainers         futurelab.ch:astricker ryandesign
description         Perl extension for calling ImageMagick's libMagick methods
long_description    ${description}
license             Apache-2
platforms           darwin
use_xz              yes

# we use the ImageMagick distribution version of PerlMagick to
# ensure it will always match ImageMagick version installed

master_sites        http://www.imagemagick.org/download/ \
                    http://mirror.checkdomain.de/imagemagick/ \
                    ftp://ftp.u-aizu.ac.jp/pub/graphics/image/ImageMagick/imagemagick.org/ \
                    ftp://ftp.sunet.se/pub/multimedia/graphics/ImageMagick \
                    ftp://sunsite.icm.edu.pl/packages/ImageMagick

dist_subdir         ImageMagick
distname            ${my_name}-${version}

checksums           rmd160  3ab6b9aca891c992502d9c8c6ab07cd571c6904d \
                    sha256  7830ce045bde3283b7479cf6b039a0956253f058e1a47da7fbe1003d6dad30b4

if {${perl5.major} != ""} {
depends_lib-append  port:ImageMagick

configure.dir       ${worksrcpath}/PerlMagick
build.dir           ${configure.dir}

pre-configure {
    system -W ${worksrcpath} "CC=${configure.cc} CXX=${configure.cxx} ./configure --prefix=${prefix} --disable-openmp --with-quantum-depth=16 --with-perl=${perl5.bin}"
    system -W ${worksrcpath} "make perl-sources"
}

use_parallel_build  no

livecheck.type      none
} else {
livecheck.version   ${reasonable_version}
livecheck.type      regex
livecheck.url       [lindex ${master_sites} 0]
livecheck.regex     ${my_name}-(6(?:\\.\\d+)*)(?:-\\d+)?
}
