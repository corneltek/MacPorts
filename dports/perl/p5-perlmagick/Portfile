# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem                  1.0
PortGroup                   perl5 1.0

# Keep relevant lines in sync between ImageMagick and p5-perlmagick.

epoch                       1
perl5.branches              5.8 5.10 5.12 5.14 5.16 5.18
perl5.setup                 PerlMagick 6.8.8-10
set reasonable_version      [lindex [split ${version} -] 0]
set my_name                 ImageMagick
maintainers                 futurelab.ch:astricker ryandesign
description                 Perl extension for calling ImageMagick's libMagick methods
long_description            ${description}
license                     Apache-2
platforms                   darwin
use_xz                      yes

# we use the ImageMagick distribution version of PerlMagick to
# ensure it will always match ImageMagick version installed

master_sites                http://www.imagemagick.org/download/ \
                            http://mirror.checkdomain.de/imagemagick/ \
                            ftp://ftp.u-aizu.ac.jp/pub/graphics/image/ImageMagick/imagemagick.org/ \
                            ftp://ftp.sunet.se/pub/multimedia/graphics/ImageMagick \
                            ftp://sunsite.icm.edu.pl/packages/ImageMagick

dist_subdir                 ImageMagick
distname                    ${my_name}-${version}

checksums                   rmd160  8ef4e88da0fb17051f4fff761b3bda8cd85a4aaa \
                            sha256  f31c7771ed0b8050837289f0c7b55303172e31acc005b0ee0d120727e2572d33

if {${perl5.major} != ""} {
depends_lib-append          port:ImageMagick

    configure.dir           ${worksrcpath}/PerlMagick
    build.dir               ${configure.dir}

    pre-configure {
        system -W ${worksrcpath} "CC=${configure.cc} CXX=${configure.cxx} ./configure --prefix=${prefix} --disable-openmp --with-quantum-depth=16 --with-perl=${perl5.bin}"
        system -W ${worksrcpath} "make perl-sources"
    }

livecheck.type              none
} else {
livecheck.version           ${reasonable_version}
livecheck.type              regex
livecheck.url               [lindex ${master_sites} 0]
livecheck.regex             ${my_name}-(\\d+(?:\\.\\d+)*)(?:-\\d+)?
}
