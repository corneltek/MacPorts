# $Id$

PortSystem          1.0
PortGroup           ocaml 1.0

name                ocaml-react
version             1.2.0
revision            1
categories          devel ml
license             BSD
maintainers         mww openmaintainer
description         Functional reactive progreamming for OCaml
long_description    React is an OCaml module for functional reactive programming (FRP).\
                    It provides support to program with time varying values : applicative \
                    events and signals. React doesn't define any primitive event or signal, \
                    this lets the client chooses the concrete timeline.
homepage            http://erratique.ch/software/react
platforms           darwin

master_sites        http://erratique.ch/software/react/releases/
use_bzip2           yes
extract.suffix      .tbz
distname            react-${version}

depends_build       port:ocaml-findlib
depends_lib         port:ocaml

checksums           rmd160  07a2621d5bef6c6509b80d7385393fbcded5139c \
                    sha256  887aaea9191870bc0f37f945c02ec4c90497d949cd4dedc3d565c3fbec7ad04e

use_configure       no

build {
  # from 'opam'
  system "cd ${worksrcpath} && ${ocaml} pkg/git.ml"
  system "cd ${worksrcpath} && ${ocaml} pkg/build.ml native=true native-dynlink=true"
}

livecheck.type      regex
livecheck.url       http://erratique.ch/software/react/releases/
livecheck.regex     react-(\[0-9.\]+)${extract.suffix}

set docdir ${destroot}${prefix}/share/doc/${name}
set libdir ${destroot}${ocamlfind_dir}/react
destroot {
  # from 'react.install'
  xinstall -m 0755 -d ${docdir} ${libdir}
  xinstall -m 0644 "${worksrcpath}/_build/CHANGES.md" "${docdir}/CHANGES.md"
  xinstall -m 0644 "${worksrcpath}/_build/README.md" "${docdir}/README.md"

  xinstall -m 0644 "${worksrcpath}/_build/pkg/META" "${libdir}/META"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.a" "${libdir}/react.a"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cma" "${libdir}/react.cma"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cmi" "${libdir}/react.cmi"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cmti" "${libdir}/react.cmti"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cmx" "${libdir}/react.cmx"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cmxa" "${libdir}/react.cmxa"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.cmxs" "${libdir}/react.cmxs"
  xinstall -m 0644 "${worksrcpath}/_build/src/react.mli" "${libdir}/react.mli"
  xinstall -m 0644 "${worksrcpath}/_build/src/react_top.a" "${libdir}/react_top.a"
  xinstall -m 0644 "${worksrcpath}/_build/src/react_top.cma" "${libdir}/react_top.cma"
  xinstall -m 0644 "${worksrcpath}/_build/src/react_top.cmxa" "${libdir}/react_top.cmxa"
  xinstall -m 0644 "${worksrcpath}/_build/src/react_top.cmxs" "${libdir}/react_top.cmxs"
}
