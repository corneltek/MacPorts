# $Id$

PortSystem              1.0

name                    dyld-headers
version                 195.6
revision                1
categories              devel
maintainers             mfeiri jeremyhu openmaintainer
homepage                http://opensource.apple.com/source/dyld/
master_sites            http://opensource.apple.com/tarballs/dyld/
license                 APSL-2.0
description             Header files for the dynamic linker
long_description        Provides header files and man pages for the dynamic \
                        linking and loading facilities in Mac OS X and Darwin

distname                dyld-${version}
checksums               rmd160  440c49f641e45a7bce459aaea2c4fe0dd0385351 \
                        sha256  69296e9b4192bdac778ea899fffc18b02be62b51b5e8474b4cf85ae5f2b08aa4

if {${os.major} < 9} {
    # The main reason for using the older 97.1 on Tiger is because of the change for Availability.h
    version             97.1
    revision            1
    distname            dyld-${version}
    checksums           rmd160  86f82f58d610e7beea4b035aa528d2fdea85dcb8 \
                        sha256  917c88c6efb507511353e82ce9b453ac9c4da3156fafae4955ae11d2fcc4f181
} elseif {${os.major} < 11} {
    # We can probably use 195 headers or later on Leopard but I haven't verified yet.
    version             132.13
    revision            1
    distname            dyld-${version}
    checksums           rmd160  15636fd3b237575a8301d0d1d659f4aa7e018012 \
                        sha256  31d8767d4fcb2b9f861fe91cae97f411fe0df48b1bd5f5725d09311b5e62346e
}

post-patch {
    reinplace "s|/usr/local|${prefix}|g" \
            ${worksrcpath}/dyld.xcodeproj/project.pbxproj
    reinplace "s|/usr|${prefix}|g" \
            ${worksrcpath}/dyld.xcodeproj/project.pbxproj

    if {${os.major} < 9} {
        reinplace "/version.pl/s/\".*\"/\"echo 'const char __dyld_version\[\] = \\\\\"@(#) dyld-97.1\\\\\";' > \${BUILT_PRODUCTS_DIR}\\/version.c\\\\n\"/" ${worksrcpath}/dyld.xcodeproj/project.pbxproj
        reinplace "s/AVAILABLE_MAC_OS_X_VERSION_10_\\(.\\)_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5/AVAILABLE_MAC_OS_X_VERSION_10_\\1_AND_LATER/" ${worksrcpath}/include/mach-o/dyld.h
        reinplace "s/AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER/__attribute__((weak_import))/" ${worksrcpath}/include/dlfcn.h
    }
}

use_configure no
build {}

destroot {
    system "ditto ${worksrcpath}/include ${destroot}${prefix}/include"
    #system "ditto ${worksrcpath}/doc/man ${destroot}${prefix}/share/man"
}

livecheck.type          regex
livecheck.regex         "dyld-(\[\\d.\]+)"
