# $Id: Portfile,v 1.1 2004/02/08 07:29:11 bbraun Exp $

PortSystem 1.0
name            cc65
version         2.9.3
categories      devel
maintainers     bbraun@opendarwin.org
description     Cross compiler for 6502
long_description "Crosscompiler/Crossassembler for 6502 systems. A C crosscompiler for 6502 systems, including a macroassembler that supports 6502, 65SC02 and 65816 CPUs, a linker, an archiver and some other tools. To create programs for one of the supported target machines, you have to install at least one of the library packages."
homepage        http://www.cc65.org/
master_sites    http://www.nic.funet.fi/pub/cbm/programming/cc65/
distfiles       ${name}-sources-${version}.tar.bz2 ${name}-c64-${version}.zip
checksums       ${name}-sources-${version}.tar.bz2 md5 255a231cd475852545a5bad1d21e867d ${name}-c64-${version}.zip md5 8778a4be569e079f622178d1ea129b23

extract {
                cd ${workpath}
                system "tar jxf ${prefix}/var/db/dports/distfiles/${name}/${name}-sources-${version}.tar.bz2"
                system "mkdir ${workpath}/cc65-c64/"
                cd ${workpath}/cc65-c64
                system "unzip ${prefix}/var/db/dports/distfiles/${name}/${name}-c64-${version}.zip"
}

configure {}
build { 
                  cd ${worksrcpath}/src
                  system "make CDEFS='-DDCC65_INC=\\\"${prefix}/lib/cc65/include/\\\" -DCC65_LIB=\\\"${prefix}/lib/cc65/lib\\\"' -f make/gcc.mak"
                  cd ${worksrcpath}/libsrc
                  system "make"
}

set inst "install -o root -m 755"
destroot        { system "${inst} -d ${destroot}${prefix}/bin"
                  system "${inst} -d ${destroot}${prefix}/lib/cc65/lib/"
                  system "${inst} -d ${destroot}${prefix}/lib/cc65/include/geos/"
                  system "cp ${worksrcpath}/libsrc/*.lib ${destroot}${prefix}/lib/cc65/lib/"
                  system "cp ${worksrcpath}/libsrc/*.o ${destroot}${prefix}/lib/cc65/lib/"
                  system "chmod 644 ${destroot}${prefix}/lib/cc65/lib/*"
                  system "cp ${worksrcpath}/include/*.h ${destroot}${prefix}/lib/cc65/include/"
                  system "chmod 644 ${destroot}${prefix}/lib/cc65/include/*"
                  system "cp ${worksrcpath}/include/geos/*.h ${destroot}${prefix}/lib/cc65/include/geos/"
                  system "chmod 644 ${destroot}${prefix}/lib/cc65/include/geos/*"
                  foreach prog "ar65 ca65 cc65 cl65 da65 grc ld65 od65 ca65html" {
                          system "${inst} ${worksrcpath}/src/${prog}/${prog} ${destroot}${prefix}/bin/"
                  }

                  system "rm -rf ${workpath}/cc65-c64/include ${workpath}/cc65-c64/lib"
                  system "cp -R ${workpath}/cc65-c64/* ${destroot}/${prefix}/lib/cc65/"
}
