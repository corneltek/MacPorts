# $Id: Portfile,v 1.8 2003/08/05 09:29:01 jkh Exp $

PortSystem 1.0
name		cvsweb
version		2.0.6
revision	0
categories	devel www
maintainers	jpm@opendarwin.org
description	WWW interface for CVS repositories
long_description	\
	FreeBSD-CVSweb is a WWW CGI script that allows remote users to \
	browse a CVS repository tree via web.  It can display the revision \
	history of a file, as well as diffs between revisions and \
	downloading the whole file.
homepage	http://www.freebsd.org/projects/cvsweb.html
platforms	darwin
master_sites	\
	ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/local-distfiles/scop/ \
	ftp://ftp.se.FreeBSD.org/pub/FreeBSD/ports/local-distfiles/scop/ \
	ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/ports/local-distfiles/scop/ \
	ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/ports/local-distfiles/scop/ \
	ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/ports/local-distfiles/scop/ \
	http://people.FreeBSD.org/~scop/cvsweb/
checksums	md5 fd15c8521b26be858616a7ba52fc2c22
configure	{}
build		{}

set cgi_path ""
set httpd_conf_path ""
variant darwin {
	global cgi_path httpd_conf_path
	set cgi_path "/Library/WebServer/CGI-Executables/"
	set httpd_conf_path "/private/etc/httpd/"

	# apache darwinport interop
	if {[ file exists ${prefix}/sbin/httpd]} {
		set cgi_path "${prefix}/www/cgi-bin/"
		set httpd_conf_path "${prefix}/etc/apache/"
	}
	
	destroot {
		file mkdir ${destroot}${cgi_path}
		file mkdir ${destroot}${httpd_conf_path}
		system "install -m 755 ${worksrcpath}/cvsweb.cgi ${destroot}${cgi_path}"
		system "install -m 644 ${worksrcpath}/cvsweb.conf ${destroot}${httpd_conf_path}"
	}
}
variant freebsd {
	global cgi_path httpd_conf_path
	set cgi_path "/usr/local/www/cgi-bin/"
	set httpd_conf_path "/usr/local/etc/apache/"

	# apache darwinport interop
	if {[ file exists ${prefix}/sbin/httpd]} {
		set cgi_path "${prefix}/www/cgi-bin/"
		set httpd_conf_path "${prefix}/etc/apache/"
	}

	destroot {
		file mkdir ${destroot}${cgi_path}
		file mkdir ${destroot}${httpd_conf_path}
		system "install -m 755 ${worksrcpath}/cvsweb.cgi ${destroot}${cgi_path}"
		system "install -m 644 ${worksrcpath}/cvsweb.conf ${destroot}${httpd_conf_path}"
	}
}
