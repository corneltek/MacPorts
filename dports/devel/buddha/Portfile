# $Id: Portfile,v 1.2 2004/02/26 00:16:00 gwright Exp $

PortSystem 1.0
name		buddha
version		1.0
categories	devel
maintainers	gwright@comcast.com
platforms	darwin

description	A declarative debugger for Haskell 98 programs.
long_description	\
		Buddha is a debugger for Haskell 98 programs.		\
		To be more precise, it is a declarative debugger.	\
		It presents the evaluation of a Haskell program as	\
		a series of equivalences, rather than the more		\
		traditional stepwise presentation of debuggers for	\
		imperative languages.

homepage	http://www.cs.mu.oz.au/~bjpop/buddha/
master_sites	${homepage}/download

checksums	md5 528ad8d8a4802100769cc59bf1e2a498

depends_build	bin:ghc:ghc

#bugs		Buddha requires that the associated ghc be built	\
#		with profiling libraries. The is true for the ghc	\
#		installed by darwinports, but might not be if you	\
#		installed ghc by a different route.			\
#									\
#		Not all of the system libraries have buddha-ized	\
#		versions, and buddha will fail to produce debugging	\
#		versions of programs that use these libraries.

#user_notes	The buddha parser is not as smart as full haskell	\
#		and sometimes requires a type signature to help it	\
#		along. Try this if the original source file compiles	\
#		but under buddha you get 'ambiguous type' errors.

pre-configure	{ reinplace "s|-package lang|-package lang -package text|" \
		            ${worksrcpath}/transform/Makefile.in
		}

post-configure	{ reinplace s|${destroot}/${prefix}|${prefix}|g \
			    ${worksrcpath}/include/config.h
		}

configure.args	--prefix=${destroot}/${prefix} \
		--with-ghc=${prefix}/bin/ghc

pre-build	{ cd ${worksrcpath}
		  system "make depend"
		}

post-destroot	{ reinplace s|${destroot}/${prefix}|${prefix}|g \
			    ${destroot}/${prefix}/bin/buddha-init.sh

		  reinplace s|${destroot}/${prefix}|${prefix}|g \
			    ${destroot}/${prefix}/lib/${name}-${version}/buddha.pkg.conf

		  reinplace s|${destroot}/${prefix}|${prefix}|g \
			    ${destroot}/${prefix}/lib/${name}-${version}/mk.buddha.sh

		  cd ${destroot}/${prefix}/bin
		  file delete buddha
		  set script [open "${destroot}${prefix}/bin/buddha" w 755]
		  puts $script "#!/bin/sh"
		  puts $script "${prefix}/bin/buddha-1.0 $@"
		  puts $script ""
		  close $script
		  system "chmod 755 ${destroot}${prefix}/bin/buddha"
		}
