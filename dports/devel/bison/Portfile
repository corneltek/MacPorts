# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                bison
epoch               1
version             2.7.1
revision            1
categories          devel
platforms           darwin
license             GPL-3+
maintainers         mww

    installs_libs       no

    description         The Yacc-compatible Parser Generator
    long_description    Bison is a general-purpose parser generator \
                        that converts an annotated context-free \
                        grammar into a deterministic LR or generalized \
                        LR (GLR) parser employing LALR(1) parser \
                        tables. As an experimental feature, Bison can \
                        also generate IELR(1) or canonical LR(1) \
                        parser tables. Once you are proficient with \
                        Bison, you can use it to develop a wide range \
                        of language parsers, from those used in simple \
                        desk calculators to complex programming \
                        languages.

    depends_lib         port:gettext \
                        port:libiconv \
                        port:m4

homepage            http://www.gnu.org/software/bison

master_sites        gnu
use_xz              yes
checksums           rmd160  933257e61c1098160d4fd71063f340b2ee304671 \
                    sha256  b409adcbf245baadb68d2f66accf6fdca5e282cafec1b865f4b5e963ba8ea7fb

configure.args      --disable-silent-rules \
                    --infodir=${prefix}/share/info \
                    --mandir=${prefix}/share/man \
                    --disable-yacc

    test.run        yes
    test.target     check

    post-destroot {
        set docdir ${prefix}/share/doc/${name}
        xinstall -d ${destroot}${docdir}/examples/calc++
        xinstall -m 0444 -W ${worksrcpath} AUTHORS COPYING ChangeLog NEWS \
            THANKS TODO ${destroot}${docdir}
        xinstall -m 444 -W ${worksrcpath}/examples/calc++  \
            calc++-driver.cc calc++-driver.hh calc++-parser.cc \
            calc++-parser.hh calc++-parser.stamp calc++-parser.yy \
            calc++-scanner.cc calc++-scanner.ll calc++.cc location.hh \
            position.hh stack.hh test \
            ${destroot}${docdir}/examples/calc++
        # yacc manpage gets installed even with '--disable-yacc'
        if {! [variant_isset yacc]} {
            delete ${destroot}${prefix}/share/man/man1/yacc.1
        }
    }

variant yacc description "enable yacc compatibility" {
    configure.args-delete   --disable-yacc
}

    livecheck.type  regex
    livecheck.url   http://ftp.gnu.org/gnu/bison/
    livecheck.regex ${name}-(\\d+(?:\\.\\d+)*)
