# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.0

github.setup        rizsotto Bear 1.4.3
checksums           rmd160  66b88ea351b0db69777f4e1cacfe15453dfdee00 \
                    sha256  4a0f9525608653a92370a956dddc8b6b76b379d760f0d1a4730a5fac64f17f2a

maintainers         cal openmaintainer
license             GPL-3+
platforms           darwin

categories          devel
description         \
    Bear is a tool to generate compilation database for clang tooling.
long_description    ${description} \
    The JSON compilation database is used in clang project to provide \
    information how a single compilation unit was processed. When that is \
    available then it is easy to re-run the compilation with different \
    programs.

depends_build-append \
                    port:pkgconfig

depends_lib-append  port:libconfig-hr

platform darwin {
    # needs dprintf(), which doesn't seem to be available on SL
    if {${os.major} <= 10} {
        depends_lib
        depends_build
        pre-fetch {
            ui_error "Bear is not supported on Snow Leopard and earlier."
            error "unsupported platform"
        }
    }
}

set config          ${prefix}/etc/bear.conf
set dconfig         ${prefix}/etc/bear.conf.default
post-destroot {
    move ${destroot}${config} ${destroot}${dconfig}
}

post-activate {
    if {![file exists ${config}]} {
        xinstall -m 644 ${dconfig} ${config}
    }
}

notes "The default configuration file has been installed as\n  ${dconfig}.\nIf\
    ${config} does not exist, it will be created on activation from the default\
    file."
