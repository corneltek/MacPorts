# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           muniversal 1.0

name                cloog
conflicts           cloog-devel
epoch               1
version             0.18.2
revision            2

subport cloog-devel {
    conflicts       cloog
    epoch           0
    version         0.18.2
    revision        2
    set gitSHA1     22643c94eba7b010ae4401c347289f4f52b9cd2b
}

categories          devel math
platforms           darwin
license             LGPL-2.1+
maintainers         larryv

description         CLooG, the Chunky Loop Generator, generates code \
                    for scanning Z-polyhedra
long_description    CLooG is a free software and library to generate \
                    code for scanning Z-polyhedra. That is, it finds \
                    a code (e.g. in C, FORTRAN...) that reaches each \
                    integral point of one or more parameterized \
                    polyhedra. CLooG has been originally written to \
                    solve the code generation problem for optimizing \
                    compilers based on the polytope model. \
                    Nevertheless it is used now in various area e.g. \
                    to build control automata for high-level synthesis \
                    or to find the best polynomial approximation of \
                    a function. CLooG may help in any situation where \
                    scanning polyhedra matters. While the user has \
                    full control on generated code quality, CLooG is \
                    designed to avoid control overhead and to produce \
                    a very effective code.
homepage            http://www.cloog.org

subport cloog {
    depends_lib     port:gmp path:lib/pkgconfig/isl.pc:isl

    master_sites    http://www.bastoul.net/cloog/pages/download/count.php3?url=./
    checksums       rmd160  cbbbcbfb347efaa062aacd540c8735cce3b59d28 \
                    sha256  ba3cc2d3750dfcb51f65ce029f0dda31347b8eeed216b1bac6170ab12d967581
}
subport cloog-devel {
    depends_lib     port:gmp path:lib/pkgconfig/isl.pc:isl-devel

    master_sites    http://repo.or.cz/w/cloog.git/snapshot
    distname        ${gitSHA1}
    checksums       rmd160  73e2cef4d7904e7bf109ee2d1a3f4d5cf566b37c \
                    sha256  ea6b587d2cb8a19dbb34813b9497b9347f2eb99c3d4eb3a22f377d3c71bcf4ee

    worksrcdir      cloog
}

# prevent -L/lib from being added to LDFLAGS
# see http://groups.google.com/group/isl-development/t/37ad876557e50f2c 
subport cloog {
    patchfiles      0002-Generate-safety-parentheses-around-compound-expressi.patch \
                    0004-cloog_domain_cube-reimplement-using-documented-funct.patch \
                    0007-expose-clast_pprint_expr.patch \
                    0009-Use-isl_val-instead-of-isl_int.patch \
                    missing-cmake.patch \
                    patch-configure.diff
}
subport cloog-devel {
    patchfiles      patch-ax_create_pkgconfig_info.m4.diff \
                    patch-configure.ac.diff
}

# Don't link using "-flat_namespace -undefined suppress" on Yosemite and
# later (#45706).
subport cloog {
    patchfiles-append   yosemite-libtool.patch
}

subport cloog-devel {
    use_autoreconf      yes
}

configure.args-append   --disable-silent-rules \
                        --with-gmp=system \
                        --with-isl=system \
                        --with-osl=no

variant osl description {Build with OpenScop support (causes tests to fail)} {
    ui_warn "This variant causes tests to fail"
    depends_lib-append      port:openscop
    configure.args-replace  --with-osl=no --with-osl=system
}

test.run            yes
test.target         check

subport cloog {
    livecheck.type  regex
    livecheck.url   [lindex ${master_sites} 0]
    livecheck.regex ${name}-(\[0-9.\]+)${extract.suffix}
}
subport cloog-devel {
    livecheck.type  moddate
    livecheck.url   http://repo.or.cz/w/cloog.git/rss/refs/heads/master
}
