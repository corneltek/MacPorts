# $Id$

PortSystem          1.0

name                ocaml-pxp
version             1.2.2
categories          devel ml textproc
maintainers         mww openmaintainer
platforms           darwin
license             BSD
description         streaming XML input/output module for OCaml
long_description    Xmlm is an OCaml module providing streaming XML \
                    input/output. It aims at making XML processing robust and \
                    painless. The streaming interface can process documents \
                    without building an in-memory representation. It lets the \
                    programmer translate its data structures to XML documents \
                    and vice-versa. Functions are provided to easily transform \
                    arborescent data structures to/from XML documents.

homepage            http://projects.camlcity.org/projects/pxp.html
master_sites        http://download.camlcity.org/download/

distname            pxp-${version}

checksums           rmd160  3d282da4e63dbd821d6c313a97626f4e560e3881 \
                    sha256  0be6a4e5c1aa2caf60f4559a89a05d9d1ed41a00497dd4062b4709e8f04ec75a

depends_lib         port:ocaml \
                    port:ocaml-findlib \
                    port:ocaml-ocamlnet

configure.pre_args
configure.args      -with-lex

use_parallel_build  no
build.target        all opt

pre-destroot {
    set ocaml_site_path [exec ocamlfind printconf destdir]

    foreach file {gensrc/pxp-lex-iso88591/Makefile gensrc/pxp-lex-iso885910/Makefile \
        gensrc/pxp-lex-iso885913/Makefile gensrc/pxp-lex-iso885914/Makefile gensrc/pxp-lex-iso885915/Makefile \
        gensrc/pxp-lex-iso885916/Makefile gensrc/pxp-lex-iso88592/Makefile gensrc/pxp-lex-iso88593/Makefile \
        gensrc/pxp-lex-iso88594/Makefile gensrc/pxp-lex-iso88595/Makefile gensrc/pxp-lex-iso88596/Makefile \
        gensrc/pxp-lex-iso88597/Makefile gensrc/pxp-lex-iso88598/Makefile gensrc/pxp-lex-iso88599/Makefile \
        gensrc/pxp-lex-utf8/Makefile gensrc/pxp-ulex-utf8/Makefile gensrc/pxp-wlex/Makefile \
        gensrc/pxp-wlex-utf8/Makefile src/pxp/Makefile src/pxp-engine/Makefile src/pxp-pp/Makefile} {
        reinplace "s|\$(OCAMLFIND) install|\$(OCAMLFIND) install -destdir ${destroot}/${ocaml_site_path}|g" "${worksrcpath}/${file}"
    }

    xinstall -m 755 -d ${destroot}${ocaml_site_path}
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     pxp-(\[0-9.\]+)${extract.suffix}
