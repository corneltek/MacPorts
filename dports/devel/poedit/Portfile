# $Id$

PortSystem      1.0
PortGroup       github 1.0

github.setup    vslavik poedit 1.5.4 v
categories      devel aqua
platforms       darwin
license         MIT
maintainers     raimue \
                openmaintainer

description     Poedit is a cross-platform gettext catalogs (.po files) editor.
long_description \
    Poedit is a cross-platform gettext catalogs (.po files) editor. It aims to \
    provide more convenient approach to editing catalogs than editing the file by \
    hand. This port installs Poedit.app.

homepage        http://www.poedit.net/

checksums       rmd160  61df8c9da497be70f9dc6971993afcbe20c44669 \
                sha256  e127ee58131a4a6cfe762559aea380e7afc98e889d301e1a338b72716576a463

depends_build   bin:grep:grep \
                port:pkgconfig \
                port:bakefile \
                port:asciidoc \
                port:xmlto \
                port:docbook-xml-4.2 \
                port:docbook-xsl \
                port:boost \
                port:libicns \
                port:autoconf \
                port:automake
depends_lib     port:wxWidgets \
                port:gettext

depends_skip_archcheck grep pkgconfig bakefile asciidoc xmlto

use_autoconf    yes
autoconf.cmd    ./bootstrap

variant wxwidgets_devel description {Uses wxWidgets-devel (allows 64-bit build)} {
    depends_lib-delete        port:wxWidgets
    depends_lib-append        port:wxWidgets-devel
}

# python crashes while running bakefile_gen without this patch
# it might be worth investigating why
post-patch {
    reinplace "s|(cd win32 ; bakefile_gen) && ||" ${worksrcpath}/bootstrap
}

if {![variant_isset wxwidgets_devel]} {
    # wxWidgets 2.8 is not universal and is 32-bit only
    universal_variant       no
    supported_archs         i386 ppc
}

# remove some additional features, especially sparkle because macports handles updates
configure.args  --disable-transmem --disable-spellchecking --without-sparkle

build.dir           ${build.dir}/src
build.target        bundle
build.env-append    GETTEXT_PREFIX=${prefix}

destroot {
    # the gettext binaries are copied into Poedit.app during build,
    # but we rather delete and symlink them to get updates to gettext automatically
    foreach extra { msgfmt msgmerge msgunfmt xgettext } {
        file delete ${worksrcpath}/src/Poedit.app/Contents/MacOS/${extra}
        ln -s ${prefix}/bin/${extra} ${worksrcpath}/src/Poedit.app/Contents/MacOS/${extra}
    }
    file delete ${worksrcpath}/src/Poedit.app/Contents/MacOS/gnu_gettext.COPYING

    file copy ${worksrcpath}/src/Poedit.app ${destroot}${applications_dir}/Poedit.app
}

variant transmem description {Enables translation memory for often used phrases} {
    depends_lib-append      port:db44
    configure.args-delete   --disable-transmem
    configure.args-append   --enable-transmem
}

variant spellcheck description {Enables spellchecking} {
    depends_lib-append      port:gtkspell2
    configure.args-delete   --disable-spellchecking
    configure.args-append   --enable-spellchecking
}

platform darwin 12 {
    depends_lib-replace    port:wxWidgets port:wxWidgets30
}
