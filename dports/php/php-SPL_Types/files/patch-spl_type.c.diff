http://svn.php.net/viewvc?view=revision&revision=269162
http://svn.php.net/viewvc?view=revision&revision=313528
http://svn.php.net/viewvc?view=revision&revision=313585
--- spl_type.c.orig	2008-01-13 11:06:28.000000000 -0600
+++ spl_type.c	2012-05-25 18:00:22.000000000 -0500
@@ -90,7 +90,11 @@
 
 	ALLOC_HASHTABLE(object->std.properties);
 	zend_hash_init(object->std.properties, 0, NULL, ZVAL_PTR_DTOR, 0);
+#if PHP_VERSION_ID >= 50400
+	object_properties_init(&object->std, class_type);
+#else
 	zend_hash_copy(object->std.properties, &class_type->default_properties, (copy_ctor_func_t) zval_add_ref, (void *) &tmp, sizeof(zval *));
+#endif
 
 	retval.handle = zend_objects_store_put(object, (zend_objects_store_dtor_t) zend_objects_destroy_object, (zend_objects_free_object_storage_t) spl_type_object_free_storage, NULL TSRMLS_CC);
 	retval.handlers = &spl_handler_SplType;
@@ -402,7 +402,7 @@
 	return spl_type_object_new_ex(class_type, 1, NULL, spl_type_set_float TSRMLS_CC);
 }
 /* {{{ Method and class definitions */
-static ZEND_BEGIN_ARG_INFO_EX(arg_SplType___construct, 0, 0, 0)
+ZEND_BEGIN_ARG_INFO_EX(arg_SplType___construct, 0, 0, 0)
 	ZEND_ARG_INFO(0, initial_value)
 	ZEND_ARG_INFO(0, strict)
 ZEND_END_ARG_INFO()
@@ -412,7 +412,7 @@
 	{NULL, NULL, NULL}
 };
 
-static ZEND_BEGIN_ARG_INFO_EX(arg_SplEnum_getConstList, 0, 0, 0)
+ZEND_BEGIN_ARG_INFO_EX(arg_SplEnum_getConstList, 0, 0, 0)
 	ZEND_ARG_INFO(0, include_default)
 ZEND_END_ARG_INFO()
 
