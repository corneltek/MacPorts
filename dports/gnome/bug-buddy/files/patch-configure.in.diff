--- configure.in.orig	2010-03-29 01:37:59.000000000 -0700
+++ configure.in	2011-10-08 08:07:52.000000000 -0700
@@ -34,6 +34,7 @@
 LIBSOUP_REQUIRED="libsoup-2.4"
 LIBGTOP_REQUIRED="libgtop-2.0 >= 2.13.3"
 LIBGCONF_REQUIRED="gconf-2.0"
+LIBELF_REQUIRED="libelf"
 
 PKG_CHECK_MODULES(BUG_BUDDY, 
 [
@@ -47,6 +48,7 @@
 	$LIBSOUP_REQUIRED
 	$LIBGTOP_REQUIRED
 	$LIBGCONF_REQUIRED
+	$LIBELF_REQUIRED
 ])
 
 AC_SUBST(BUG_BUDDY_CFLAGS)
@@ -70,9 +72,18 @@
 
 
 AC_CHECK_LIB(elf, elf_version)
+
+saveCPPFLAGS=$CPPFLAGS
+saveCFLAGS=$CFLAGS
+CPPFLAGS="$BUG_BUDDY_CFLAGS $CPPFLAGS"
+CFLAGS="$BUG_BUDDY_CFLAGS $CFLAGS"
+
 AC_CHECK_HEADERS([libelf.h],[],[AC_MSG_ERROR([libelf.h not found.])])
 AC_CHECK_HEADERS([gelf.h],[],[AC_MSG_ERROR([gelf.h not found.])])
 
+CPPFLAGS=$saveCPPFLAGS
+CFLAGS=$saveCFLAGS
+
 AC_ARG_ENABLE([google-breakpad],
 	[AC_HELP_STRING([--enable-google-breakpad],
 			[Enable support for retrieving minidumps with Google \
@@ -117,6 +128,7 @@
 PKG_CHECK_MODULES(GNOME_BREAKPAD,
 [
 	$GDK_REQUIRED
+        $LIBELF_REQUIRED
 ])
 AC_SUBST(GNOME_BREAKPAD_CFLAGS)
 AC_SUBST(GNOME_BREAKPAD_LIBS)
