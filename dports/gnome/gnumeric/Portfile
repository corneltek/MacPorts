# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           active_variants 1.0

name                gnumeric
version             1.12.7
set branch          [join [lrange [split ${version} .] 0 1] .]

license             GPL-2+
maintainers         me.com:c.herbig openmaintainer
categories          gnome math science
platforms           darwin

description         A powerful Gtk3 based spreadsheet with Excel, ODF, R and Python support.
long_description    A powerful Gtk3 based spreadsheet that features full Excel function \
                    and file compatibility and additional functions not found in Excel, \
                    and statistics operations based on R. Functionality can be extended \
                    with Python and plugins. Other file compatibility includes OASIS ODF, \
                    Quattro Pro, Psion 5, Paradox DB, and more (see homepage). GDA \
                    database support is available with the +database variant.

homepage            http://projects.gnome.org/gnumeric/
master_sites        gnome:sources/${name}/${branch}/
use_xz              yes

checksums           sha256  5de9cca87efb2ea190bcddf57bd83a34e7f9580f5b7c92c6757707d1164748ef \
                    rmd160  c59ab9c79bf152afe54705a82fdde3c247c49667

depends_build       port:gnome-doc-utils \
                    port:intltool \
                    port:pkgconfig

depends_lib         port:goffice \
                    port:psiconv \
                    port:pxlib

configure.args      --disable-schemas-compile \
                    --enable-introspection \
                    --without-gda


variant database description {builds with support for GDA database} {
    depends_lib-append        port:libgda5
    configure.args-replace    --without-gda --with-gda
}

variant python26 conflicts python27 description {Use python 2.6} {
    configure.python          ${prefix}/bin/python2.6
    depends_lib-append        port:py26-gobject3
    set python_framework      ${frameworks_dir}/Python.framework/Versions/2.6
    configure.pkg_config_path ${python_framework}/lib/pkgconfig
}

variant python27 conflicts python26 description {Use python 2.7} {
    configure.python          ${prefix}/bin/python2.7
    depends_lib-append        port:py27-gobject3
    set python_framework      ${frameworks_dir}/Python.framework/Versions/2.7
    configure.pkg_config_path ${python_framework}/lib/pkgconfig
}

if {![variant_isset python26]} {
    default_variants +python27
}

variant quartz description {build with gtk-osx-application support} {
    require_active_variants gtk3 quartz
    require_active_variants gtk-osx-application gtk3

    depends_lib-append  port:gtk-osx-application
    
    patchfiles-append   patch_quartz-src-wbc-gtk.c.diff \
                        patch_quartz-src-GNOME_Gnumeric-gtk.xml.in.diff
}

post-activate {
    catch {system "${prefix}/bin/scrollkeeper-update"}
    catch {system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"}
    catch {system "${prefix}/bin/gtk-update-icon-cache -f -t ${prefix}/share/icons/hicolor"}
    catch {system "${prefix}/bin/glib-compile-schemas ${prefix}/share/glib-2.0/schemas"}
}

livecheck.type  gnome

# yelp is currently not available in a +quartz environment due to dependency issues,
# see #39898 #40282 #40116
notes \
"Recommended supplementary ports:
    gnome-themes-standard  provides the default Gnome Adwaita theme
    yelp                   provides a help browser for Gnome apps"
