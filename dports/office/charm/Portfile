# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.0

github.setup        KDAB Charm aca5faf6

# The last release version is too old:
#github.setup        KDAB Charm 1.8.0
#github.tarball_from releases

name                charm
version             1.8.0
maintainers         gmail.com:rjvbertin mk openmaintainer
categories          office
license             GPL-2+ LGPL-2.1+
description         Charm - the Cross-Platform Time Tracker
long_description    Charm is a program for OS X, Linux and Windows that helps to keep track of time. It is built around two major ideas - tasks and events. Tasks are the things time is spend on, repeatedly. For example, ironing laundry is a task. The laundry done for two hours on last Tuesday is an event in that task. When doing laundry multiple times, the events will be accumulated, and can later be printed in activity reports or weekly/monthly time sheets. So in case laundry would be done for three hours on Wednesday again, the activity report for the "Ironing Laundry" task would list the event on tuesday, the event on wednesday and a total of five hours.
platforms           darwin

subport ${name}-qt5 {
    PortGroup       qt5 1.0
    conflicts       ${name}
    depends_lib-append      port:qt5-mac-sqlite3-plugin
    configure.args-append   -DWITH_QT4:BOOL=OFF
}

if {${subport} ne "${name}-qt5"} {
    PortGroup       qt4 1.0
    conflicts       ${name}-qt5
    depends_build-append    port:automoc
    depends_lib-append      port:qt4-mac-sqlite3-plugin
    configure.args-append   -DWITH_QT4:BOOL=ON
}

configure.args-append   -DCharm_VERSION="${version}-${github.version}" -DBIN_INSTALL_DIR:PATH=${qt_apps_dir}

# aca5faf6
checksums           rmd160  c0f938504705477a751f4be7f28220de261a1e56 \
                    sha256  1651dc8fb4c5100c96137e1fe076ce86a89b98b2e81e652a4fae1b8a5c5860f7

# 1.8.0
#checksums           rmd160  95fca2fd3236f8d39bf9e67b5ca43e3466f6c205 \
#                    sha256  d2cfefd78893288e99b8b813185fa5449a423988e070940b9894e304e0208c54

patchfiles          patch-CMakeFiles.patch \
                    adapt-to-osx-macports.patch

post-extract                {file mkdir ${workpath}/build}
# standard post-arg, where to find the primary CMakeLists.txt file.
default configure.post_args {../${worksrcdir}}
default configure.dir       {${workpath}/build}
default build.dir           {${workpath}/build}

use_parallel_build  yes

post-destroot {
    xinstall -m 0755 -d ${destroot}${qt_apps_dir}
    ln -s ${qt_apps_dir}/Charm.app/Contents/MacOS/Charm ${destroot}${prefix}/bin/charmtimetracker
}

