--- a/storage/perfschema/CMakeLists.txt	2012-06-09 10:56:53.000000000 -0700
+++ b/storage/perfschema/CMakeLists.txt	2012-06-10 14:23:06.000000000 -0700
@@ -74,6 +74,7 @@
 )
 
 MYSQL_ADD_PLUGIN(perfschema ${PERFSCHEMA_SOURCES} STORAGE_ENGINE DEFAULT STATIC_ONLY)
-IF(WITH_PERFSCHEMA_STORAGE_ENGINE)
+IF(WITH_PERFSCHEMA_STORAGE_ENGINE AND WITH_UNIT_TESTS)
+  ENABLE_TESTING()
   ADD_SUBDIRECTORY(unittest)
 ENDIF()
