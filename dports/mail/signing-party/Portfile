# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                signing-party
version             1.1.8
checksums           rmd160  b6f019c9588a4432065d59a35fb7a4acd2807613 \
                    sha256  dd6ff82067096a31d37d2f74c53bd326fe49e38a55e99f8719e9b1b773e56a8d

categories          mail security
maintainers         cal openmaintainer
platforms           darwin
description         Various OpenPGP related tools
long_description    signing-party is a collection for all kinds of PGP/GnuPG \
                    related things, including signing scripts, party \
                    preparation scripts, etc.

homepage            http://pgp-tools.alioth.debian.org/
license             BSD GPL-2 GPL-2+
master_sites        debian:s/signing-party/
distname            ${name}_${version}
worksrcdir          ${name}-${version}
extract.mkdir       yes
extract.suffix      .orig.tar.gz

patchfiles          gpgwrap-makefile-usingtherightcompiler.patch \
                    keyanalyze-makefile-usingtherightcompiler.patch

use_configure       no

depends_build       port:automake17 \
                    port:autoconf

depends_lib         port:perl5.16 \
                    port:p5.16-class-methodmaker \
                    port:p5.16-mailtools \
                    port:p5.16-term-readkey \
                    port:p5.16-gnupg-interface \
                    port:p5.16-text-iconv \
                    port:p5.16-text-template \
                    port:p5.16-mime-tools \
                    port:p5.16-net-idn-encode \
                    port:qprint
depends_run         bin:gpg:gnupg \
                    port:dialog

variant universal   {}

build.env-append    CC=${configure.cc} \
                    CFLAGS="${configure.cflags} [get_canonical_archflags]"

pre-build {
    reinplace "s|/usr/bin/perl|${prefix}/bin/perl5.16|" \
        ${worksrcpath}/caff/caff \
        ${worksrcpath}/caff/pgp-clean \
        ${worksrcpath}/caff/pgp-fixkey \
        ${worksrcpath}/gpg-key2ps/gpg-key2ps \
        ${worksrcpath}/gpgdir/bump_version.pl \
        ${worksrcpath}/gpgdir/gpgdir \
        ${worksrcpath}/gpgdir/install.pl \
        ${worksrcpath}/gpglist/gpglist \
        ${worksrcpath}/gpgsigs/gpgsigs \
        ${worksrcpath}/keylookup/keylookup \
        ${worksrcpath}/sig2dot/sig2dot \
        ${worksrcpath}/springgraph/springgraph
}

platform macosx {
    post-patch {
        reinplace "s!getent.*$!dscl . -read /Users/\$USER \| awk \'\{print \$2\}\'\`!" ${worksrcpath}/gpg-mailkeys/gpg-mailkeys
    }
}

destroot {
        # install executables
        xinstall -m 0755 \
            ${worksrcpath}/caff/caff \
            ${worksrcpath}/caff/pgp-clean \
            ${worksrcpath}/caff/pgp-fixkey \
            ${worksrcpath}/gpg-key2ps/gpg-key2ps \
            ${worksrcpath}/gpg-mailkeys/gpg-mailkeys \
            ${worksrcpath}/gpglist/gpglist \
            ${worksrcpath}/gpgparticipants/gpgparticipants \
            ${worksrcpath}/gpgsigs/gpgsigs \
            ${worksrcpath}/gpgwrap/bin/gpgwrap \
            ${worksrcpath}/keyanalyze/keyanalyze \
            ${worksrcpath}/keyanalyze/process_keys \
            ${worksrcpath}/keylookup/keylookup \
            ${worksrcpath}/sig2dot/sig2dot \
            ${worksrcpath}/springgraph/springgraph \
            ${destroot}${prefix}/bin
        # install manpages
        xinstall -m 0644 \
            ${worksrcpath}/caff/caff.1 \
            ${worksrcpath}/caff/pgp-clean.1 \
            ${worksrcpath}/caff/pgp-fixkey.1 \
            ${worksrcpath}/gpg-key2ps/gpg-key2ps.1 \
            ${worksrcpath}/gpg-mailkeys/gpg-mailkeys.1 \
            ${worksrcpath}/gpglist/gpglist.1 \
            ${worksrcpath}/gpgparticipants/gpgparticipants.1 \
            ${worksrcpath}/gpgwrap/doc/gpgwrap.1 \
            ${worksrcpath}/sig2dot/sig2dot.1 \
            ${worksrcpath}/springgraph/springgraph.1 \
            ${worksrcpath}/gpgsigs/gpgsigs.1 \
            ${worksrcpath}/keyanalyze/keyanalyze.1 \
            ${worksrcpath}/keylookup/keylookup.1 \
            ${destroot}${prefix}/share/man/man1
        # install example configurations in share/doc
        xinstall -d \
            ${destroot}${prefix}/share/doc/signing-party
        xinstall -m 0644 \
            ${worksrcpath}/caff/caffrc.sample \
            ${worksrcpath}/gpg-mailkeys/example.gpg-mailkeysrc \
            ${destroot}${prefix}/share/doc/signing-party
}

notes               "Some example configuration files have been installed to ${prefix}/share/doc/signing-party."

livecheck.type      regex
livecheck.url       http://packages.debian.org/unstable/misc/${name}
livecheck.regex     ${name} .(\[0-9.\]+)
