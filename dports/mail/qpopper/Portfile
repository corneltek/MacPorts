# $Id: Portfile,v 1.4 2003/10/28 16:03:19 ssen Exp $

PortSystem 1.0
name		qpopper
version		4.0.5
revision	3
categories	mail
maintainers	pguyot@kallisys.net
description	Eudora POP3 mail server
long_description	popper is Eudora's POP3 mail server. It does not include a mail \
			transfer agent or an SMTP server, it just let you get your mail stored \
			on the machine via POP3.
homepage	http://www.eudora.com/qpopper/
distfiles	${name}${version}${extract.sufx}
master_sites	ftp://ftp.qualcomm.com/eudora/servers/unix/popper/ \
		http://core.ring.gr.jp/archives/net/mail/qpopper/ \
		http://www.ring.gr.jp/archives/net/mail/qpopper/ \
		ftp://ftp.nctu.edu.tw/network/mail/qpopper/
checksums	md5 e00853280c9e899711f0b0239d3d8f86
worksrcdir	${portname}${portversion}
patchfiles	patch-Makefile.in

configure.args	--mandir=${prefix}/share/man --with-pam=pop3
destroot.destdir	prefix=${destroot}/${prefix} mandir=${destroot}/${prefix}/share/man

pre-destroot {	system "install -d ${destroot}${prefix}/etc/xinetd.d"
		system "install -o root -m 755 -c ${portpath}/files/qpopper-dist \
			${destroot}${prefix}/etc/xinetd.d/" 
		reinplace "s|@@PREFIX@@|${prefix}|g" \
			${destroot}${prefix}/etc/xinetd.d/qpopper-dist }

# Tell the user that the server needs to be used through (x)inetd
post-install {
	ui_msg "\nTo use qpopper, you'll need to add it to inetd.conf/xinetd.d depending on"
	ui_msg "what you use on your system.\n"
	ui_msg "For inetd, something like:"
	ui_msg "pop3  stream  tcp  nowait  root  /usr/libexec/tcpd  ${prefix}/sbin/popper"
	ui_msg "should do it.\n"
	ui_msg "For xinetd (the default on MacOS X), you'll find in ${prefix}/etc/xinetd.d/"
	ui_msg "a file called qpopper-dist that you should edit and copy to /etc/xinetd.d/\n"
	ui_msg "In both cases, don't forget to tell (x)inetd to reload their configuration.\n"
}

variant darwin {
	patchfiles-append patch-configure
	configure.env	CPPFLAGS="-I${workpath}/paminclude" CFLAGS="-I${workpath}/paminclude"

	post-extract	{
		system "rm '${worksrcpath}/INSTALL'"
		system "mkdir -p ${workpath}/paminclude"
		system "ln -s /usr/include/pam ${workpath}/paminclude/security"
	}
}

variant ssl {
	configure.args-append	--with-openssl=${prefix}
	depends_lib-append	lib:libssl.0:openssl
}
