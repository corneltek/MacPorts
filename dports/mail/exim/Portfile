# $Id: Portfile,v 1.10 2003/04/18 07:34:40 fkr Exp $

PortSystem 1.0
name            exim
version		4.14
categories	mail
description     complete replacement for sendmail	
long_description	Exim is a mail transfer agent (MTA) developed \
			at the University of Cambridge for use on Unix \
			systems connected to the Internet. It is freely \
			available under the terms of the GNU General \
			Public Licence. In overall style it is similar \
			to Smail 3, but its facilities are more extensive.
homepage	http://www.exim.org/
platforms	darwin
maintainers     fkr@opendarwin.org
master_sites    ftp://ftp.csx.cam.ac.uk/pub/software/email/exim/exim4/ \
                ftp://ftp.exim.org/pub/exim/exim4/
checksums	md5 bebd65023b117e2fa7dcea46f1129556
depends_lib     path:/usr/include/netinet/ip_var.h:netinet-headers 
depends_build	bin:perl:perl5.8	

set exim_user 	exim 

configure   { 	cd ${worksrcpath}
              	system "cp src/EDITME Local/Makefile"
              	reinplace "s|/usr/exim/bin|${prefix}/sbin|g" Local/Makefile
              	reinplace "s|/usr/exim/configure|${prefix}/etc/exim/exim.conf|g" Local/Makefile
              	reinplace "s|EXIM_USER=|EXIM_USER=${exim_user}|g" Local/Makefile
              	reinplace "s|/var/spool/exim|${prefix}/var/spool/exim|g" Local/Makefile 
              	reinplace "s|EXIM_MONITOR=eximon.bin|#EXIM_MONITOR=eximon.bin|g" Local/Makefile

#Should be in pre-deployment/user addition phase

adduser ${exim_user} gid=[existsgroup mail] }
install.destroot ROOT=${destroot}

post-install {  system "install -o root -m 755 -d ${prefix}/share/exim"
                cd ${worksrcpath}
                system "cp -R doc/ ${prefix}/share/exim"
                system "install -o ${exim_user} -g mail -m 750 -d ${prefix}/var/spool/exim"
                system "install -o root -m 755 -d ${prefix}/etc/rc.d"
                system "install -o root -m 755 -c \
                    ${portpath}/files/exim.sh ${prefix}/etc/rc.d"
                reinplace "s|__PREFIX|${prefix}|g" ${prefix}/etc/rc.d/exim.sh }

variant smtp-auth {
		post-configure { reinplace "s|# AUTH_CRAM_MD5=yes|AUTH_CRAM_MD5=yes|g" Local/Makefile
				 reinplace "s|# AUTH_PLAINTEXT=yes|AUTH_PLAINTEXT=yes|g" Local/Makefile
				 reinplace "s|# AUTH_SPA=yes|AUTH_SPA=yes|g" Local/Makefile } }
