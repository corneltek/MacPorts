PortSystem 1.0
name            exim
version		4.10
categories	mail
description     complete replacement for sendmail	
platforms	darwin
maintainers     fkr@opendarwin.org
master_sites    ftp://ftp.csx.cam.ac.uk/pub/software/email/exim/exim4/ \
                ftp://ftp.exim.org/pub/exim/exim4/
checksums       md5 3248805102546701a83ddceb032303af
depends_lib     path:/usr/include/netinet/ip_var.h:netinet-headers 

set exim_user 	exim 

configure   { 	cd ${worksrcpath}
              	system "cp src/EDITME Local/Makefile"
              	reinplace "s|/usr/exim/bin|${prefix}/sbin|g" Local/Makefile
              	reinplace "s|/usr/exim/configure|${prefix}/etc/exim/exim.conf|g" Local/Makefile
              	reinplace "s|EXIM_USER=|EXIM_USER=${exim_user}|g" Local/Makefile
              	reinplace "s|/var/spool/exim|${prefix}/var/spool/exim|g" Local/Makefile 
              	reinplace "s|EXIM_MONITOR=eximon.bin|#EXIM_MONITOR=eximon.bin|g" Local/Makefile
              	adduser ${exim_user} gid=[existsgroup mail] }

post-install {  system "install -o root -m 755 -d ${prefix}/share/exim"
                cd ${worksrcpath}
                system "cp -R doc/ ${prefix}/share/exim"
                system "install -o ${exim_user} -g mail -m 750 -d ${prefix}/var/spool/exim"
                system "install -o root -m 755 -d ${prefix}/etc/rc.d"
                system "install -o root -m 755 -c \
                    ${portpath}/files/exim.sh ${prefix}/etc/rc.d"
                reinplace "s|__PREFIX|${prefix}|g" ${prefix}/etc/rc.d/exim.sh }

contents    	etc/exim \
            	etc/exim/exim.conf \
            	sbin \
            	sbin/exicyclog \
            	sbin/exigrep \
            	sbin/exim \
            	sbin/exim-4.10-1 \
            	sbin/exim_checkaccess \
            	sbin/exim_dbmbuild \
            	sbin/exim_dumpdb \
            	sbin/exim_fixdb \
            	sbin/exim_lock \
            	sbin/exim_tidydb \
            	sbin/eximstats \
            	sbin/exinext \
            	sbin/exiqsumm \
            	sbin/exiwhat
