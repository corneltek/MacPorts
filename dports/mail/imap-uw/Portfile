# $Id: Portfile,v 1.16 2003/12/18 06:48:28 rshaw Exp $

PortSystem 1.0
name		imap-uw
version		2002e
revision	5
categories	mail
maintainers	mij@opendarwin.org
description	University of Washington IMAP daemon
homepage	http://www.washington.edu/imap/
platforms	darwin

long_description $description

master_sites	ftp://ftp.cac.washington.edu/imap/ \
		http://distfiles.opendarwin.org/

extract.suffix	.tar.Z
distname	imap-${version}
checksums	md5 0d246d868f20d8c441d235b77c940676

configure	{}

build.target	osx

platform darwin 7 { patchfiles patch-src-osdep-unix-Makefile \
		      patch-src-osdep-unix-ckp_osx.c }

variant ssl_plain { patchfiles patch-Makefile
		    build.args SSLTYPE=unix }

variant ssl_pam { version 2003.DEV.SNAP-0312072251
		  distname imap-${version}
		  checksums md5 cb1cee5c5970d76f0a1f59987318a9af
		  depends_lib lib:libssl.0.9:openssl
		  patchfiles patch-Makefile
		  build.target oxp
		  build.args	SSLTYPE=unix
		  post-destroot { file mkdir ${destroot}${prefix}/share/doc/${name}
		    file copy ${filespath}/README-MACOSX \
		      ${filespath}/etc-pam.d-imap \
		      ${filespath}/etc-xinetd.d-imap \
		      ${filespath}/etc-xinetd.d-imaps \
		      ${destroot}${prefix}/share/doc/${name}/
		    reinplace "s|__PREFIX|${prefix}|" \
		      ${filespath}/README-MACOSX \
		      ${destroot}${prefix}/share/doc/${name}/etc-xinetd.d-imap \
		      ${destroot}${prefix}/share/doc/${name}/etc-xinetd.d-imaps
		    ui_msg "For setup of IMAP-UW using SSL and PAM on Mac OS X 10.3, please see\n${prefix}/share/doc/${name}/README-MACOSX for details." } }

variant mbx	{ build.args-append CREATEPROTO=mbxproto }

variant subdir	{ patchfiles-append patch-env_unix.c }

destroot	{ system "install -m 755 -d ${destroot}${prefix}/libexec"
		  system "install -m 755 -d ${destroot}${prefix}/bin"
		  system "install -m 755 -d ${destroot}${prefix}/share/man/man8"
		  system "install -m 755 -d ${destroot}${prefix}/share/man/man1"
		  system "install -m 755 ${worksrcpath}/imapd/imapd ${destroot}${prefix}/libexec"
		  system "install -m 755 ${worksrcpath}/ipopd/ipop3d ${destroot}${prefix}/libexec/ipop2d"
		  system "install -m 755 ${worksrcpath}/ipopd/ipop3d ${destroot}${prefix}/libexec/ipop3d"
		  system "install -m 755 ${worksrcpath}/mailutil/mailutil ${destroot}${prefix}/bin"
		  system "install -m 755 ${worksrcpath}/tmail/tmail ${destroot}${prefix}/bin"
		  system "install -m 755 ${worksrcpath}/dmail/dmail ${destroot}${prefix}/bin"
		  system "install -m 755 ${worksrcpath}/mtest/mtest ${destroot}${prefix}/bin/mboxtest"
		  system "install -g mail -m 2711 ${worksrcpath}/mlock/mlock ${destroot}${prefix}/libexec"
		  system "install -m 755 ${worksrcpath}/src/imapd/imapd.8c ${destroot}${prefix}/share/man/man8/imapd.8"
		  system "install -m 755 ${worksrcpath}/src/ipopd/ipopd.8c ${destroot}${prefix}/share/man/man8/ipopd.8"
		  system "install -m 755 ${worksrcpath}/src/mailutil/mailutil.1 ${destroot}${prefix}/share/man/man1"
		  system "install -m 755 ${worksrcpath}/src/tmail/tmail.1 ${destroot}${prefix}/share/man/man1"
		  system "install -m 755 ${worksrcpath}/src/dmail/dmail.1 ${destroot}${prefix}/share/man/man1" }
