# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                sympa
version             6.1.23
set branch          [join [lrange [split ${version} .] 0 1] .]
categories          mail
license             GPL-2
maintainers         nomaintainer
platforms           darwin

description         Sympa - Mailing List Manager with LDAP support

long_description    An advanced perl-based mail list manager with a web interface \
                    that supports LDAP authentication and LDAP extraction of \
                    list subscribers and owners.

homepage            http://www.sympa.org

master_sites        http://www.sympa.org/distribution/ \
                    http://www.sympa.org/distribution/old/

checksums           rmd160  0c65549bc01e154081554a7d9ff8bb11db1d0ccc \
                    sha256  3d15aa8816dafcc4017cc06e52def44d5461498a05e9ef7634498b0993234ae4

depends_lib         path:bin/mysql_config5:mysql5 \
                    port:apache2 \
                    port:mod_fcgid \
                    port:openssl \
                    port:postfix \
                    port:p5.16-archive-zip \
                    port:p5.16-authcas \
                    port:p5.16-cgi \
                    port:p5.16-cgi-fast \
                    port:p5.16-crypt-ciphersaber \
                    port:p5.16-crypt-openssl-x509 \
                    port:p5.16-data-password \
                    port:p5.16-dbd-mysql \
                    port:p5.16-dbi \
                    port:p5.16-digest-md5 \
                    port:p5.16-file-copy-recursive \
                    port:p5.16-html-format \
                    port:p5.16-html-stripscripts-parser \
                    port:p5.16-html-tree \
                    port:p5.16-io-stringy \
                    port:p5.16-io-socket-ssl \
                    port:p5.16-libintl-perl \
                    port:p5.16-libwww-perl \
                    port:p5.16-mailtools \
                    port:p5.16-mail-dkim \
                    port:p5.16-mhonarc \
                    port:p5.16-mime-base64 \
                    port:p5.16-mime-charset \
                    port:p5.16-mime-encwords \
                    port:p5.16-mime-lite-html \
                    port:p5.16-mime-tools \
                    port:p5.16-net-dns \
                    port:p5.16-net-netmask \
                    port:p5.16-perl-ldap \
                    port:p5.16-soap-lite \
                    port:p5.16-template-toolkit \
                    port:p5.16-term-progressbar \
                    port:p5.16-time-hires \
                    port:p5.16-unicode-linebreak \
                    port:p5.16-xml-libxml

configure.args      --with-perl=${prefix}/bin/perl5.16 \
                    --with-user=www \
                    --with-group=www \
                    --enable-fhs \
                    --with-aliases_file=${prefix}/etc/${name}/sympa_aliases \
                    --with-newaliases=${prefix}/bin/newaliases \
                    --with-postmap=${prefix}/sbin/postmap

# Create a startupitem to start/stop the server
startupitem.create    yes
startupitem.start    "${prefix}/share/${name}/sympa"
startupitem.stop     "${prefix}/share/${name}/sympa"

post-destroot {
    xinstall -m 644 ${worksrcpath}/INSTALL ${destroot}${prefix}/share/doc/${name}
}

notes "
You can find documentation at:
    http://www.sympa.org/manual_${branch}/index

Check that you have all the required perl modules:
    ${prefix}/sbin/sympa_wizard.pl --check

First installation:
    Check the INSTALL file:
        ${prefix}/share/doc/sympa/INSTALL
    Run the wizard to define some required parameters that can't be guessed:
        ${prefix}/sbin/sympa_wizard.pl

Upgrading:
    Run this script to upgrade your data structures:
        ${prefix}/sbin/sympa.pl --upgrade
"

livecheck.regex     "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
