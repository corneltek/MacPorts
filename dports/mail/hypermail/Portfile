# $Id: Portfile,v 1.2 2003/08/05 09:29:18 jkh Exp $
PortSystem	1.0
name		hypermail
version		2.1.7
categories	mail textproc
maintainers	blb@pobox.com
description	Hypermail, mail to cross-referenced HTML converter
long_description	Hypermail is a program that takes a file of mail messages in UNIX mailbox \
			format and generates a set of cross-referenced HTML documents.

homepage	http://www.hypermail.org/

master_sites    http://www.hypermail.org/dist/ \
		http://distfiles.opendarwin.org/:lt
distfiles-append	ltconfig13:lt ltmain13:lt

platforms	darwin
checksums	${distname}${extract.sufx} md5 bbbf059f8e29c4b0d6bbc995567050cd \
		ltconfig13 md5 ea53f42a550c9f9e653758a8ed91574e \
		ltmain13 md5 e094ae92724c4015dbab97de151c2525

extract.only	${distname}${extract.sufx}
patchfiles	patch-msg2archive.c

# Update configure and libtool files; rename INSTALL as make gets confused
# otherwise (on HFS+ where INSTALL and install are the same file)
post-patch {	system "cp ${distpath}/ltconfig13 ${worksrcpath}/src/pcre/ltconfig"
		system "cp ${distpath}/ltconfig13 ${worksrcpath}/src/fnv/ltconfig"
		system "cp ${distpath}/ltmain13 ${worksrcpath}/src/pcre/ltmain.sh"
		system "cp ${distpath}/ltmain13 ${worksrcpath}/src/fnv/ltmain.sh"
		system "cp /usr/share/libtool/config.* ${worksrcpath}/src/pcre"
		system "cp /usr/share/libtool/config.* ${worksrcpath}/src/fnv"
		system "mv ${worksrcpath}/INSTALL ${worksrcpath}/INSTALL.txt" }

configure.env	CFLAGS="-L${prefix}/lib"
configure.args	--with-cgidir=${destroot}/${prefix}/share/hypermail/cgi-bin \
		--with-htmldir=${destroot}/${prefix}/share/doc/hypermail \
		--without-gdbm

destroot.args	prefix=${destroot}/${prefix}
pre-destroot {   system "mkdir -p ${destroot}/${prefix}/share/doc/hypermail/images" }

variant gdbm {  depends_lib     lib:libgdbm:gdbm
		configure.args	--with-cgidir=${destroot}/${prefix}/share/hypermail/cgi-bin \
				--with-htmldir=${destroot}/${prefix}/share/doc/hypermail \
				--with-gdbm=${prefix} }
