# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
name                bitcoind
categories          finance crypto
version             0.8.6.08b93f9a65ce70e650244f94725fcd042d97f0ee
revision            0
epoch               2013121401
platforms           darwin
license             MIT
maintainers         easieste openmaintainer
description         mainline bitcoind from Satoshi github source installing a node for the BTC peer-to-peer digital currency
long_description    Bitcoin is a peer-to-peer digital currency. By peer-to-peer,  \
                    we mean that there is no central authority to issue \
                    new Bitcoins or keep track of transactions. Instead, these \
                    tasks are managed collectively by the Bitcoin protocol \
                    operating through the nodes of the network. 
homepage            http://www.bitcoin.org/
# FIXME
master_sites        github
distname            ${name}-${version}

fetch.type          git
git.url             https://github.com/bitcoin/bitcoin.git
#git.branch          v0.8.6 # Doesn't contain "./autogen.sh"
git.branch          08b93f9a65ce70e650244f94725fcd042d97f0ee
#git.branch          9109ed6430366c928d21e2d9016a6484e4ff1b8a # TODO allow hg hash

depends_lib         port:boost \
                    port:openssl \
                    port:db48 \
                    port:miniupnpc 

worksrcdir          bitcoin

configure.cmd "./autogen.sh && ./configure"

build.args          ""
build.pre_args      ""
build.post_args     ""
build.target        ""
build.cmd           make

destroot {
    xinstall -d ${destroot}${prefix}/sbin
    xinstall -m 755 -W ${worksrcpath} src/bitcoind ${destroot}${prefix}/sbin

    set docdir ${destroot}${prefix}/share/doc/${name}
    xinstall -d ${docdir}
    eval xinstall -m 444 -W ${worksrcpath} [glob ${worksrcpath}/doc/*] ${docdir}
}

variant qt description {Build and install both the daemon and the graphical Satoshi QT client. } {
    error "see ../bitcoin for last working version."
    build.cmd "cd src && make -f makefile.osx"
    depends_lib-delete port:qt4-mac
}

notes "

1.  Sanity in scripting:

    cmd$ ln -s \"~/Library/Application Support/Bitcoin\" ~/.bitcoin

2.  View progress with:

    cmd$ tail -F ~/.bitcoin/debug.log

3.  Edit ~/.bitcoin/bitcoin.conf with RPC credentials 

4.  Start in background via:
    
    cmd$ ${prefix}/sbin/bitcoind -daemon


"
