# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

# When updating gpg-agent, update gnupg2 also if applicable.
name                gpg-agent
version             2.0.26
categories          security mail
maintainers         ionic openmaintainer
license             GPL-3+
installs_libs       no

description         GPG key agent
long_description    gpg-agent is a key management agent similar \
                    in function to ssh-agent.
homepage            http://www.gnupg.org
platforms           darwin freebsd sunos
distname            gnupg-${version}
dist_subdir         gnupg2
master_sites        gnupg:gnupg

use_bzip2           yes

checksums           rmd160  874040ed8fad12067cbe67c8da222b2ad99a5a96 \
                    sha256  7758e30dc382ae7a7167ed41b7f936aa50af5ea2d6fccdef663b5b750b65b8e0

configure.args      --enable-agent-only \
                    --with-pinentry-pgm=${prefix}/bin/pinentry

# glib fails to find the right stdint.h  It picks clang's internal one rather
# than the system header
configure.env       gl_cv_absolute_stdint_h=/usr/include/stdint.h

depends_lib         port:libiconv       \
                    port:gettext        \
                    port:zlib           \
                    port:bzip2          \
                    port:bison          \
                    port:libassuan      \
                    port:libksba        \
                    port:libgcrypt      \
                    port:libgpg-error   \
                    port:pth            \
                    port:pinentry

patchfiles          patch-po_Makevars.diff

post-destroot {
    # Prevent conflict with gnupg2 port.
    delete ${destroot}${prefix}/share/doc/gnupg/README
}

variant no_pinentry description {Do not use pinentry to handle user input} {
    depends_lib-delete      port:pinentry
    configure.args-delete   --with-pinentry-pgm=${prefix}/bin/pinentry
}

livecheck.type      regex
livecheck.url       ftp://ftp.gnupg.org/gcrypt/gnupg/
livecheck.regex     gnupg-(\\d+\\.\\d+\\.\\d+)
