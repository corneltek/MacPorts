# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           muniversal 1.0
PortGroup           github 1.0

github.setup        mozilla mozjpeg 3.0 v
revision            1
categories          graphics
conflicts           jpeg libjpeg-turbo
platforms           darwin
supported_archs     i386 x86_64
maintainers         raimue openmaintainer
description         A fork of libjpeg-turbo by Mozilla with 'jpgcrush' feature
long_description \
    mozjpeg is a fork of libjpeg-turbo with jpgcrush functionality to reduce \
    the size of JPEG images. The 'jpgcrush' feature finds the progressive \
    coding configuration which uses the fewest bits. This most frequently \
    reduces file size by 2-10%, but those are not hard limits. Significantly \
    greater reductions have been observed.
license             BSD

checksums           rmd160  fd8fbfaa3d4592181dc0d088c93c47938fa9fa04 \
                    sha256  e73cac2e2503eb9b974913e16e89421daa2289111d1daa874295ccfc34a175ef

depends_build       port:pkgconfig \
                    port:nasm

use_autoreconf      yes
autoreconf.args     -fvi

configure.args-append   --with-jpeg8 NASM=${prefix}/bin/nasm
switch ${build_arch} {
    i386 {
        configure.args-append --host i686-apple-darwin
    }
    x86_64 {
        configure.args-append --host x86_64-apple-darwin
    }
}
lappend merger_configure_args(i386) --host i686-apple-darwin
lappend merger_configure_args(x86_64) --host x86_64-apple-darwin

post-destroot {
    xinstall -d ${destroot}${prefix}/share/doc/${name}
    move ${destroot}${prefix}/share/doc/example.c ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/libjpeg.txt ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/README ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/README-turbo.txt ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/structure.txt ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/usage.txt ${destroot}${prefix}/share/doc/${name}/
    move ${destroot}${prefix}/share/doc/wizard.txt ${destroot}${prefix}/share/doc/${name}/
}
