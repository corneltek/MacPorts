# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           bitbucket 1.0

bitbucket.setup     Coin3D coin 3.1.3 Coin-
name                Coin
revision            5
license             BSD
description         cross platform C++ OpenGL scene graph library
long_description    Coin is a high-level 3D graphics library with a   \
                    C++ Application Programming Interface. Coin uses scene-graph data \
                    structures to render real-time graphics suitable for mostly all   \
                    kinds of scientific and engineering visualization applications.

categories          graphics devel
platforms           darwin
maintainers         css
bitbucket.tarball_from downloads

checksums           rmd160  e57fd6a4876a06874429f9ad6b96f166f5609362 \
                    sha256  583478c581317862aa03a19f14c527c3888478a06284b9a46a0155fa5886d417

depends_lib         port:mesa \
                    port:simage \
                    port:xorg-libsm \
                    port:xorg-libXext \
                    port:xorg-libXt

patchfiles          configure.patch \
                    for.patch \
                    clang-name-lookup.diff \
                    fix-weird-error.diff \
                    patch-include-Inventor-C-base-math-undefs.h.diff \
                    patch-Info.plist.in.diff

configure.args      --with-simage=${prefix} \
                    --mandir=${prefix}/share/man

post-build {
    reinplace -E {s|-arch [a-z0-9_]+||g} \
        ${worksrcpath}/Coin.pc \
        ${worksrcpath}/coin-default.cfg
}

platform darwin {
    configure.args-append   --disable-framework --enable-darwin-x11

    variant aqua description {Install as an OS X framework without X11.} {
        patchfiles-append       framework-prefix.patch

        configure.args-replace  --disable-framework --with-framework-prefix=${frameworks_dir}
        configure.args-replace  --enable-darwin-x11 --without-x

        depends_lib-delete      port:xorg-libsm \
                                port:xorg-libXext \
                                port:xorg-libXt
    }
}

variant devel description {Activate developer features, including debug libraries.} {
    configure.args-append   --enable-next-minor --enable-debug
}

variant manpages description {Include API documentation in manpages.} {
    depends_build-append    port:doxygen
    configure.args-append   --enable-man --mandir=${prefix}/share/man
    post-destroot {
        file rename ${destroot}${prefix}/share/man/man3/threads.3 \
            ${destroot}${prefix}/share/man/man3/threads-coin.3
        file rename ${destroot}${prefix}/share/man/man3/manips.3 \
            ${destroot}${prefix}/share/man/man3/manips-coin.3
    }
}

variant threadsafe description {Allow threadsafe scene graph traversals.} {
    configure.args-append   --enable-threadsafe
}
