# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

# 2013 RC is out, but this port is broken anyway because of boost incompatibilities with Apple

PortSystem              1.0
PortGroup               cmake 1.0
PortGroup               wxWidgets 1.0

name                    hugin-app
version                 2012.0.0
categories              graphics
maintainers             nomaintainer
description             Panorama photo stitcher
long_description        An easy to use cross-platform panoramic imaging \
                        toolchain based on Panorama Tools. With hugin you \
                        can assemble a mosaic of photographs into a complete \
                        immersive panorama, stitch any series of overlapping \
                        pictures and much more.

homepage                http://hugin.sourceforge.net
platforms               darwin

master_sites            sourceforge:hugin
distname                hugin-${version}
use_bzip2               yes

depends_build-append    port:pkgconfig
depends_lib             port:boost \
                        port:exiv2 \
                        port:gettext \
                        port:glew \
                        port:ilmbase \
                        port:jpeg \
                        port:lensfun \
                        port:libpano13 \
                        port:libpng \
                        port:libxml2 \
                        port:openexr \
                        port:swig-python \
                        port:tclap \
                        port:tiff \
                        port:python27


# TODO dependencies:
# - freeglut or glut, the OpenGL utility toolkit
# - optionally, lapack
# - for the optional Python Scripting Interface (currently functional and tested only on Linux and Windows)
#     Python version >=2.6
#     SWIG >=2.0 - If Python >=3.2, SWIG must be >=2.0.4
#
# NOTE: maybe the problem was that if swig is installed,
#       it gets detected and then requires swig-python
#       and additional python definitions, else it fails to bulid

# TODO: try to see where MAC_SELF_CONTAINED_BUNDLE gets defined

# patch-src-foreign-vigra-vigra-cachedfileimage.hxx.patch - https://bugs.launchpad.net/bugs/1213586
# patch-src-foreign-zthread-include-zthread-Guard.h.diff  - https://bugs.launchpad.net/bugs/1213585
# patch-src-hugin1-hugin1.pch.diff                        - moderately helps with compiler issues
# patch-src-hugin1-base_wx-platform.h.diff                - fixed upstream
patchfiles              patch-src-foreign-vigra-vigra-cachedfileimage.hxx.patch \
                        patch-src-foreign-zthread-include-zthread-Guard.h.diff \
                        patch-src-hugin1-hugin1.pch.diff \
                        patch-src-hugin1-base_wx-platform.h.diff

depends_run             port:enblend \
                        port:p5.12-image-exiftool

checksums               md5     6a4fb2585eb3539ba6769cf4557f6e88 \
                        sha1    53f97d030716e66dc5a49c7e786686a9d5262b8d \
                        rmd160  703c01d6d3f35b4cb9fdeeaf25c2b321157e925f

# TODO: fix this
configure.args-append   -DPYTHON_EXECUTABLE=${frameworks_dir}/Python.framework/Versions/2.7/bin/python \
                        -DPYTHON_INCLUDE_DIR=${frameworks_dir}/Python.framework/Versions/2.7/include/python2.7 \
                        -DPYTHON_LIBRARY=${prefix}/lib/libpython2.7.dylib

# prevents some compiler errors
configure.cxxflags-append -D__ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORES=1

# if this option works ok, others may be removed
variant wxwidgets30 conflicts wxgtk28 wxwidgets28 description {Use wxWidgets 2.9 (experimental)} {
    wxWidgets.use           wxWidgets-3.0
    depends_lib-append      port:${wxWidgets.port}
    configure.args-append   -DwxWidgets_CONFIG_EXECUTABLE=${wxWidgets.wxconfig} \
                            -DwxWidgets_wxrc_EXECUTABLE=${wxWidgets.wxrc}
}

variant wxwidgets28 conflicts wxgtk28 wxwidgets30 description {Use 32-bit Carbon-based wxWidgets 2.8} {
    wxWidgets.use           wxWidgets-2.8
    depends_lib-append      port:${wxWidgets.port}
    configure.args-append   -DwxWidgets_CONFIG_EXECUTABLE=${wxWidgets.wxconfig} \
                            -DwxWidgets_wxrc_EXECUTABLE=${wxWidgets.wxrc}
}

variant wxgtk28 conflicts wxwidgets28 wxwidgets30 description {Use wxWidgets 2.8 with GTK} {
    wxWidgets.use           wxGTK-2.8
    depends_lib-append      port:${wxWidgets.port}
    configure.args-append   -DwxWidgets_CONFIG_EXECUTABLE=${wxWidgets.wxconfig} \
                            -DwxWidgets_wxrc_EXECUTABLE=${wxWidgets.wxrc}
}

if {![variant_isset wxwidgets30] && ![variant_isset wxwidgets28] && ![variant_isset wxgtk28]} {
    default_variants        +wxwidgets30
}

livecheck.type          regex
livecheck.url           ${homepage}
livecheck.regex         Hugin-(\[.0-9\]+) released
