# $Id$

PortSystem 1.0

name			esdl
version			1.2
categories		graphics devel erlang
platforms		darwin
maintainers		bfulgham
description		Erlang OpenGL/SDL API and Utilities
long_description	ESDL is a library that gives you access to SDL and \
				OpenGL functionality from your Erlang program. \
				SDL handles 2D graphics, user events, and \
				audio, while OpenGL handles 3D graphics.

homepage		http://esdl.sourceforge.net/
master_sites		sourceforge
distfiles		${distname}.src.tar.gz
checksums               md5     3e96c1d47bd7c1e23285360d88ce1bea \
                        sha1    9a4b0c993b2ebe24565c31b5beaf912635153c8f \
                        rmd160  fc1f37647ae8e9652413c0ba683743d43c149573

depends_lib		port:libsdl-framework \
			port:erlang

use_configure		no

pre-build {
	# Use Macintosh Makefile
	reinplace "s|-arch \[a-z0-9_\]*|${configure.cc_archflags}|g" ${build.dir}/c_src/Makefile.macOSX
	reinplace "s|LDFLAGS = -F/Library/Frameworks|LDFLAGS = -F${prefix}/Library/Frameworks -F/Library/Frameworks|g" ${build.dir}/c_src/Makefile.macOSX
	reinplace "s|-I/Library/Frameworks/SDL.framework/Headers|-I${prefix}/Library/Frameworks/SDL.framework/Headers|g" ${build.dir}/c_src/Makefile.macOSX
	reinplace "s|LDFLAGS = -F/Library/Frameworks|LDFLAGS = -F${prefix}/Library/Frameworks -F/Library/Frameworks|g" ${build.dir}/c_src/Makefile.macOSX
}

platform darwin {
    # Note: this horrible hack is needed to get ESDL to build on
    # 64-bit OS's (like Snow Leopard and Lion).  Once wxWidgets 3.0
    # is released, this can go away.
    if {${configure.build_arch} == "x86_64"} {
        configure.build_arch i386
        depends_skip_archcheck libsdl-framework
        depends_skip_archcheck xorg-randrproto
        depends_skip_archcheck erlang
    } elseif {${configure.build_arch} == "ppc"} {
        configure.build_arch ppc
        depends_skip_archcheck libsdl-framework
        depends_skip_archcheck xorg-randrproto
        depends_skip_archcheck erlang
    }
}

build.target		
destroot.destdir		DPORTSDIR=${destroot}

set libdir ${prefix}/lib/erlang/lib/${distname}

destroot {
	xinstall -d -m 0755 ${destroot}${libdir}/ebin
	xinstall -d -m 0755 ${destroot}${libdir}/include
	xinstall -d -m 0755 ${destroot}${libdir}/src
	xinstall -d -m 0755 ${destroot}${libdir}/priv

	eval xinstall -m 0755 [glob ${worksrcpath}/ebin/*] \
		${destroot}${libdir}/ebin
	eval xinstall -m 0755 [glob ${worksrcpath}/include/*] \
		${destroot}${libdir}/include
	eval xinstall -m 0755 [glob ${worksrcpath}/src/*] \
		${destroot}${libdir}/src
	eval xinstall -m 0755 [glob ${worksrcpath}/priv/*] \
		${destroot}${libdir}/priv

	set docdir ${prefix}/share/doc/${name}
	xinstall -d -m 0755 ${destroot}${docdir}
	xinstall -d -m 0755 ${destroot}${docdir}/html
	xinstall -d -m 0755 ${destroot}${docdir}/test
	xinstall -m 0755 -W ${worksrcpath} Readme Readme.MacOSX-Cocoa license.terms \
		${destroot}${docdir}

	eval xinstall -m 0755 [glob ${worksrcpath}/doc/*] \
		${destroot}${docdir}/html
	eval xinstall -m 0755 [glob ${worksrcpath}/test/*] \
		${destroot}${docdir}/test
}

livecheck.regex		<title>${name} ${name}-(.*) released.*</title> 
