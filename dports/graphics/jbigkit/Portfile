# $Id: Portfile,v 1.3 2004/03/02 10:12:22 blb Exp $

PortSystem			1.0
name				jbigkit
version				1.5
revision			1
categories			graphics
maintainers			blb@pobox.com
description			Data compression algorithm for bi-level high-res images
long_description \
	JBIG-KIT provides a portable library of compression and decompression \
	functions with a documented interface that you can very easily include \
	into your image or document processing software. In addition, JBIG-KIT \
	provides ready-to-use compression and decompression programs with a \
	simple command line interface (similar to the converters found in netpbm).

platforms			darwin

homepage			http://www.cl.cam.ac.uk/~mgk25/${name}
master_sites		http://www.cl.cam.ac.uk/~mgk25/download/

checksums			md5 d54f65825be7a28728f251b6d4922e07

worksrcdir			${name}

post-patch {
	reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/libjbig/Makefile
}

use_configure		no

destroot {
	xinstall -m 755 -d ${destroot}/${prefix}/bin \
		${destroot}/${prefix}/include ${destroot}/${prefix}/lib \
		${destroot}/${prefix}/share/man/man1 \
		${destroot}/${prefix}/share/doc/${name} \
		${destroot}/${prefix}/share/examples
	xinstall -m 755 -W ${worksrcpath}/pbmtools jbgtopbm pbmtojbg \
		${destroot}/${prefix}/bin
	xinstall -m 644 -W ${worksrcpath}/pbmtools jbgtopbm.1 pbmtojbg.1 \
		${destroot}/${prefix}/share/man/man1
	xinstall -m 644 -W ${worksrcpath}/libjbig jbig.h \
		${destroot}/${prefix}/include
	xinstall -m 644 -W ${worksrcpath}/libjbig libjbig.a \
		${destroot}/${prefix}/lib
	system "ranlib ${destroot}/${prefix}/lib/libjbig.a"
	if {[variant_isset darwin]} {
		xinstall -m 644 -W ${worksrcpath}/libjbig libjbig.1.dylib \
			${destroot}/${prefix}/lib
		system "ln -s libjbig.1.dylib ${destroot}/${prefix}/lib/libjbig.dylib"
	}
	# Coming soon to a Portfile near you...
#	else {
#		xinstall -m 644 -W ${worksrcpath}/libjbig libjbig.so.1 \
#			${destroot}/${prefix}/lib
#		system "ln -s libjbig.so.1 ${destroot}/${prefix}/lib/libjbig.so"
#	}
	xinstall -m 644 -W ${worksrcpath} ANNOUNCE CHANGES COPYING INSTALL TODO \
		${destroot}/${prefix}/share/doc/${name}
	xinstall -m 644 -W ${worksrcpath}/libjbig jbig.doc \
		${destroot}/${prefix}/share/doc/${name}
	file copy ${worksrcpath}/examples \
		${destroot}/${prefix}/share/examples/${name}
}

variant darwin {
	patchfiles-append	patch-Makefile_darwin patch-libjbig_Makefile_darwin
}

