# -*- coding: utf-8; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                svdlibc
version             1.34
license             BSD
maintainers         nomaintainer

categories          math science
description         SVDLIBC is a C library to perform singular value decomposition
long_description    SVDLIBC is a C library based on the SVDPACKC library. It offers a \
                    cleaned-up version of the code with a sane library interface and a \
                    front-end executable that performs matrix file type conversions, along \
                    with computing singular value decompositions. Currently the only SVDPACKC \
                    algorithm implemented in SVDLIBC is las2, because it seems to be \
                    consistently the fastest.

platforms           darwin

homepage            http://tedlab.mit.edu/~dr/SVDLIBC/
master_sites        ${homepage}
distname            ${name}
extract.suffix      .tgz
worksrcdir          SVDLIBC

checksums           md5     1b644ab4a3df72d6d0a1aeccb93ac503 \
                    sha1    9243fbc0516af42b020423442212a025b3406dac \
                    rmd160  3ef133f8ccd9cb1659c11c7692e148709aca7431

use_configure       no
universal_variant   no

set hosttype        macos
build.env-append    HOSTTYPE='${hosttype}'
build.target        svd
 
pre-build {
    reinplace "s|-march=i486|${configure.cc_archflags}|g" ${worksrcpath}/Makefile
}

# this phase fails. it appears this code does not respect destroot.
destroot {
    xinstall -m 644 ${worksrcpath}/${hosttype}/libsvd.a ${destroot}${prefix}/lib
    xinstall -m 755 ${worksrcpath}/${hosttype}/svd ${destroot}${prefix}/bin
    foreach h {svdutil.h svdlib.h} {
        xinstall -m 644 ${worksrcpath}/${h} ${destroot}${prefix}/include
    }

    # Documentation
    xinstall -m 755 -d ${destroot}${prefix}/share/${name}
    file copy ${worksrcpath}/Manual ${destroot}${prefix}/share/${name}
}

livecheck.type    regexm
livecheck.regex   Version Notes</h3>\n\n<table>\n<tr><td valign=top><b>(\[0-9.\]+)
